import{ak as gr,al as xi,am as o1,an as re,ao as a1,ap as Ml,aq as Ul,ar as vc,as as vo,at as c1,a2 as u1,au as bi,av as h1,aw as l1,ax as X,ay as f1,az as uc,aA as p1,aB as d1,aC as g1,aD as Th,aE as v1,aF as y1,aG as _1,aH as Oh,aI as m1,aJ as w1,aK as Ys,aL as Ah,aM as b1,aN as E1,aO as jl,aP as Fr,aQ as I1,aR as x1,aS as hs,aT as Dt,aU as er,aV as wi,aW as cr,aX as S1,aY as ls,aZ as Hl,a_ as P1,a$ as R1,b0 as T1,b1 as kl,b2 as O1,b3 as zl,b4 as Bl,b5 as ps,b6 as hc,b7 as uo,b8 as gs,b9 as A1,ba as ho,bb as C1,bc as N1,bd as D1,be as no,bf as F1,bg as L1,bh as Ga,bi as Ch,bj as $1,bk as q1,bl as M1,bm as Nh,bn as U1,bo as j1,bp as H1,bq as k1,br as z1,bs as B1,bt as V1,bu as Dh,bv as Gs,bw as Vl,bx as Ka,by as G1,bz as K1,a6 as W1}from"./index-8d7d7e80.js";import{e as Pr,$ as yc}from"./events-15b76d90.js";var yo={},Xs={};Object.defineProperty(Xs,"__esModule",{value:!0});function J1(u){if(typeof u!="string")throw new Error(`Cannot safe json parse value of type ${typeof u}`);try{return JSON.parse(u)}catch{return u}}Xs.safeJsonParse=J1;function Y1(u){return typeof u=="string"?u:JSON.stringify(u,(i,r)=>typeof r>"u"?null:r)}Xs.safeJsonStringify=Y1;var $s={exports:{}},Fh;function Q1(){return Fh||(Fh=1,function(){let u;function i(){}u=i,u.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},u.prototype.setItem=function(r,n){this[r]=String(n)},u.prototype.removeItem=function(r){delete this[r]},u.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},u.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},u.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof gr<"u"&&gr.localStorage?$s.exports=gr.localStorage:typeof window<"u"&&window.localStorage?$s.exports=window.localStorage:$s.exports=new i}()),$s.exports}var Wa={},qs={},Lh;function X1(){if(Lh)return qs;Lh=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.IKeyValueStorage=void 0;class u{}return qs.IKeyValueStorage=u,qs}var Ms={},$h;function Z1(){if($h)return Ms;$h=1,Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.parseEntry=void 0;const u=Xs;function i(r){var n;return[r[0],u.safeJsonParse((n=r[1])!==null&&n!==void 0?n:"")]}return Ms.parseEntry=i,Ms}var qh;function e_(){return qh||(qh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=xi;i.__exportStar(X1(),u),i.__exportStar(Z1(),u)}(Wa)),Wa}Object.defineProperty(yo,"__esModule",{value:!0});yo.KeyValueStorage=void 0;const fs=xi,Mh=Xs,t_=fs.__importDefault(Q1()),r_=e_();class Gl{constructor(){this.localStorage=t_.default}getKeys(){return fs.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return fs.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(r_.parseEntry)})}getItem(i){return fs.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(i);if(r!==null)return Mh.safeJsonParse(r)})}setItem(i,r){return fs.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Mh.safeJsonStringify(r))})}removeItem(i){return fs.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}yo.KeyValueStorage=Gl;var i_=yo.default=Gl,vs={},Us={},Ja={},js={};let ki=class{};const s_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ki},Symbol.toStringTag,{value:"Module"})),n_=o1(s_);var Uh;function o_(){if(Uh)return js;Uh=1,Object.defineProperty(js,"__esModule",{value:!0}),js.IHeartBeat=void 0;const u=n_;class i extends u.IEvents{constructor(n){super()}}return js.IHeartBeat=i,js}var jh;function Kl(){return jh||(jh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),xi.__exportStar(o_(),u)}(Ja)),Ja}var Ya={},ji={},Hh;function a_(){if(Hh)return ji;Hh=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.HEARTBEAT_EVENTS=ji.HEARTBEAT_INTERVAL=void 0;const u=re;return ji.HEARTBEAT_INTERVAL=u.FIVE_SECONDS,ji.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ji}var kh;function Wl(){return kh||(kh=1,function(u){Object.defineProperty(u,"__esModule",{value:!0}),xi.__exportStar(a_(),u)}(Ya)),Ya}var zh;function c_(){if(zh)return Us;zh=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.HeartBeat=void 0;const u=xi,i=Pr,r=re,n=Kl(),o=Wl();class l extends n.IHeartBeat{constructor(v){super(v),this.events=new i.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(v==null?void 0:v.interval)||o.HEARTBEAT_INTERVAL}static init(v){return u.__awaiter(this,void 0,void 0,function*(){const m=new l(v);return yield m.init(),m})}init(){return u.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(v,m){this.events.on(v,m)}once(v,m){this.events.once(v,m)}off(v,m){this.events.off(v,m)}removeListener(v,m){this.events.removeListener(v,m)}initialize(){return u.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Us.HeartBeat=l,Us}(function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=xi;i.__exportStar(c_(),u),i.__exportStar(Kl(),u),i.__exportStar(Wl(),u)})(vs);var Te={},Qa,Bh;function u_(){if(Bh)return Qa;Bh=1;function u(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Qa=i;function i(r,n,o){var l=o&&o.stringify||u,d=1;if(typeof r=="object"&&r!==null){var v=n.length+d;if(v===1)return r;var m=new Array(v);m[0]=l(r);for(var x=1;x<v;x++)m[x]=l(n[x]);return m.join(" ")}if(typeof r!="string")return r;var D=n.length;if(D===0)return r;for(var H="",k=1-d,z=-1,j=r&&r.length||0,K=0;K<j;){if(r.charCodeAt(K)===37&&K+1<j){switch(z=z>-1?z:0,r.charCodeAt(K+1)){case 100:case 102:if(k>=D||n[k]==null)break;z<K&&(H+=r.slice(z,K)),H+=Number(n[k]),z=K+2,K++;break;case 105:if(k>=D||n[k]==null)break;z<K&&(H+=r.slice(z,K)),H+=Math.floor(Number(n[k])),z=K+2,K++;break;case 79:case 111:case 106:if(k>=D||n[k]===void 0)break;z<K&&(H+=r.slice(z,K));var oe=typeof n[k];if(oe==="string"){H+="'"+n[k]+"'",z=K+2,K++;break}if(oe==="function"){H+=n[k].name||"<anonymous>",z=K+2,K++;break}H+=l(n[k]),z=K+2,K++;break;case 115:if(k>=D)break;z<K&&(H+=r.slice(z,K)),H+=String(n[k]),z=K+2,K++;break;case 37:z<K&&(H+=r.slice(z,K)),H+="%",z=K+2,K++,k--;break}++k}++K}return z===-1?r:(z<j&&(H+=r.slice(z)),H)}return Qa}var Xa,Vh;function h_(){if(Vh)return Xa;Vh=1;const u=u_();Xa=o;const i=he().console||{},r={mapHttpRequest:j,mapHttpResponse:j,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:j,res:j,err:k};function n(A,M){return Array.isArray(A)?A.filter(function(ge){return ge!=="!stdSerializers.err"}):A===!0?Object.keys(M):!1}function o(A){A=A||{},A.browser=A.browser||{};const M=A.browser.transmit;if(M&&typeof M.send!="function")throw Error("pino: transmit option must have a send function");const W=A.browser.write||i;A.browser.write&&(A.browser.asObject=!0);const ge=A.serializers||{},te=n(A.browser.serialize,ge);let Ee=A.browser.serialize;Array.isArray(A.browser.serialize)&&A.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Oe=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),A.enabled===!1&&(A.level="silent");const et=A.level||"info",R=Object.create(W);R.log||(R.log=oe),Object.defineProperty(R,"levelVal",{get:Ue}),Object.defineProperty(R,"level",{get:Ae,set:J});const L={transmit:M,serialize:te,asObject:A.browser.asObject,levels:Oe,timestamp:z(A)};R.levels=o.levels,R.level=et,R.setMaxListeners=R.getMaxListeners=R.emit=R.addListener=R.on=R.prependListener=R.once=R.prependOnceListener=R.removeListener=R.removeAllListeners=R.listeners=R.listenerCount=R.eventNames=R.write=R.flush=oe,R.serializers=ge,R._serialize=te,R._stdErrSerialize=Ee,R.child=B,M&&(R._logEvent=H());function Ue(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ae(){return this._level}function J(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,l(L,R,"error","log"),l(L,R,"fatal","error"),l(L,R,"warn","error"),l(L,R,"info","log"),l(L,R,"debug","log"),l(L,R,"trace","log")}function B(U,V){if(!U)throw new Error("missing bindings for child Pino");V=V||{},te&&U.serializers&&(V.serializers=U.serializers);const ut=V.serializers;if(te&&ut){var ke=Object.assign({},ge,ut),$r=A.browser.serialize===!0?Object.keys(ke):te;delete U.serializers,m([U],$r,ke,this._stdErrSerialize)}function me(It){this._childLevel=(It._childLevel|0)+1,this.error=x(It,U,"error"),this.fatal=x(It,U,"fatal"),this.warn=x(It,U,"warn"),this.info=x(It,U,"info"),this.debug=x(It,U,"debug"),this.trace=x(It,U,"trace"),ke&&(this.serializers=ke,this._serialize=$r),M&&(this._logEvent=H([].concat(It._logEvent.bindings,U)))}return me.prototype=this,new me(this)}return R}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=r,o.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function l(A,M,W,ge){const te=Object.getPrototypeOf(M);M[W]=M.levelVal>M.levels.values[W]?oe:te[W]?te[W]:i[W]||i[ge]||oe,d(A,M,W)}function d(A,M,W){!A.transmit&&M[W]===oe||(M[W]=function(ge){return function(){const Ee=A.timestamp(),Oe=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var R=0;R<Oe.length;R++)Oe[R]=arguments[R];if(A.serialize&&!A.asObject&&m(Oe,this._serialize,this.serializers,this._stdErrSerialize),A.asObject?ge.call(et,v(this,W,Oe,Ee)):ge.apply(et,Oe),A.transmit){const L=A.transmit.level||M.level,Ue=o.levels.values[L],Ae=o.levels.values[W];if(Ae<Ue)return;D(this,{ts:Ee,methodLevel:W,methodValue:Ae,transmitLevel:L,transmitValue:o.levels.values[A.transmit.level||M.level],send:A.transmit.send,val:M.levelVal},Oe)}}}(M[W]))}function v(A,M,W,ge){A._serialize&&m(W,A._serialize,A.serializers,A._stdErrSerialize);const te=W.slice();let Ee=te[0];const Oe={};ge&&(Oe.time=ge),Oe.level=o.levels.values[M];let et=(A._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Oe,te.shift());Ee=te.length?u(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=u(te.shift(),te));return Ee!==void 0&&(Oe.msg=Ee),Oe}function m(A,M,W,ge){for(const te in A)if(ge&&A[te]instanceof Error)A[te]=o.stdSerializers.err(A[te]);else if(typeof A[te]=="object"&&!Array.isArray(A[te]))for(const Ee in A[te])M&&M.indexOf(Ee)>-1&&Ee in W&&(A[te][Ee]=W[Ee](A[te][Ee]))}function x(A,M,W){return function(){const ge=new Array(1+arguments.length);ge[0]=M;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return A[W].apply(this,ge)}}function D(A,M,W){const ge=M.send,te=M.ts,Ee=M.methodLevel,Oe=M.methodValue,et=M.val,R=A._logEvent.bindings;m(W,A._serialize||Object.keys(A.serializers),A.serializers,A._stdErrSerialize===void 0?!0:A._stdErrSerialize),A._logEvent.ts=te,A._logEvent.messages=W.filter(function(L){return R.indexOf(L)===-1}),A._logEvent.level.label=Ee,A._logEvent.level.value=Oe,ge(Ee,A._logEvent,et),A._logEvent=H(R)}function H(A){return{ts:0,messages:[],bindings:A||[],level:{label:"",value:0}}}function k(A){const M={type:A.constructor.name,msg:A.message,stack:A.stack};for(const W in A)M[W]===void 0&&(M[W]=A[W]);return M}function z(A){return typeof A.timestamp=="function"?A.timestamp:A.timestamp===!1?be:de}function j(){return{}}function K(A){return A}function oe(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function A(M){return typeof M<"u"&&M}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return A(self)||A(window)||A(this)||{}}}return Xa}var Hi={},Gh;function Jl(){return Gh||(Gh=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.PINO_CUSTOM_CONTEXT_KEY=Hi.PINO_LOGGER_DEFAULTS=void 0,Hi.PINO_LOGGER_DEFAULTS={level:"info"},Hi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Hi}var Zt={},Kh;function l_(){if(Kh)return Zt;Kh=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.generateChildLogger=Zt.formatChildLoggerContext=Zt.getLoggerContext=Zt.setBrowserLoggerContext=Zt.getBrowserLoggerContext=Zt.getDefaultLoggerOptions=void 0;const u=Jl();function i(v){return Object.assign(Object.assign({},v),{level:(v==null?void 0:v.level)||u.PINO_LOGGER_DEFAULTS.level})}Zt.getDefaultLoggerOptions=i;function r(v,m=u.PINO_CUSTOM_CONTEXT_KEY){return v[m]||""}Zt.getBrowserLoggerContext=r;function n(v,m,x=u.PINO_CUSTOM_CONTEXT_KEY){return v[x]=m,v}Zt.setBrowserLoggerContext=n;function o(v,m=u.PINO_CUSTOM_CONTEXT_KEY){let x="";return typeof v.bindings>"u"?x=r(v,m):x=v.bindings().context||"",x}Zt.getLoggerContext=o;function l(v,m,x=u.PINO_CUSTOM_CONTEXT_KEY){const D=o(v,x);return D.trim()?`${D}/${m}`:m}Zt.formatChildLoggerContext=l;function d(v,m,x=u.PINO_CUSTOM_CONTEXT_KEY){const D=l(v,m,x),H=v.child({context:D});return n(H,D,x)}return Zt.generateChildLogger=d,Zt}(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.pino=void 0;const i=xi,r=i.__importDefault(h_());Object.defineProperty(u,"pino",{enumerable:!0,get:function(){return r.default}}),i.__exportStar(Jl(),u),i.__exportStar(l_(),u)})(Te);class f_ extends ki{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class p_ extends ki{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class d_{constructor(i,r){this.logger=i,this.core=r}}let g_=class extends ki{constructor(i,r){super(),this.relayer=i,this.logger=r}},v_=class extends ki{constructor(i){super()}},y_=class{constructor(i,r,n,o){this.core=i,this.logger=r,this.name=n}};class __ extends ki{constructor(i,r){super(),this.relayer=i,this.logger=r}}let m_=class extends ki{constructor(i,r){super(),this.core=i,this.logger=r}},w_=class{constructor(i,r){this.projectId=i,this.logger=r}},b_=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},E_=class{constructor(i){this.client=i}};const I_=u=>JSON.stringify(u,(i,r)=>typeof r=="bigint"?r.toString()+"n":r),x_=u=>{const i=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=u.replace(i,'$1"$2n"$3');return JSON.parse(r,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function _c(u){if(typeof u!="string")throw new Error(`Cannot safe json parse value of type ${typeof u}`);try{return x_(u)}catch{return u}}function Qs(u){return typeof u=="string"?u:I_(u)||""}var mc={},Yl={};(function(u){Object.defineProperty(u,"__esModule",{value:!0});var i=a1,r=Ml;u.DIGEST_LENGTH=64,u.BLOCK_SIZE=128;var n=function(){function v(){this.digestLength=u.DIGEST_LENGTH,this.blockSize=u.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return v.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},v.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},v.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},v.prototype.update=function(m,x){if(x===void 0&&(x=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var D=0;if(this._bytesHashed+=x,this._bufferLength>0){for(;this._bufferLength<u.BLOCK_SIZE&&x>0;)this._buffer[this._bufferLength++]=m[D++],x--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(x>=this.blockSize&&(D=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,D,x),x%=this.blockSize);x>0;)this._buffer[this._bufferLength++]=m[D++],x--;return this},v.prototype.finish=function(m){if(!this._finished){var x=this._bytesHashed,D=this._bufferLength,H=x/536870912|0,k=x<<3,z=x%128<112?128:256;this._buffer[D]=128;for(var j=D+1;j<z-8;j++)this._buffer[j]=0;i.writeUint32BE(H,this._buffer,z-8),i.writeUint32BE(k,this._buffer,z-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,z),this._finished=!0}for(var j=0;j<this.digestLength/8;j++)i.writeUint32BE(this._stateHi[j],m,j*8),i.writeUint32BE(this._stateLo[j],m,j*8+4);return this},v.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},v.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},v.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},v.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},v}();u.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(v,m,x,D,H,k,z){for(var j=x[0],K=x[1],oe=x[2],be=x[3],de=x[4],pe=x[5],ue=x[6],he=x[7],A=D[0],M=D[1],W=D[2],ge=D[3],te=D[4],Ee=D[5],Oe=D[6],et=D[7],R,L,Ue,Ae,J,B,U,V;z>=128;){for(var ut=0;ut<16;ut++){var ke=8*ut+k;v[ut]=i.readUint32BE(H,ke),m[ut]=i.readUint32BE(H,ke+4)}for(var ut=0;ut<80;ut++){var $r=j,me=K,It=oe,O=be,T=de,S=pe,c=ue,w=he,Z=A,ae=M,ye=W,Ce=ge,De=te,xe=Ee,xt=Oe,_t=et;if(R=he,L=et,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),L=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,R=de&pe^~de&ue,L=te&Ee^~te&Oe,J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,R=o[ut*2],L=o[ut*2+1],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,R=v[ut%16],L=m[ut%16],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,Ue=U&65535|V<<16,Ae=J&65535|B<<16,R=Ue,L=Ae,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=(j>>>28|A<<32-28)^(A>>>34-32|j<<32-(34-32))^(A>>>39-32|j<<32-(39-32)),L=(A>>>28|j<<32-28)^(j>>>34-32|A<<32-(34-32))^(j>>>39-32|A<<32-(39-32)),J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,R=j&K^j&oe^K&oe,L=A&M^A&W^M&W,J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,w=U&65535|V<<16,_t=J&65535|B<<16,R=O,L=Ce,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=Ue,L=Ae,J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,O=U&65535|V<<16,Ce=J&65535|B<<16,K=$r,oe=me,be=It,de=O,pe=T,ue=S,he=c,j=w,M=Z,W=ae,ge=ye,te=Ce,Ee=De,Oe=xe,et=xt,A=_t,ut%16===15)for(var ke=0;ke<16;ke++)R=v[ke],L=m[ke],J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=v[(ke+9)%16],L=m[(ke+9)%16],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,Ue=v[(ke+1)%16],Ae=m[(ke+1)%16],R=(Ue>>>1|Ae<<32-1)^(Ue>>>8|Ae<<32-8)^Ue>>>7,L=(Ae>>>1|Ue<<32-1)^(Ae>>>8|Ue<<32-8)^(Ae>>>7|Ue<<32-7),J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,Ue=v[(ke+14)%16],Ae=m[(ke+14)%16],R=(Ue>>>19|Ae<<32-19)^(Ae>>>61-32|Ue<<32-(61-32))^Ue>>>6,L=(Ae>>>19|Ue<<32-19)^(Ue>>>61-32|Ae<<32-(61-32))^(Ae>>>6|Ue<<32-6),J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,v[ke]=U&65535|V<<16,m[ke]=J&65535|B<<16}R=j,L=A,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[0],L=D[0],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[0]=j=U&65535|V<<16,D[0]=A=J&65535|B<<16,R=K,L=M,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[1],L=D[1],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[1]=K=U&65535|V<<16,D[1]=M=J&65535|B<<16,R=oe,L=W,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[2],L=D[2],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[2]=oe=U&65535|V<<16,D[2]=W=J&65535|B<<16,R=be,L=ge,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[3],L=D[3],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[3]=be=U&65535|V<<16,D[3]=ge=J&65535|B<<16,R=de,L=te,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[4],L=D[4],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[4]=de=U&65535|V<<16,D[4]=te=J&65535|B<<16,R=pe,L=Ee,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[5],L=D[5],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[5]=pe=U&65535|V<<16,D[5]=Ee=J&65535|B<<16,R=ue,L=Oe,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[6],L=D[6],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[6]=ue=U&65535|V<<16,D[6]=Oe=J&65535|B<<16,R=he,L=et,J=L&65535,B=L>>>16,U=R&65535,V=R>>>16,R=x[7],L=D[7],J+=L&65535,B+=L>>>16,U+=R&65535,V+=R>>>16,B+=J>>>16,U+=B>>>16,V+=U>>>16,x[7]=he=U&65535|V<<16,D[7]=et=J&65535|B<<16,k+=128,z-=128}return k}function d(v){var m=new n;m.update(v);var x=m.digest();return m.clean(),x}u.hash=d})(Yl);(function(u){Object.defineProperty(u,"__esModule",{value:!0}),u.convertSecretKeyToX25519=u.convertPublicKeyToX25519=u.verify=u.sign=u.extractPublicKeyFromSecretKey=u.generateKeyPair=u.generateKeyPairFromSeed=u.SEED_LENGTH=u.SECRET_KEY_LENGTH=u.PUBLIC_KEY_LENGTH=u.SIGNATURE_LENGTH=void 0;const i=Ul,r=Yl,n=Ml;u.SIGNATURE_LENGTH=64,u.PUBLIC_KEY_LENGTH=32,u.SECRET_KEY_LENGTH=64,u.SEED_LENGTH=32;function o(O){const T=new Float64Array(16);if(O)for(let S=0;S<O.length;S++)T[S]=O[S];return T}const l=new Uint8Array(32);l[0]=9;const d=o(),v=o([1]),m=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),x=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),D=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),H=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),k=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function z(O,T){for(let S=0;S<16;S++)O[S]=T[S]|0}function j(O){let T=1;for(let S=0;S<16;S++){let c=O[S]+T+65535;T=Math.floor(c/65536),O[S]=c-T*65536}O[0]+=T-1+37*(T-1)}function K(O,T,S){const c=~(S-1);for(let w=0;w<16;w++){const Z=c&(O[w]^T[w]);O[w]^=Z,T[w]^=Z}}function oe(O,T){const S=o(),c=o();for(let w=0;w<16;w++)c[w]=T[w];j(c),j(c),j(c);for(let w=0;w<2;w++){S[0]=c[0]-65517;for(let ae=1;ae<15;ae++)S[ae]=c[ae]-65535-(S[ae-1]>>16&1),S[ae-1]&=65535;S[15]=c[15]-32767-(S[14]>>16&1);const Z=S[15]>>16&1;S[14]&=65535,K(c,S,1-Z)}for(let w=0;w<16;w++)O[2*w]=c[w]&255,O[2*w+1]=c[w]>>8}function be(O,T){let S=0;for(let c=0;c<32;c++)S|=O[c]^T[c];return(1&S-1>>>8)-1}function de(O,T){const S=new Uint8Array(32),c=new Uint8Array(32);return oe(S,O),oe(c,T),be(S,c)}function pe(O){const T=new Uint8Array(32);return oe(T,O),T[0]&1}function ue(O,T){for(let S=0;S<16;S++)O[S]=T[2*S]+(T[2*S+1]<<8);O[15]&=32767}function he(O,T,S){for(let c=0;c<16;c++)O[c]=T[c]+S[c]}function A(O,T,S){for(let c=0;c<16;c++)O[c]=T[c]-S[c]}function M(O,T,S){let c,w,Z=0,ae=0,ye=0,Ce=0,De=0,xe=0,xt=0,_t=0,nt=0,Le=0,Je=0,Ye=0,ot=0,je=0,Qe=0,Ne=0,ze=0,ht=0,qe=0,St=0,Ft=0,jt=0,Ht=0,qt=0,Kt=0,tr=0,qr=0,Wt=0,Br=0,ui=0,Pi=0,lt=S[0],tt=S[1],ft=S[2],pt=S[3],at=S[4],rt=S[5],Pt=S[6],Rt=S[7],dt=S[8],Tt=S[9],gt=S[10],mt=S[11],vt=S[12],We=S[13],Ot=S[14],At=S[15];c=T[0],Z+=c*lt,ae+=c*tt,ye+=c*ft,Ce+=c*pt,De+=c*at,xe+=c*rt,xt+=c*Pt,_t+=c*Rt,nt+=c*dt,Le+=c*Tt,Je+=c*gt,Ye+=c*mt,ot+=c*vt,je+=c*We,Qe+=c*Ot,Ne+=c*At,c=T[1],ae+=c*lt,ye+=c*tt,Ce+=c*ft,De+=c*pt,xe+=c*at,xt+=c*rt,_t+=c*Pt,nt+=c*Rt,Le+=c*dt,Je+=c*Tt,Ye+=c*gt,ot+=c*mt,je+=c*vt,Qe+=c*We,Ne+=c*Ot,ze+=c*At,c=T[2],ye+=c*lt,Ce+=c*tt,De+=c*ft,xe+=c*pt,xt+=c*at,_t+=c*rt,nt+=c*Pt,Le+=c*Rt,Je+=c*dt,Ye+=c*Tt,ot+=c*gt,je+=c*mt,Qe+=c*vt,Ne+=c*We,ze+=c*Ot,ht+=c*At,c=T[3],Ce+=c*lt,De+=c*tt,xe+=c*ft,xt+=c*pt,_t+=c*at,nt+=c*rt,Le+=c*Pt,Je+=c*Rt,Ye+=c*dt,ot+=c*Tt,je+=c*gt,Qe+=c*mt,Ne+=c*vt,ze+=c*We,ht+=c*Ot,qe+=c*At,c=T[4],De+=c*lt,xe+=c*tt,xt+=c*ft,_t+=c*pt,nt+=c*at,Le+=c*rt,Je+=c*Pt,Ye+=c*Rt,ot+=c*dt,je+=c*Tt,Qe+=c*gt,Ne+=c*mt,ze+=c*vt,ht+=c*We,qe+=c*Ot,St+=c*At,c=T[5],xe+=c*lt,xt+=c*tt,_t+=c*ft,nt+=c*pt,Le+=c*at,Je+=c*rt,Ye+=c*Pt,ot+=c*Rt,je+=c*dt,Qe+=c*Tt,Ne+=c*gt,ze+=c*mt,ht+=c*vt,qe+=c*We,St+=c*Ot,Ft+=c*At,c=T[6],xt+=c*lt,_t+=c*tt,nt+=c*ft,Le+=c*pt,Je+=c*at,Ye+=c*rt,ot+=c*Pt,je+=c*Rt,Qe+=c*dt,Ne+=c*Tt,ze+=c*gt,ht+=c*mt,qe+=c*vt,St+=c*We,Ft+=c*Ot,jt+=c*At,c=T[7],_t+=c*lt,nt+=c*tt,Le+=c*ft,Je+=c*pt,Ye+=c*at,ot+=c*rt,je+=c*Pt,Qe+=c*Rt,Ne+=c*dt,ze+=c*Tt,ht+=c*gt,qe+=c*mt,St+=c*vt,Ft+=c*We,jt+=c*Ot,Ht+=c*At,c=T[8],nt+=c*lt,Le+=c*tt,Je+=c*ft,Ye+=c*pt,ot+=c*at,je+=c*rt,Qe+=c*Pt,Ne+=c*Rt,ze+=c*dt,ht+=c*Tt,qe+=c*gt,St+=c*mt,Ft+=c*vt,jt+=c*We,Ht+=c*Ot,qt+=c*At,c=T[9],Le+=c*lt,Je+=c*tt,Ye+=c*ft,ot+=c*pt,je+=c*at,Qe+=c*rt,Ne+=c*Pt,ze+=c*Rt,ht+=c*dt,qe+=c*Tt,St+=c*gt,Ft+=c*mt,jt+=c*vt,Ht+=c*We,qt+=c*Ot,Kt+=c*At,c=T[10],Je+=c*lt,Ye+=c*tt,ot+=c*ft,je+=c*pt,Qe+=c*at,Ne+=c*rt,ze+=c*Pt,ht+=c*Rt,qe+=c*dt,St+=c*Tt,Ft+=c*gt,jt+=c*mt,Ht+=c*vt,qt+=c*We,Kt+=c*Ot,tr+=c*At,c=T[11],Ye+=c*lt,ot+=c*tt,je+=c*ft,Qe+=c*pt,Ne+=c*at,ze+=c*rt,ht+=c*Pt,qe+=c*Rt,St+=c*dt,Ft+=c*Tt,jt+=c*gt,Ht+=c*mt,qt+=c*vt,Kt+=c*We,tr+=c*Ot,qr+=c*At,c=T[12],ot+=c*lt,je+=c*tt,Qe+=c*ft,Ne+=c*pt,ze+=c*at,ht+=c*rt,qe+=c*Pt,St+=c*Rt,Ft+=c*dt,jt+=c*Tt,Ht+=c*gt,qt+=c*mt,Kt+=c*vt,tr+=c*We,qr+=c*Ot,Wt+=c*At,c=T[13],je+=c*lt,Qe+=c*tt,Ne+=c*ft,ze+=c*pt,ht+=c*at,qe+=c*rt,St+=c*Pt,Ft+=c*Rt,jt+=c*dt,Ht+=c*Tt,qt+=c*gt,Kt+=c*mt,tr+=c*vt,qr+=c*We,Wt+=c*Ot,Br+=c*At,c=T[14],Qe+=c*lt,Ne+=c*tt,ze+=c*ft,ht+=c*pt,qe+=c*at,St+=c*rt,Ft+=c*Pt,jt+=c*Rt,Ht+=c*dt,qt+=c*Tt,Kt+=c*gt,tr+=c*mt,qr+=c*vt,Wt+=c*We,Br+=c*Ot,ui+=c*At,c=T[15],Ne+=c*lt,ze+=c*tt,ht+=c*ft,qe+=c*pt,St+=c*at,Ft+=c*rt,jt+=c*Pt,Ht+=c*Rt,qt+=c*dt,Kt+=c*Tt,tr+=c*gt,qr+=c*mt,Wt+=c*vt,Br+=c*We,ui+=c*Ot,Pi+=c*At,Z+=38*ze,ae+=38*ht,ye+=38*qe,Ce+=38*St,De+=38*Ft,xe+=38*jt,xt+=38*Ht,_t+=38*qt,nt+=38*Kt,Le+=38*tr,Je+=38*qr,Ye+=38*Wt,ot+=38*Br,je+=38*ui,Qe+=38*Pi,w=1,c=Z+w+65535,w=Math.floor(c/65536),Z=c-w*65536,c=ae+w+65535,w=Math.floor(c/65536),ae=c-w*65536,c=ye+w+65535,w=Math.floor(c/65536),ye=c-w*65536,c=Ce+w+65535,w=Math.floor(c/65536),Ce=c-w*65536,c=De+w+65535,w=Math.floor(c/65536),De=c-w*65536,c=xe+w+65535,w=Math.floor(c/65536),xe=c-w*65536,c=xt+w+65535,w=Math.floor(c/65536),xt=c-w*65536,c=_t+w+65535,w=Math.floor(c/65536),_t=c-w*65536,c=nt+w+65535,w=Math.floor(c/65536),nt=c-w*65536,c=Le+w+65535,w=Math.floor(c/65536),Le=c-w*65536,c=Je+w+65535,w=Math.floor(c/65536),Je=c-w*65536,c=Ye+w+65535,w=Math.floor(c/65536),Ye=c-w*65536,c=ot+w+65535,w=Math.floor(c/65536),ot=c-w*65536,c=je+w+65535,w=Math.floor(c/65536),je=c-w*65536,c=Qe+w+65535,w=Math.floor(c/65536),Qe=c-w*65536,c=Ne+w+65535,w=Math.floor(c/65536),Ne=c-w*65536,Z+=w-1+37*(w-1),w=1,c=Z+w+65535,w=Math.floor(c/65536),Z=c-w*65536,c=ae+w+65535,w=Math.floor(c/65536),ae=c-w*65536,c=ye+w+65535,w=Math.floor(c/65536),ye=c-w*65536,c=Ce+w+65535,w=Math.floor(c/65536),Ce=c-w*65536,c=De+w+65535,w=Math.floor(c/65536),De=c-w*65536,c=xe+w+65535,w=Math.floor(c/65536),xe=c-w*65536,c=xt+w+65535,w=Math.floor(c/65536),xt=c-w*65536,c=_t+w+65535,w=Math.floor(c/65536),_t=c-w*65536,c=nt+w+65535,w=Math.floor(c/65536),nt=c-w*65536,c=Le+w+65535,w=Math.floor(c/65536),Le=c-w*65536,c=Je+w+65535,w=Math.floor(c/65536),Je=c-w*65536,c=Ye+w+65535,w=Math.floor(c/65536),Ye=c-w*65536,c=ot+w+65535,w=Math.floor(c/65536),ot=c-w*65536,c=je+w+65535,w=Math.floor(c/65536),je=c-w*65536,c=Qe+w+65535,w=Math.floor(c/65536),Qe=c-w*65536,c=Ne+w+65535,w=Math.floor(c/65536),Ne=c-w*65536,Z+=w-1+37*(w-1),O[0]=Z,O[1]=ae,O[2]=ye,O[3]=Ce,O[4]=De,O[5]=xe,O[6]=xt,O[7]=_t,O[8]=nt,O[9]=Le,O[10]=Je,O[11]=Ye,O[12]=ot,O[13]=je,O[14]=Qe,O[15]=Ne}function W(O,T){M(O,T,T)}function ge(O,T){const S=o();let c;for(c=0;c<16;c++)S[c]=T[c];for(c=253;c>=0;c--)W(S,S),c!==2&&c!==4&&M(S,S,T);for(c=0;c<16;c++)O[c]=S[c]}function te(O,T){const S=o();let c;for(c=0;c<16;c++)S[c]=T[c];for(c=250;c>=0;c--)W(S,S),c!==1&&M(S,S,T);for(c=0;c<16;c++)O[c]=S[c]}function Ee(O,T){const S=o(),c=o(),w=o(),Z=o(),ae=o(),ye=o(),Ce=o(),De=o(),xe=o();A(S,O[1],O[0]),A(xe,T[1],T[0]),M(S,S,xe),he(c,O[0],O[1]),he(xe,T[0],T[1]),M(c,c,xe),M(w,O[3],T[3]),M(w,w,x),M(Z,O[2],T[2]),he(Z,Z,Z),A(ae,c,S),A(ye,Z,w),he(Ce,Z,w),he(De,c,S),M(O[0],ae,ye),M(O[1],De,Ce),M(O[2],Ce,ye),M(O[3],ae,De)}function Oe(O,T,S){for(let c=0;c<4;c++)K(O[c],T[c],S)}function et(O,T){const S=o(),c=o(),w=o();ge(w,T[2]),M(S,T[0],w),M(c,T[1],w),oe(O,c),O[31]^=pe(S)<<7}function R(O,T,S){z(O[0],d),z(O[1],v),z(O[2],v),z(O[3],d);for(let c=255;c>=0;--c){const w=S[c/8|0]>>(c&7)&1;Oe(O,T,w),Ee(T,O),Ee(O,O),Oe(O,T,w)}}function L(O,T){const S=[o(),o(),o(),o()];z(S[0],D),z(S[1],H),z(S[2],v),M(S[3],D,H),R(O,S,T)}function Ue(O){if(O.length!==u.SEED_LENGTH)throw new Error(`ed25519: seed must be ${u.SEED_LENGTH} bytes`);const T=(0,r.hash)(O);T[0]&=248,T[31]&=127,T[31]|=64;const S=new Uint8Array(32),c=[o(),o(),o(),o()];L(c,T),et(S,c);const w=new Uint8Array(64);return w.set(O),w.set(S,32),{publicKey:S,secretKey:w}}u.generateKeyPairFromSeed=Ue;function Ae(O){const T=(0,i.randomBytes)(32,O),S=Ue(T);return(0,n.wipe)(T),S}u.generateKeyPair=Ae;function J(O){if(O.length!==u.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${u.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}u.extractPublicKeyFromSecretKey=J;const B=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(O,T){let S,c,w,Z;for(c=63;c>=32;--c){for(S=0,w=c-32,Z=c-12;w<Z;++w)T[w]+=S-16*T[c]*B[w-(c-32)],S=Math.floor((T[w]+128)/256),T[w]-=S*256;T[w]+=S,T[c]=0}for(S=0,w=0;w<32;w++)T[w]+=S-(T[31]>>4)*B[w],S=T[w]>>8,T[w]&=255;for(w=0;w<32;w++)T[w]-=S*B[w];for(c=0;c<32;c++)T[c+1]+=T[c]>>8,O[c]=T[c]&255}function V(O){const T=new Float64Array(64);for(let S=0;S<64;S++)T[S]=O[S];for(let S=0;S<64;S++)O[S]=0;U(O,T)}function ut(O,T){const S=new Float64Array(64),c=[o(),o(),o(),o()],w=(0,r.hash)(O.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const Z=new Uint8Array(64);Z.set(w.subarray(32),32);const ae=new r.SHA512;ae.update(Z.subarray(32)),ae.update(T);const ye=ae.digest();ae.clean(),V(ye),L(c,ye),et(Z,c),ae.reset(),ae.update(Z.subarray(0,32)),ae.update(O.subarray(32)),ae.update(T);const Ce=ae.digest();V(Ce);for(let De=0;De<32;De++)S[De]=ye[De];for(let De=0;De<32;De++)for(let xe=0;xe<32;xe++)S[De+xe]+=Ce[De]*w[xe];return U(Z.subarray(32),S),Z}u.sign=ut;function ke(O,T){const S=o(),c=o(),w=o(),Z=o(),ae=o(),ye=o(),Ce=o();return z(O[2],v),ue(O[1],T),W(w,O[1]),M(Z,w,m),A(w,w,O[2]),he(Z,O[2],Z),W(ae,Z),W(ye,ae),M(Ce,ye,ae),M(S,Ce,w),M(S,S,Z),te(S,S),M(S,S,w),M(S,S,Z),M(S,S,Z),M(O[0],S,Z),W(c,O[0]),M(c,c,Z),de(c,w)&&M(O[0],O[0],k),W(c,O[0]),M(c,c,Z),de(c,w)?-1:(pe(O[0])===T[31]>>7&&A(O[0],d,O[0]),M(O[3],O[0],O[1]),0)}function $r(O,T,S){const c=new Uint8Array(32),w=[o(),o(),o(),o()],Z=[o(),o(),o(),o()];if(S.length!==u.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${u.SIGNATURE_LENGTH} bytes`);if(ke(Z,O))return!1;const ae=new r.SHA512;ae.update(S.subarray(0,32)),ae.update(O),ae.update(T);const ye=ae.digest();return V(ye),R(w,Z,ye),L(Z,S.subarray(32)),Ee(w,Z),et(c,w),!be(S,c)}u.verify=$r;function me(O){let T=[o(),o(),o(),o()];if(ke(T,O))throw new Error("Ed25519: invalid public key");let S=o(),c=o(),w=T[1];he(S,v,w),A(c,v,w),ge(c,c),M(S,S,c);let Z=new Uint8Array(32);return oe(Z,S),Z}u.convertPublicKeyToX25519=me;function It(O){const T=(0,r.hash)(O.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const S=new Uint8Array(T.subarray(0,32));return(0,n.wipe)(T),S}u.convertSecretKeyToX25519=It})(mc);const S_="EdDSA",P_="JWT",Ql=".",Xl="base64url",R_="utf8",T_="utf8",O_=":",A_="did",C_="key",Wh="base58btc",N_="z",D_="K36",F_=32;function fo(u){return vo(vc(Qs(u),R_),Xl)}function Zl(u){const i=vc(D_,Wh),r=N_+vo(c1([i,u]),Wh);return[A_,C_,r].join(O_)}function L_(u){return vo(u,Xl)}function $_(u){return vc([fo(u.header),fo(u.payload)].join(Ql),T_)}function q_(u){return[fo(u.header),fo(u.payload),L_(u.signature)].join(Ql)}function Jh(u=Ul.randomBytes(F_)){return mc.generateKeyPairFromSeed(u)}async function M_(u,i,r,n,o=re.fromMiliseconds(Date.now())){const l={alg:S_,typ:P_},d=Zl(n.publicKey),v=o+r,m={iss:d,sub:u,aud:i,iat:o,exp:v},x=$_({header:l,payload:m}),D=mc.sign(n.secretKey,x);return q_({header:l,payload:m,signature:D})}const U_="PARSE_ERROR",j_="INVALID_REQUEST",H_="METHOD_NOT_FOUND",k_="INVALID_PARAMS",ef="INTERNAL_ERROR",wc="SERVER_ERROR",z_=[-32700,-32600,-32601,-32602,-32603],Js={[U_]:{code:-32700,message:"Parse error"},[j_]:{code:-32600,message:"Invalid Request"},[H_]:{code:-32601,message:"Method not found"},[k_]:{code:-32602,message:"Invalid params"},[ef]:{code:-32603,message:"Internal error"},[wc]:{code:-32e3,message:"Server error"}},tf=wc;function B_(u){return z_.includes(u)}function Yh(u){return Object.keys(Js).includes(u)?Js[u]:Js[tf]}function V_(u){const i=Object.values(Js).find(r=>r.code===u);return i||Js[tf]}function rf(u,i,r){return u.message.includes("getaddrinfo ENOTFOUND")||u.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${i}`):u}var sf={},ri={},Qh;function G_(){if(Qh)return ri;Qh=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.isBrowserCryptoAvailable=ri.getSubtleCrypto=ri.getBrowerCrypto=void 0;function u(){return(gr===null||gr===void 0?void 0:gr.crypto)||(gr===null||gr===void 0?void 0:gr.msCrypto)||{}}ri.getBrowerCrypto=u;function i(){const n=u();return n.subtle||n.webkitSubtle}ri.getSubtleCrypto=i;function r(){return!!u()&&!!i()}return ri.isBrowserCryptoAvailable=r,ri}var ii={},Xh;function K_(){if(Xh)return ii;Xh=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.isBrowser=ii.isNode=ii.isReactNative=void 0;function u(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}ii.isReactNative=u;function i(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}ii.isNode=i;function r(){return!u()&&!i()}return ii.isBrowser=r,ii}(function(u){Object.defineProperty(u,"__esModule",{value:!0});const i=xi;i.__exportStar(G_(),u),i.__exportStar(K_(),u)})(sf);function bc(u=3){const i=Date.now()*Math.pow(10,u),r=Math.floor(Math.random()*Math.pow(10,u));return i+r}function nf(u=6){return BigInt(bc(u))}function ds(u,i,r){return{id:r||bc(),jsonrpc:"2.0",method:u,params:i}}function Ec(u,i){return{id:u,jsonrpc:"2.0",result:i}}function _o(u,i,r){return{id:u,jsonrpc:"2.0",error:W_(i,r)}}function W_(u,i){return typeof u>"u"?Yh(ef):(typeof u=="string"&&(u=Object.assign(Object.assign({},Yh(wc)),{message:u})),typeof i<"u"&&(u.data=i),B_(u.code)&&(u=V_(u.code)),u)}class J_{}class Y_ extends J_{constructor(){super()}}class Q_ extends Y_{constructor(i){super()}}const X_="^https?:",Z_="^wss?:";function em(u){const i=u.match(new RegExp(/^\w+:/,"gi"));if(!(!i||!i.length))return i[0]}function of(u,i){const r=em(u);return typeof r>"u"?!1:new RegExp(i).test(r)}function Zh(u){return of(u,X_)}function el(u){return of(u,Z_)}function tm(u){return new RegExp("wss?://localhost(:d{2,5})?").test(u)}function af(u){return typeof u=="object"&&"id"in u&&"jsonrpc"in u&&u.jsonrpc==="2.0"}function Ic(u){return af(u)&&"method"in u}function mo(u){return af(u)&&(oi(u)||Lr(u))}function oi(u){return"result"in u}function Lr(u){return"error"in u}class ai extends Q_{constructor(i){super(i),this.events=new Pr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(i),this.connection.connected&&this.registerEventListeners()}async connect(i=this.connection){await this.open(i)}async disconnect(){await this.close()}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async request(i,r){return this.requestStrict(ds(i.method,i.params||[],i.id||nf().toString()),r)}async requestStrict(i,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(l){o(l)}this.events.on(`${i.id}`,l=>{Lr(l)?o(l.error):n(l.result)});try{await this.connection.send(i,r)}catch(l){o(l)}})}setConnection(i=this.connection){return i}onPayload(i){this.events.emit("payload",i),mo(i)?this.events.emit(`${i.id}`,i):this.events.emit("message",{type:i.method,data:i.params})}onClose(i){i&&i.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${i.code} ${i.reason?`(${i.reason})`:""}`)),this.events.emit("disconnect")}async open(i=this.connection){this.connection===i&&this.connection.connected||(this.connection.connected&&this.close(),typeof i=="string"&&(await this.connection.open(i),i=this.connection),this.connection=this.setConnection(i),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",i=>this.onPayload(i)),this.connection.on("close",i=>this.onClose(i)),this.connection.on("error",i=>this.events.emit("error",i)),this.connection.on("register_error",i=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var Za,tl;function rm(){return tl||(tl=1,Za=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Za}const im=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:rm(),sm=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",rl=u=>u.split("?")[0],il=10,nm=im();class om{constructor(i){if(this.url=i,this.events=new Pr.EventEmitter,this.registering=!1,!el(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Qs(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!el(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,n)=>{const o=sf.isReactNative()?void 0:{rejectUnauthorized:!tm(i)},l=new nm(i,[],o);sm()?l.onerror=d=>{const v=d;n(this.emitError(v.error))}:l.on("error",d=>{n(this.emitError(d))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?_c(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),l=_o(i,o);this.events.emit("payload",l)}parseError(i,r=this.url){return rf(i,rl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>il&&this.events.setMaxListeners(il)}emitError(i){const r=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${rl(this.url)}`));return this.events.emit("register_error",r),r}}var po={exports:{}};po.exports;(function(u,i){var r=200,n="__lodash_hash_undefined__",o=1,l=2,d=9007199254740991,v="[object Arguments]",m="[object Array]",x="[object AsyncFunction]",D="[object Boolean]",H="[object Date]",k="[object Error]",z="[object Function]",j="[object GeneratorFunction]",K="[object Map]",oe="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",A="[object Set]",M="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Oe="[object DataView]",et="[object Float32Array]",R="[object Float64Array]",L="[object Int8Array]",Ue="[object Int16Array]",Ae="[object Int32Array]",J="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",V="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,$r=/^(?:0|[1-9]\d*)$/,me={};me[et]=me[R]=me[L]=me[Ue]=me[Ae]=me[J]=me[B]=me[U]=me[V]=!0,me[v]=me[m]=me[Ee]=me[D]=me[Oe]=me[H]=me[k]=me[z]=me[K]=me[oe]=me[de]=me[he]=me[A]=me[M]=me[te]=!1;var It=typeof gr=="object"&&gr&&gr.Object===Object&&gr,O=typeof self=="object"&&self&&self.Object===Object&&self,T=It||O||Function("return this")(),S=i&&!i.nodeType&&i,c=S&&!0&&u&&!u.nodeType&&u,w=c&&c.exports===S,Z=w&&It.process,ae=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),ye=ae&&ae.isTypedArray;function Ce(g,b){for(var $=-1,Y=g==null?0:g.length,Ve=0,le=[];++$<Y;){var Xe=g[$];b(Xe,$,g)&&(le[Ve++]=Xe)}return le}function De(g,b){for(var $=-1,Y=b.length,Ve=g.length;++$<Y;)g[Ve+$]=b[$];return g}function xe(g,b){for(var $=-1,Y=g==null?0:g.length;++$<Y;)if(b(g[$],$,g))return!0;return!1}function xt(g,b){for(var $=-1,Y=Array(g);++$<g;)Y[$]=b($);return Y}function _t(g){return function(b){return g(b)}}function nt(g,b){return g.has(b)}function Le(g,b){return g==null?void 0:g[b]}function Je(g){var b=-1,$=Array(g.size);return g.forEach(function(Y,Ve){$[++b]=[Ve,Y]}),$}function Ye(g,b){return function($){return g(b($))}}function ot(g){var b=-1,$=Array(g.size);return g.forEach(function(Y){$[++b]=Y}),$}var je=Array.prototype,Qe=Function.prototype,Ne=Object.prototype,ze=T["__core-js_shared__"],ht=Qe.toString,qe=Ne.hasOwnProperty,St=function(){var g=/[^.]+$/.exec(ze&&ze.keys&&ze.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Ft=Ne.toString,jt=RegExp("^"+ht.call(qe).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=w?T.Buffer:void 0,qt=T.Symbol,Kt=T.Uint8Array,tr=Ne.propertyIsEnumerable,qr=je.splice,Wt=qt?qt.toStringTag:void 0,Br=Object.getOwnPropertySymbols,ui=Ht?Ht.isBuffer:void 0,Pi=Ye(Object.keys,Object),lt=ur(T,"DataView"),tt=ur(T,"Map"),ft=ur(T,"Promise"),pt=ur(T,"Set"),at=ur(T,"WeakMap"),rt=ur(Object,"create"),Pt=Gr(lt),Rt=Gr(tt),dt=Gr(ft),Tt=Gr(pt),gt=Gr(at),mt=qt?qt.prototype:void 0,vt=mt?mt.valueOf:void 0;function We(g){var b=-1,$=g==null?0:g.length;for(this.clear();++b<$;){var Y=g[b];this.set(Y[0],Y[1])}}function Ot(){this.__data__=rt?rt(null):{},this.size=0}function At(g){var b=this.has(g)&&delete this.__data__[g];return this.size-=b?1:0,b}function Eo(g){var b=this.__data__;if(rt){var $=b[g];return $===n?void 0:$}return qe.call(b,g)?b[g]:void 0}function Io(g){var b=this.__data__;return rt?b[g]!==void 0:qe.call(b,g)}function xo(g,b){var $=this.__data__;return this.size+=this.has(g)?0:1,$[g]=rt&&b===void 0?n:b,this}We.prototype.clear=Ot,We.prototype.delete=At,We.prototype.get=Eo,We.prototype.has=Io,We.prototype.set=xo;function vr(g){var b=-1,$=g==null?0:g.length;for(this.clear();++b<$;){var Y=g[b];this.set(Y[0],Y[1])}}function So(){this.__data__=[],this.size=0}function Po(g){var b=this.__data__,$=Ri(b,g);if($<0)return!1;var Y=b.length-1;return $==Y?b.pop():qr.call(b,$,1),--this.size,!0}function Ro(g){var b=this.__data__,$=Ri(b,g);return $<0?void 0:b[$][1]}function To(g){return Ri(this.__data__,g)>-1}function Oo(g,b){var $=this.__data__,Y=Ri($,g);return Y<0?(++this.size,$.push([g,b])):$[Y][1]=b,this}vr.prototype.clear=So,vr.prototype.delete=Po,vr.prototype.get=Ro,vr.prototype.has=To,vr.prototype.set=Oo;function Vr(g){var b=-1,$=g==null?0:g.length;for(this.clear();++b<$;){var Y=g[b];this.set(Y[0],Y[1])}}function Bi(){this.size=0,this.__data__={hash:new We,map:new(tt||vr),string:new We}}function Ao(g){var b=hi(this,g).delete(g);return this.size-=b?1:0,b}function Vi(g){return hi(this,g).get(g)}function Co(g){return hi(this,g).has(g)}function No(g,b){var $=hi(this,g),Y=$.size;return $.set(g,b),this.size+=$.size==Y?0:1,this}Vr.prototype.clear=Bi,Vr.prototype.delete=Ao,Vr.prototype.get=Vi,Vr.prototype.has=Co,Vr.prototype.set=No;function Gi(g){var b=-1,$=g==null?0:g.length;for(this.__data__=new Vr;++b<$;)this.add(g[b])}function en(g){return this.__data__.set(g,n),this}function tn(g){return this.__data__.has(g)}Gi.prototype.add=Gi.prototype.push=en,Gi.prototype.has=tn;function Rr(g){var b=this.__data__=new vr(g);this.size=b.size}function Do(){this.__data__=new vr,this.size=0}function Fo(g){var b=this.__data__,$=b.delete(g);return this.size=b.size,$}function Lo(g){return this.__data__.get(g)}function $o(g){return this.__data__.has(g)}function rn(g,b){var $=this.__data__;if($ instanceof vr){var Y=$.__data__;if(!tt||Y.length<r-1)return Y.push([g,b]),this.size=++$.size,this;$=this.__data__=new Vr(Y)}return $.set(g,b),this.size=$.size,this}Rr.prototype.clear=Do,Rr.prototype.delete=Fo,Rr.prototype.get=Lo,Rr.prototype.has=$o,Rr.prototype.set=rn;function sn(g,b){var $=Ji(g),Y=!$&&vn(g),Ve=!$&&!Y&&ms(g),le=!$&&!Y&&!Ve&&mn(g),Xe=$||Y||Ve||le,Ct=Xe?xt(g.length,String):[],Pe=Ct.length;for(var Ge in g)(b||qe.call(g,Ge))&&!(Xe&&(Ge=="length"||Ve&&(Ge=="offset"||Ge=="parent")||le&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||ln(Ge,Pe)))&&Ct.push(Ge);return Ct}function Ri(g,b){for(var $=g.length;$--;)if(gn(g[$][0],b))return $;return-1}function ys(g,b,$){var Y=b(g);return Ji(g)?Y:De(Y,$(g))}function Ti(g){return g==null?g===void 0?ge:be:Wt&&Wt in Object(g)?un(g):Uo(g)}function _s(g){return Ai(g)&&Ti(g)==v}function Oi(g,b,$,Y,Ve){return g===b?!0:g==null||b==null||!Ai(g)&&!Ai(b)?g!==g&&b!==b:nn(g,b,$,Y,Oi,Ve)}function nn(g,b,$,Y,Ve,le){var Xe=Ji(g),Ct=Ji(b),Pe=Xe?m:Mr(g),Ge=Ct?m:Mr(b);Pe=Pe==v?de:Pe,Ge=Ge==v?de:Ge;var wt=Pe==de,rr=Ge==de,Nt=Pe==Ge;if(Nt&&ms(g)){if(!ms(b))return!1;Xe=!0,wt=!1}if(Nt&&!wt)return le||(le=new Rr),Xe||mn(g)?Ki(g,b,$,Y,Ve,le):Mo(g,b,Pe,$,Y,Ve,le);if(!($&o)){var Ze=wt&&qe.call(g,"__wrapped__"),Jt=rr&&qe.call(b,"__wrapped__");if(Ze||Jt){var Tr=Ze?g.value():g,yr=Jt?b.value():b;return le||(le=new Rr),Ve(Tr,yr,$,Y,le)}}return Nt?(le||(le=new Rr),cn(g,b,$,Y,Ve,le)):!1}function qo(g){if(!_n(g)||pn(g))return!1;var b=Yi(g)?jt:ke;return b.test(Gr(g))}function on(g){return Ai(g)&&yn(g.length)&&!!me[Ti(g)]}function an(g){if(!dn(g))return Pi(g);var b=[];for(var $ in Object(g))qe.call(g,$)&&$!="constructor"&&b.push($);return b}function Ki(g,b,$,Y,Ve,le){var Xe=$&o,Ct=g.length,Pe=b.length;if(Ct!=Pe&&!(Xe&&Pe>Ct))return!1;var Ge=le.get(g);if(Ge&&le.get(b))return Ge==b;var wt=-1,rr=!0,Nt=$&l?new Gi:void 0;for(le.set(g,b),le.set(b,g);++wt<Ct;){var Ze=g[wt],Jt=b[wt];if(Y)var Tr=Xe?Y(Jt,Ze,wt,b,g,le):Y(Ze,Jt,wt,g,b,le);if(Tr!==void 0){if(Tr)continue;rr=!1;break}if(Nt){if(!xe(b,function(yr,Ur){if(!nt(Nt,Ur)&&(Ze===yr||Ve(Ze,yr,$,Y,le)))return Nt.push(Ur)})){rr=!1;break}}else if(!(Ze===Jt||Ve(Ze,Jt,$,Y,le))){rr=!1;break}}return le.delete(g),le.delete(b),rr}function Mo(g,b,$,Y,Ve,le,Xe){switch($){case Oe:if(g.byteLength!=b.byteLength||g.byteOffset!=b.byteOffset)return!1;g=g.buffer,b=b.buffer;case Ee:return!(g.byteLength!=b.byteLength||!le(new Kt(g),new Kt(b)));case D:case H:case oe:return gn(+g,+b);case k:return g.name==b.name&&g.message==b.message;case he:case M:return g==b+"";case K:var Ct=Je;case A:var Pe=Y&o;if(Ct||(Ct=ot),g.size!=b.size&&!Pe)return!1;var Ge=Xe.get(g);if(Ge)return Ge==b;Y|=l,Xe.set(g,b);var wt=Ki(Ct(g),Ct(b),Y,Ve,le,Xe);return Xe.delete(g),wt;case W:if(vt)return vt.call(g)==vt.call(b)}return!1}function cn(g,b,$,Y,Ve,le){var Xe=$&o,Ct=Wi(g),Pe=Ct.length,Ge=Wi(b),wt=Ge.length;if(Pe!=wt&&!Xe)return!1;for(var rr=Pe;rr--;){var Nt=Ct[rr];if(!(Xe?Nt in b:qe.call(b,Nt)))return!1}var Ze=le.get(g);if(Ze&&le.get(b))return Ze==b;var Jt=!0;le.set(g,b),le.set(b,g);for(var Tr=Xe;++rr<Pe;){Nt=Ct[rr];var yr=g[Nt],Ur=b[Nt];if(Y)var ws=Xe?Y(Ur,yr,Nt,b,g,le):Y(yr,Ur,Nt,g,b,le);if(!(ws===void 0?yr===Ur||Ve(yr,Ur,$,Y,le):ws)){Jt=!1;break}Tr||(Tr=Nt=="constructor")}if(Jt&&!Tr){var Ci=g.constructor,Mt=b.constructor;Ci!=Mt&&"constructor"in g&&"constructor"in b&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Mt=="function"&&Mt instanceof Mt)&&(Jt=!1)}return le.delete(g),le.delete(b),Jt}function Wi(g){return ys(g,ko,hn)}function hi(g,b){var $=g.__data__;return fn(b)?$[typeof b=="string"?"string":"hash"]:$.map}function ur(g,b){var $=Le(g,b);return qo($)?$:void 0}function un(g){var b=qe.call(g,Wt),$=g[Wt];try{g[Wt]=void 0;var Y=!0}catch{}var Ve=Ft.call(g);return Y&&(b?g[Wt]=$:delete g[Wt]),Ve}var hn=Br?function(g){return g==null?[]:(g=Object(g),Ce(Br(g),function(b){return tr.call(g,b)}))}:Be,Mr=Ti;(lt&&Mr(new lt(new ArrayBuffer(1)))!=Oe||tt&&Mr(new tt)!=K||ft&&Mr(ft.resolve())!=pe||pt&&Mr(new pt)!=A||at&&Mr(new at)!=te)&&(Mr=function(g){var b=Ti(g),$=b==de?g.constructor:void 0,Y=$?Gr($):"";if(Y)switch(Y){case Pt:return Oe;case Rt:return K;case dt:return pe;case Tt:return A;case gt:return te}return b});function ln(g,b){return b=b??d,!!b&&(typeof g=="number"||$r.test(g))&&g>-1&&g%1==0&&g<b}function fn(g){var b=typeof g;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?g!=="__proto__":g===null}function pn(g){return!!St&&St in g}function dn(g){var b=g&&g.constructor,$=typeof b=="function"&&b.prototype||Ne;return g===$}function Uo(g){return Ft.call(g)}function Gr(g){if(g!=null){try{return ht.call(g)}catch{}try{return g+""}catch{}}return""}function gn(g,b){return g===b||g!==g&&b!==b}var vn=_s(function(){return arguments}())?_s:function(g){return Ai(g)&&qe.call(g,"callee")&&!tr.call(g,"callee")},Ji=Array.isArray;function jo(g){return g!=null&&yn(g.length)&&!Yi(g)}var ms=ui||He;function Ho(g,b){return Oi(g,b)}function Yi(g){if(!_n(g))return!1;var b=Ti(g);return b==z||b==j||b==x||b==ue}function yn(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=d}function _n(g){var b=typeof g;return g!=null&&(b=="object"||b=="function")}function Ai(g){return g!=null&&typeof g=="object"}var mn=ye?_t(ye):on;function ko(g){return jo(g)?sn(g):an(g)}function Be(){return[]}function He(){return!1}u.exports=Ho})(po,po.exports);var am=po.exports;const cm=u1(am);function um(u,i){if(u.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<u.length;o++){var l=u.charAt(o),d=l.charCodeAt(0);if(r[d]!==255)throw new TypeError(l+" is ambiguous");r[d]=o}var v=u.length,m=u.charAt(0),x=Math.log(v)/Math.log(256),D=Math.log(256)/Math.log(v);function H(j){if(j instanceof Uint8Array||(ArrayBuffer.isView(j)?j=new Uint8Array(j.buffer,j.byteOffset,j.byteLength):Array.isArray(j)&&(j=Uint8Array.from(j))),!(j instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(j.length===0)return"";for(var K=0,oe=0,be=0,de=j.length;be!==de&&j[be]===0;)be++,K++;for(var pe=(de-be)*D+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=j[be],A=0,M=pe-1;(he!==0||A<oe)&&M!==-1;M--,A++)he+=256*ue[M]>>>0,ue[M]=he%v>>>0,he=he/v>>>0;if(he!==0)throw new Error("Non-zero carry");oe=A,be++}for(var W=pe-oe;W!==pe&&ue[W]===0;)W++;for(var ge=m.repeat(K);W<pe;++W)ge+=u.charAt(ue[W]);return ge}function k(j){if(typeof j!="string")throw new TypeError("Expected String");if(j.length===0)return new Uint8Array;var K=0;if(j[K]!==" "){for(var oe=0,be=0;j[K]===m;)oe++,K++;for(var de=(j.length-K)*x+1>>>0,pe=new Uint8Array(de);j[K];){var ue=r[j.charCodeAt(K)];if(ue===255)return;for(var he=0,A=de-1;(ue!==0||he<be)&&A!==-1;A--,he++)ue+=v*pe[A]>>>0,pe[A]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,K++}if(j[K]!==" "){for(var M=de-be;M!==de&&pe[M]===0;)M++;for(var W=new Uint8Array(oe+(de-M)),ge=oe;M!==de;)W[ge++]=pe[M++];return W}}}function z(j){var K=k(j);if(K)return K;throw new Error(`Non-${i} character`)}return{encode:H,decodeUnsafe:k,decode:z}}var hm=um,lm=hm;const cf=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},fm=u=>new TextEncoder().encode(u),pm=u=>new TextDecoder().decode(u);class dm{constructor(i,r,n){this.name=i,this.prefix=r,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class gm{constructor(i,r,n){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return uf(this,i)}}class vm{constructor(i){this.decoders=i}or(i){return uf(this,i)}decode(i){const r=i[0],n=this.decoders[r];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const uf=(u,i)=>new vm({...u.decoders||{[u.prefix]:u},...i.decoders||{[i.prefix]:i}});class ym{constructor(i,r,n,o){this.name=i,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new dm(i,r,n),this.decoder=new gm(i,r,o)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const wo=({name:u,prefix:i,encode:r,decode:n})=>new ym(u,i,r,n),Zs=({prefix:u,name:i,alphabet:r})=>{const{encode:n,decode:o}=lm(r,i);return wo({prefix:u,name:i,encode:n,decode:l=>cf(o(l))})},_m=(u,i,r,n)=>{const o={};for(let D=0;D<i.length;++D)o[i[D]]=D;let l=u.length;for(;u[l-1]==="=";)--l;const d=new Uint8Array(l*r/8|0);let v=0,m=0,x=0;for(let D=0;D<l;++D){const H=o[u[D]];if(H===void 0)throw new SyntaxError(`Non-${n} character`);m=m<<r|H,v+=r,v>=8&&(v-=8,d[x++]=255&m>>v)}if(v>=r||255&m<<8-v)throw new SyntaxError("Unexpected end of data");return d},mm=(u,i,r)=>{const n=i[i.length-1]==="=",o=(1<<r)-1;let l="",d=0,v=0;for(let m=0;m<u.length;++m)for(v=v<<8|u[m],d+=8;d>r;)d-=r,l+=i[o&v>>d];if(d&&(l+=i[o&v<<r-d]),n)for(;l.length*r&7;)l+="=";return l},zt=({name:u,prefix:i,bitsPerChar:r,alphabet:n})=>wo({prefix:i,name:u,encode(o){return mm(o,n,r)},decode(o){return _m(o,n,r,u)}}),wm=wo({prefix:"\0",name:"identity",encode:u=>pm(u),decode:u=>fm(u)});var bm=Object.freeze({__proto__:null,identity:wm});const Em=zt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Im=Object.freeze({__proto__:null,base2:Em});const xm=zt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Sm=Object.freeze({__proto__:null,base8:xm});const Pm=Zs({prefix:"9",name:"base10",alphabet:"0123456789"});var Rm=Object.freeze({__proto__:null,base10:Pm});const Tm=zt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Om=zt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Am=Object.freeze({__proto__:null,base16:Tm,base16upper:Om});const Cm=zt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Nm=zt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Dm=zt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fm=zt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lm=zt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$m=zt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qm=zt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Mm=zt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Um=zt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jm=Object.freeze({__proto__:null,base32:Cm,base32upper:Nm,base32pad:Dm,base32padupper:Fm,base32hex:Lm,base32hexupper:$m,base32hexpad:qm,base32hexpadupper:Mm,base32z:Um});const Hm=Zs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),km=Zs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zm=Object.freeze({__proto__:null,base36:Hm,base36upper:km});const Bm=Zs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Vm=Zs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gm=Object.freeze({__proto__:null,base58btc:Bm,base58flickr:Vm});const Km=zt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wm=zt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jm=zt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ym=zt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Qm=Object.freeze({__proto__:null,base64:Km,base64pad:Wm,base64url:Jm,base64urlpad:Ym});const hf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Xm=hf.reduce((u,i,r)=>(u[r]=i,u),[]),Zm=hf.reduce((u,i,r)=>(u[i.codePointAt(0)]=r,u),[]);function ew(u){return u.reduce((i,r)=>(i+=Xm[r],i),"")}function tw(u){const i=[];for(const r of u){const n=Zm[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(n)}return new Uint8Array(i)}const rw=wo({prefix:"🚀",name:"base256emoji",encode:ew,decode:tw});var iw=Object.freeze({__proto__:null,base256emoji:rw}),sw=lf,sl=128,nw=127,ow=~nw,aw=Math.pow(2,31);function lf(u,i,r){i=i||[],r=r||0;for(var n=r;u>=aw;)i[r++]=u&255|sl,u/=128;for(;u&ow;)i[r++]=u&255|sl,u>>>=7;return i[r]=u|0,lf.bytes=r-n+1,i}var cw=lc,uw=128,nl=127;function lc(u,n){var r=0,n=n||0,o=0,l=n,d,v=u.length;do{if(l>=v)throw lc.bytes=0,new RangeError("Could not decode varint");d=u[l++],r+=o<28?(d&nl)<<o:(d&nl)*Math.pow(2,o),o+=7}while(d>=uw);return lc.bytes=l-n,r}var hw=Math.pow(2,7),lw=Math.pow(2,14),fw=Math.pow(2,21),pw=Math.pow(2,28),dw=Math.pow(2,35),gw=Math.pow(2,42),vw=Math.pow(2,49),yw=Math.pow(2,56),_w=Math.pow(2,63),mw=function(u){return u<hw?1:u<lw?2:u<fw?3:u<pw?4:u<dw?5:u<gw?6:u<vw?7:u<yw?8:u<_w?9:10},ww={encode:sw,decode:cw,encodingLength:mw},ff=ww;const ol=(u,i,r=0)=>(ff.encode(u,i,r),i),al=u=>ff.encodingLength(u),fc=(u,i)=>{const r=i.byteLength,n=al(u),o=n+al(r),l=new Uint8Array(o+r);return ol(u,l,0),ol(r,l,n),l.set(i,o),new bw(u,r,i,l)};class bw{constructor(i,r,n,o){this.code=i,this.size=r,this.digest=n,this.bytes=o}}const pf=({name:u,code:i,encode:r})=>new Ew(u,i,r);class Ew{constructor(i,r,n){this.name=i,this.code=r,this.encode=n}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?fc(this.code,r):r.then(n=>fc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const df=u=>async i=>new Uint8Array(await crypto.subtle.digest(u,i)),Iw=pf({name:"sha2-256",code:18,encode:df("SHA-256")}),xw=pf({name:"sha2-512",code:19,encode:df("SHA-512")});var Sw=Object.freeze({__proto__:null,sha256:Iw,sha512:xw});const gf=0,Pw="identity",vf=cf,Rw=u=>fc(gf,vf(u)),Tw={code:gf,name:Pw,encode:vf,digest:Rw};var Ow=Object.freeze({__proto__:null,identity:Tw});new TextEncoder,new TextDecoder;const cl={...bm,...Im,...Sm,...Rm,...Am,...jm,...zm,...Gm,...Qm,...iw};({...Sw,...Ow});function yf(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function Aw(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?yf(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function _f(u,i,r,n){return{name:u,prefix:i,encoder:{name:u,prefix:i,encode:r},decoder:{decode:n}}}const ul=_f("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),ec=_f("ascii","a",u=>{let i="a";for(let r=0;r<u.length;r++)i+=String.fromCharCode(u[r]);return i},u=>{u=u.substring(1);const i=Aw(u.length);for(let r=0;r<u.length;r++)i[r]=u.charCodeAt(r);return i}),Cw={utf8:ul,"utf-8":ul,hex:cl.base16,latin1:ec,ascii:ec,binary:ec,...cl};function Nw(u,i="utf8"){const r=Cw[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?yf(globalThis.Buffer.from(u,"utf-8")):r.decoder.decode(`${r.prefix}${u}`)}const mf="wc",Dw=2,xc="core",Ei=`${mf}@2:${xc}:`,Fw={name:xc,logger:"error"},Lw={database:":memory:"},$w="crypto",hl="client_ed25519_seed",qw=re.ONE_DAY,Mw="keychain",Uw="0.3",jw="messages",Hw="0.3",kw=re.SIX_HOURS,zw="publisher",wf="irn",Bw="error",bf="wss://relay.walletconnect.com",ll="wss://relay.walletconnect.org",Vw="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Gw="_subscription",si={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Kw=re.ONE_SECOND,Ww="2.10.2",Jw=1e4,Yw="0.3",Qw="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Xw="subscription",Zw="0.3",eb=re.FIVE_SECONDS*1e3,tb="pairing",rb="0.3",Hs={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},Ks={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},zr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},ib="history",sb="0.3",nb="expirer",Sr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ob="0.3",tc="verify-api",lo="https://verify.walletconnect.com",fl="https://verify.walletconnect.org";class ab{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=Mw,this.version=Uw,this.initialized=!1,this.storagePrefix=Ei,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:l}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Te.generateChildLogger(r,this.name)}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Bl(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class cb{constructor(i,r,n){this.core=i,this.logger=r,this.name=$w,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),l=Jh(o);return Zl(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=f1();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const l=await this.getClientSeed(),d=Jh(l),v=uc();return await M_(v,o,qw,d)},this.generateSharedKey=(o,l,d)=>{this.isInitialized();const v=this.getPrivateKey(o),m=p1(v,l);return this.setSymKey(m,d)},this.setSymKey=async(o,l)=>{this.isInitialized();const d=l||d1(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,l,d)=>{this.isInitialized();const v=g1(d),m=Qs(l);if(Th(v)){const k=v.senderPublicKey,z=v.receiverPublicKey;o=await this.generateSharedKey(k,z)}const x=this.getSymKey(o),{type:D,senderPublicKey:H}=v;return v1({type:D,symKey:x,message:m,senderPublicKey:H})},this.decode=async(o,l,d)=>{this.isInitialized();const v=y1(l,d);if(Th(v)){const m=v.receiverPublicKey,x=v.senderPublicKey;o=await this.generateSharedKey(m,x)}try{const m=this.getSymKey(o),x=_1({symKey:m,encoded:l});return _c(x)}catch(m){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=o=>{const l=Oh(o);return m1(l.type)},this.getPayloadSenderPublicKey=o=>{const l=Oh(o);return l.senderPublicKey?vo(l.senderPublicKey,w1):void 0},this.core=i,this.logger=Te.generateChildLogger(r,this.name),this.keychain=n||new ab(this.core,this.logger)}get context(){return Te.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(hl)}catch{i=uc(),await this.keychain.set(hl,i)}return Nw(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class ub extends d_{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=jw,this.version=Hw,this.initialized=!1,this.storagePrefix=Ei,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const l=ps(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[l]<"u"||(d[l]=o,this.messages.set(n,d),await this.persist()),l},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const l=this.get(n),d=ps(o);return typeof l[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Te.generateChildLogger(i,this.name),this.core=r}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Bl(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class hb extends g_{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new Pr.EventEmitter,this.name=zw,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,l)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}});try{const v=(l==null?void 0:l.ttl)||kw,m=hc(l),x=(l==null?void 0:l.prompt)||!1,D=(l==null?void 0:l.tag)||0,H=(l==null?void 0:l.id)||nf().toString(),k={topic:n,message:o,opts:{ttl:v,relay:m,prompt:x,tag:D,id:H}},z=setTimeout(()=>this.queue.set(H,k),this.publishTimeout);try{await await Ys(this.rpcPublish(n,o,v,m,x,D,H),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(H),this.relayer.events.emit(Gt.publish,k)}catch(j){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=l==null?void 0:l.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(H),j;return}finally{clearTimeout(z)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}})}catch(v){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(v),v}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=i,this.logger=Te.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Te.getLoggerContext(this.logger)}rpcPublish(i,r,n,o,l,d,v){var m,x,D,H;const k={method:uo(o.protocol).publish,params:{topic:i,message:r,ttl:n,prompt:l,tag:d},id:v};return bi((m=k.params)==null?void 0:m.prompt)&&((x=k.params)==null||delete x.prompt),bi((D=k.params)==null?void 0:D.tag)&&((H=k.params)==null||delete H.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:k}),this.relayer.request(k)}removeRequestFromQueue(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:n,opts:o}=i;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,i=>{this.removeRequestFromQueue(i.id.toString())})}}class lb{constructor(){this.map=new Map,this.set=(i,r)=>{const n=this.get(i);this.exists(i,r)||this.map.set(i,[...n,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,r))return;const o=n.filter(l=>l!==r);if(!o.length){this.map.delete(i);return}this.map.set(i,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var fb=Object.defineProperty,pb=Object.defineProperties,db=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,gb=Object.prototype.hasOwnProperty,vb=Object.prototype.propertyIsEnumerable,dl=(u,i,r)=>i in u?fb(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ks=(u,i)=>{for(var r in i||(i={}))gb.call(i,r)&&dl(u,r,i[r]);if(pl)for(var r of pl(i))vb.call(i,r)&&dl(u,r,i[r]);return u},rc=(u,i)=>pb(u,db(i));class yb extends __{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new lb,this.events=new Pr.EventEmitter,this.name=Xw,this.version=Zw,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ei,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const l=hc(o),d={topic:n,relay:l};this.pending.set(n,d);const v=await this.rpcSubscribe(n,l);return this.onSubscribe(v,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),v}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,l)=>{const d=new re.Watch;d.start(this.pendingSubscriptionWatchLabel);const v=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=eb&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Te.generateChildLogger(r,this.name),this.clientId=""}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let n=!1;try{n=this.getSubscription(i).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const n=this.topicMap.get(i);await Promise.all(n.map(async o=>await this.unsubscribeById(i,o,r)))}async unsubscribeById(i,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}});try{const o=hc(n);await this.rpcUnsubscribe(i,r,o);const l=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(i,r){const n={method:uo(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Ys(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return ps(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,n={method:uo(r.protocol).batchSubscribe,params:{topics:i.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Ys(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(i,r,n){const o={method:uo(n.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(i,r){this.setSubscription(i,rc(ks({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,ks({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,ks({},r)),this.topicMap.set(r.topic,i),this.events.emit(Dr.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(Dr.deleted,rc(ks({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Dr.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);gs(r)&&this.onBatchSubscribe(r.map((n,o)=>rc(ks({},i[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async i=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(Dr.deleted,async i=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var _b=Object.defineProperty,gl=Object.getOwnPropertySymbols,mb=Object.prototype.hasOwnProperty,wb=Object.prototype.propertyIsEnumerable,vl=(u,i,r)=>i in u?_b(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,bb=(u,i)=>{for(var r in i||(i={}))mb.call(i,r)&&vl(u,r,i[r]);if(gl)for(var r of gl(i))wb.call(i,r)&&vl(u,r,i[r]);return u};class Eb extends v_{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Pr.EventEmitter,this.name=Vw,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Gt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(si.payload,this.onPayloadHandler),this.provider.on(si.connect,this.onConnectHandler),this.provider.on(si.disconnect,this.onDisconnectHandler),this.provider.on(si.error,this.onProviderErrorHandler)},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Te.generateChildLogger(i.logger,this.name):Te.pino(Te.getDefaultLoggerOptions({level:i.logger||Bw})),this.messages=new ub(this.logger,i.core),this.subscriber=new yb(this,this.logger),this.publisher=new hb(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||bf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ll}...`),await this.restartTransport(ll)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Jw)}get context(){return Te.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,n){this.isInitialized(),await this.publisher.publish(i,r,n),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";if(o)return o;let l;const d=v=>{v.topic===i&&(this.subscriber.off(Dr.created,d),l())};return await Promise.all([new Promise(v=>{l=v,this.subscriber.on(Dr.created,d)}),new Promise(async v=>{o=await this.subscriber.subscribe(i,r),v()})]),o}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ys(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(i){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){i&&i!==this.relayUrl&&(this.relayUrl=i,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Ys(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(si.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(i){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=i||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ah())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ai(new om(b1({sdkVersion:Ww,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:n}=i;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(i){const{topic:r,message:n}=i;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),Ic(i)){if(!i.method.endsWith(Gw))return;const r=i.params,{topic:n,message:o,publishedAt:l}=r.data,d={topic:n,message:o,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(bb({type:"event",event:r.id},d)),this.events.emit(r.id,d),await this.acknowledgePayload(i),await this.onMessageEvent(d)}else mo(i)&&this.events.emit(Gt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Gt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=Ec(i.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(si.payload,this.onPayloadHandler),this.provider.off(si.connect,this.onConnectHandler),this.provider.off(si.disconnect,this.onDisconnectHandler),this.provider.off(si.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let i=await Ah();E1(async r=>{this.initialized&&i!==r&&(i=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(i=>this.logger.error(i))},re.toMiliseconds(Kw)))}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Ib=Object.defineProperty,yl=Object.getOwnPropertySymbols,xb=Object.prototype.hasOwnProperty,Sb=Object.prototype.propertyIsEnumerable,_l=(u,i,r)=>i in u?Ib(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ml=(u,i)=>{for(var r in i||(i={}))xb.call(i,r)&&_l(u,r,i[r]);if(yl)for(var r of yl(i))Sb.call(i,r)&&_l(u,r,i[r]);return u};class bo extends y_{constructor(i,r,n,o=Ei,l=void 0){super(i,r,n,o),this.core=i,this.logger=r,this.name=n,this.map=new Map,this.version=Yw,this.cached=[],this.initialized=!1,this.storagePrefix=Ei,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!bi(d)?this.map.set(this.getKey(d),d):h1(d)?this.map.set(d.id,d):l1(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,v)=>{this.isInitialized(),this.map.has(d)?await this.update(d,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:v}),this.map.set(d,v),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(v=>Object.keys(d).every(m=>cm(v[m],d[m]))):this.values),this.update=async(d,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:v});const m=ml(ml({},this.getData(d)),v);this.map.set(d,m),await this.persist()},this.delete=async(d,v)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:v}),this.map.delete(d),await this.persist())},this.logger=Te.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=l}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Pb{constructor(i,r){this.core=i,this.logger=r,this.name=tb,this.version=rb,this.events=new yc,this.initialized=!1,this.storagePrefix=Ei,this.ignoredPayloadTypes=[jl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=uc(),o=await this.core.crypto.setSymKey(n),l=Fr(re.FIVE_MINUTES),d={protocol:wf},v={topic:o,expiry:l,relay:d,active:!1},m=I1({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,v),await this.core.relayer.subscribe(o),this.core.expirer.set(o,l),{topic:o,uri:m}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:l,relay:d}=x1(n.uri);let v;if(this.pairings.keys.includes(o)&&(v=this.pairings.get(o),v.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(l,o),await this.core.relayer.subscribe(o,{relay:d}));const m=Fr(re.FIVE_MINUTES),x={topic:o,relay:d,expiry:m,active:!1};return await this.pairings.set(o,x),this.core.expirer.set(o,m),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Ks.create,x),x},this.activate=async({topic:n})=>{this.isInitialized();const o=Fr(re.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const l=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:v,reject:m}=hs();this.events.once(Dt("pairing_ping",l),({error:x})=>{x?m(x):v()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,l)=>{const d=ds(o,l),v=await this.core.crypto.encode(n,d),m=Hs[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,v,m),d.id},this.sendResult=async(n,o,l)=>{const d=Ec(n,l),v=await this.core.crypto.encode(o,d),m=await this.core.history.get(o,n),x=Hs[m.request.method].res;await this.core.relayer.publish(o,v,x),await this.core.history.resolve(d)},this.sendError=async(n,o,l)=>{const d=_o(n,l),v=await this.core.crypto.encode(o,d),m=await this.core.history.get(o,n),x=Hs[m.request.method]?Hs[m.request.method].res:Hs.unregistered_method.res;await this.core.relayer.publish(o,v,x),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>wi(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:l}=n;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(o,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,l);default:return this.onUnknownRpcMethodRequest(o,l)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:l}=n,d=(await this.core.history.get(o,l.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,l);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:l}=o;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit(Ks.ping,{id:l,topic:n})}catch(d){await this.sendError(l,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:l}=o;setTimeout(()=>{oi(o)?this.events.emit(Dt("pairing_ping",l),{}):Lr(o)&&this.events.emit(Dt("pairing_ping",l),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:l}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Ks.delete,{id:l,topic:n})}catch(d){await this.sendError(l,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:l,method:d}=o;try{if(this.registeredMethods.includes(d))return;const v=er("WC_METHOD_UNSUPPORTED",d);await this.sendError(l,n,v),this.logger.error(v)}catch(v){await this.sendError(l,n,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!cr(n)){const{message:o}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!S1(n.uri)){const{message:o}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!cr(n)){const{message:l}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!cr(n)){const{message:l}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!ls(n,!1)){const{message:o}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(wi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=i,this.logger=Te.generateChildLogger(r,this.name),this.pairings=new bo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Te.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async i=>{const{topic:r,message:n}=i;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{Ic(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):mo(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Sr.expired,async i=>{const{topic:r}=Hl(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ks.expire,{topic:r}))})}}class Rb extends p_{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new Pr.EventEmitter,this.name=ib,this.version=sb,this.cached=[],this.initialized=!1,this.storagePrefix=Ei,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:l}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:l,expiry:Fr(re.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(zr.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Lr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(zr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(l=>{if(l.topic===n){if(typeof o<"u"&&l.id!==o)return;this.records.delete(l.id),this.events.emit(zr.deleted,l)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Te.generateChildLogger(r,this.name)}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:ds(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(zr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(zr.created,i=>{const r=zr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(zr.updated,i=>{const r=zr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(zr.deleted,i=>{const r=zr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{re.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Tb extends m_{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new Pr.EventEmitter,this.name=nb,this.version=ob,this.cached=[],this.initialized=!1,this.storagePrefix=Ei,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const l=this.formatTarget(n),d={target:l,expiry:o};this.expirations.set(l,d),this.checkExpiry(l,d),this.events.emit(Sr.created,{target:l,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),l=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Sr.deleted,{target:o,expiration:l})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Te.generateChildLogger(r,this.name)}get context(){return Te.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return P1(i);if(typeof i=="number")return R1(i);const{message:r}=X("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Sr.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(i,r){const{expiry:n}=r;re.toMiliseconds(n)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(Sr.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Sr.created,i=>{const r=Sr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Sr.expired,i=>{const r=Sr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Sr.deleted,i=>{const r=Sr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Ob extends w_{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=tc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||T1()||!kl())return;const n=lo;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=fl;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=(n==null?void 0:n.verifyUrl)||lo;let l;try{l=await this.fetchAttestation(n.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(d),l=await this.fetchAttestation(n.attestationId,fl)}return l},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const l=this.startAbortTimer(re.ONE_SECOND*2),d=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(l),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(l=>{if(document.getElementById(tc))return l();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=tc,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=l}),new Promise((l,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},re.toMiliseconds(re.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Te.generateChildLogger(r,this.name),this.verifyUrl=lo,this.abortController=new AbortController,this.isDevEnv=O1()&&{GITHUB_STATE:"/home/runner/work/_temp/_runner_file_commands/save_state_ee1cb818-b804-4308-b3d8-9b46fe1f9b81",STATS_TRP:"true",DEPLOYMENT_BASEPATH:"/opt/runner",DOTNET_NOLOGO:"1",USER:"runner",npm_config_user_agent:"pnpm/9.1.0 npm/? node/v18.20.2 linux x64",CI:"true",GH_TOKEN:"ghs_cMmImq4ICVUvIuRTmbo3ObsLBJ0lDM0Tz2d0",RUNNER_ENVIRONMENT:"github-hosted",GITHUB_ENV:"/home/runner/work/_temp/_runner_file_commands/set_env_ee1cb818-b804-4308-b3d8-9b46fe1f9b81",PIPX_HOME:"/opt/pipx",npm_package_devDependencies_vite:"^4.4.5",npm_node_execpath:"/opt/hostedtoolcache/node/18.20.2/x64/bin/node",JAVA_HOME_8_X64:"/usr/lib/jvm/temurin-8-jdk-amd64",SHLVL:"1",npm_package_dependencies__radix_ui_react_tooltip:"^1.0.7",npm_package_dependencies_wagmi:"1.4.5",HOME:"/home/runner",RUNNER_TEMP:"/home/runner/work/_temp",GITHUB_EVENT_PATH:"/home/runner/work/_temp/_github_workflow/event.json",JAVA_HOME_11_X64:"/usr/lib/jvm/temurin-11-jdk-amd64",PIPX_BIN_DIR:"/opt/pipx_bin",GITHUB_REPOSITORY_OWNER:"CryptITAustria",GRADLE_HOME:"/usr/share/gradle-8.7",ANDROID_NDK_LATEST_HOME:"/usr/local/lib/android/sdk/ndk/26.3.11579264",JAVA_HOME_21_X64:"/usr/lib/jvm/temurin-21-jdk-amd64",STATS_RDCL:"true",GITHUB_RETENTION_DAYS:"90",GITHUB_REPOSITORY_OWNER_ID:"98359404",POWERSHELL_DISTRIBUTION_CHANNEL:"GitHub-Actions-ubuntu22",AZURE_EXTENSION_DIR:"/opt/az/azcliextensions",GITHUB_HEAD_REF:"",npm_package_dependencies_react_icons:"^4.11.0",SYSTEMD_EXEC_PID:"590",npm_package_devDependencies_eslint_plugin_react_hooks:"^4.6.0",GITHUB_GRAPHQL_URL:"https://api.github.com/graphql",npm_package_dependencies_react_router_dom:"^6.16.0",npm_package_devDependencies_vite_plugin_svgr:"^3.2.0",GOROOT_1_20_X64:"/opt/hostedtoolcache/go/1.20.14/x64",NVM_DIR:"/home/runner/.nvm",npm_package_devDependencies__types_react_dom:"^18.2.7",DOTNET_SKIP_FIRST_TIME_EXPERIENCE:"1",GOROOT_1_21_X64:"/opt/hostedtoolcache/go/1.21.9/x64",JAVA_HOME_17_X64:"/usr/lib/jvm/temurin-17-jdk-amd64",ImageVersion:"20240422.1.0",npm_package_scripts_dev:"vite",RUNNER_OS:"Linux",GITHUB_API_URL:"https://api.github.com",GOROOT_1_22_X64:"/opt/hostedtoolcache/go/1.22.2/x64",SWIFT_PATH:"/usr/share/swift/usr/bin",npm_package_type:"module",npm_package_scripts_clean:"rimraf dist && rimraf tsconfig.tsbuildinfo && rimraf tsconfig.node.tsbuildinfo && rimraf vite.config.js && rimraf vite.config.d.ts",npm_package_dependencies__sentry_ui:"workspace:*",npm_package_devDependencies__vitejs_plugin_react:"^4.0.4",RUNNER_USER:"runner",STATS_V3PS:"true",CHROMEWEBDRIVER:"/usr/local/share/chromedriver-linux64",JOURNAL_STREAM:"8:17294",GITHUB_WORKFLOW:"Release",_:"/opt/hostedtoolcache/node/18.20.2/x64/bin/pnpm",npm_package_private:"true",npm_package_scripts_lint:"eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",npm_config_registry:"https://registry.npmjs.org/",ACTIONS_RUNNER_ACTION_ARCHIVE_CACHE:"/opt/actionarchivecache",STATS_D:"true",GITHUB_RUN_ID:"9052548954",STATS_VMFE:"true",GITHUB_REF_TYPE:"tag",BOOTSTRAP_HASKELL_NONINTERACTIVE:"1",GITHUB_WORKFLOW_SHA:"240e06b5fa1a7f4315afedb2f01d8e7c129d0ebd",GITHUB_BASE_REF:"",ImageOS:"ubuntu22",npm_package_devDependencies_eslint_plugin_react_refresh:"^0.4.3",GITHUB_WORKFLOW_REF:"CryptITAustria/sentry/.github/workflows/release.yml@refs/tags/1.1.10-sepolia-106",PERFLOG_LOCATION_SETTING:"RUNNER_PERFLOG",GITHUB_ACTION_REPOSITORY:"",npm_package_dependencies_axios:"^1.6.2",npm_config_node_gyp:"/opt/hostedtoolcache/node/18.20.2/x64/lib/node_modules/pnpm/dist/node_modules/node-gyp/bin/node-gyp.js",PATH:"/home/runner/work/sentry/sentry/apps/web-connect/node_modules/.bin:/opt/hostedtoolcache/node/18.20.2/x64/lib/node_modules/pnpm/dist/node-gyp-bin:/home/runner/work/sentry/sentry/node_modules/.bin:/home/runner/work/sentry/sentry/node_modules/.bin:/opt/hostedtoolcache/node/18.20.2/x64/lib/node_modules/pnpm/dist/node-gyp-bin:/home/runner/work/sentry/sentry/node_modules/.bin:/opt/hostedtoolcache/node/18.20.2/x64/bin:/snap/bin:/home/runner/.local/bin:/opt/pipx_bin:/home/runner/.cargo/bin:/home/runner/.config/composer/vendor/bin:/usr/local/.ghcup/bin:/home/runner/.dotnet/tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin",ANT_HOME:"/usr/share/ant",DOTNET_MULTILEVEL_LOOKUP:"0",RUNNER_TRACKING_ID:"github_dba68128-036c-489c-9195-5dcb5c096a73",INVOCATION_ID:"2d4d70f2f54c49daa9dc2b43a84bc422",RUNNER_TOOL_CACHE:"/opt/hostedtoolcache",NODE:"/opt/hostedtoolcache/node/18.20.2/x64/bin/node",npm_package_name:"@sentry/web-connect",GITHUB_ACTION:"__run_5",GITHUB_RUN_NUMBER:"44",GITHUB_TRIGGERING_ACTOR:"CryptITAustria",RUNNER_ARCH:"X64",XDG_RUNTIME_DIR:"/run/user/1001",AGENT_TOOLSDIRECTORY:"/opt/hostedtoolcache",npm_package_dependencies_viem:"^1.15.1",npm_config_frozen_lockfile:"",npm_package_dependencies__sentry_core:"workspace:*",LANG:"C.UTF-8",VCPKG_INSTALLATION_ROOT:"/usr/local/share/vcpkg",npm_package_dependencies_react_dom:"^18.2.0",CONDA:"/usr/share/miniconda",RUNNER_NAME:"GitHub Actions 10",XDG_CONFIG_HOME:"/home/runner/.config",STATS_VMD:"true",GITHUB_REF_NAME:"1.1.10-sepolia-106",GITHUB_REPOSITORY:"CryptITAustria/sentry",STATS_D_D:"true",npm_package_dependencies_react_cookie_consent:"^9.0.0",npm_lifecycle_script:"tsc --build && vite build && copyfiles -u 1 dist/* dist/**/* ../sentry-client-desktop/public/web",STATS_UE:"true",ANDROID_NDK_ROOT:"/usr/local/lib/android/sdk/ndk/25.2.9519653",GITHUB_ACTION_REF:"",DEBIAN_FRONTEND:"noninteractive",GITHUB_REPOSITORY_ID:"734051160",GITHUB_ACTIONS:"true",npm_package_version:"1.0.0",npm_package_devDependencies__types_react:"^18.2.15",npm_lifecycle_event:"build",NODE_PATH:"/home/runner/work/sentry/sentry/node_modules/.pnpm/vite@4.4.9/node_modules/vite/bin/node_modules:/home/runner/work/sentry/sentry/node_modules/.pnpm/vite@4.4.9/node_modules/vite/node_modules:/home/runner/work/sentry/sentry/node_modules/.pnpm/vite@4.4.9/node_modules:/home/runner/work/sentry/sentry/node_modules/.pnpm/node_modules",GITHUB_REF_PROTECTED:"false",npm_package_scripts_build:"tsc --build && vite build && copyfiles -u 1 dist/* dist/**/* ../sentry-client-desktop/public/web",GITHUB_WORKSPACE:"/home/runner/work/sentry/sentry",ACCEPT_EULA:"Y",GITHUB_JOB:"build",RUNNER_PERFLOG:"/home/runner/perflog",GITHUB_SHA:"240e06b5fa1a7f4315afedb2f01d8e7c129d0ebd",GITHUB_RUN_ATTEMPT:"1",GITHUB_REF:"refs/tags/1.1.10-sepolia-106",GITHUB_ACTOR:"CryptITAustria",ANDROID_SDK_ROOT:"/usr/local/lib/android/sdk",LEIN_HOME:"/usr/local/lib/lein",GITHUB_PATH:"/home/runner/work/_temp/_runner_file_commands/add_path_ee1cb818-b804-4308-b3d8-9b46fe1f9b81",JAVA_HOME:"/usr/lib/jvm/temurin-11-jdk-amd64",PWD:"/home/runner/work/sentry/sentry/apps/web-connect",GITHUB_ACTOR_ID:"98359404",RUNNER_WORKSPACE:"/home/runner/work/sentry",npm_execpath:"/opt/hostedtoolcache/node/18.20.2/x64/lib/node_modules/pnpm/bin/pnpm.cjs",HOMEBREW_CLEANUP_PERIODIC_FULL_DAYS:"3650",GITHUB_EVENT_NAME:"push",HOMEBREW_NO_AUTO_UPDATE:"1",ANDROID_HOME:"/usr/local/lib/android/sdk",GITHUB_SERVER_URL:"https://github.com",GECKOWEBDRIVER:"/usr/local/share/gecko_driver",LEIN_JAR:"/usr/local/lib/lein/self-installs/leiningen-2.11.2-standalone.jar",GHCUP_INSTALL_BASE_PREFIX:"/usr/local",GITHUB_OUTPUT:"/home/runner/work/_temp/_runner_file_commands/set_output_ee1cb818-b804-4308-b3d8-9b46fe1f9b81",npm_config_recursive:"true",EDGEWEBDRIVER:"/usr/local/share/edge_driver",STATS_EXT:"true",PNPM_SCRIPT_SRC_DIR:"/home/runner/work/sentry/sentry/apps/web-connect",npm_package_dependencies__wagmi_core:"1.4.5",npm_command:"run-script",ANDROID_NDK:"/usr/local/lib/android/sdk/ndk/25.2.9519653",SGX_AESM_ADDR:"1",CHROME_BIN:"/usr/bin/google-chrome",npm_package_scripts_preview:"vite preview",npm_package_dependencies__web3modal_wagmi:"3.1.0",npm_package_dependencies_react_query:"^3.39.3",SELENIUM_JAR_PATH:"/usr/share/java/selenium-server.jar",STATS_EXTP:"https://provjobdsettingscdn.blob.core.windows.net/settings/provjobdsettings-0.5.172+1/provjobd.data",npm_package_dependencies_tailwindcss:"^3.3.3",ANDROID_NDK_HOME:"/usr/local/lib/android/sdk/ndk/25.2.9519653",GITHUB_STEP_SUMMARY:"/home/runner/work/_temp/_runner_file_commands/step_summary_ee1cb818-b804-4308-b3d8-9b46fe1f9b81",INIT_CWD:"/home/runner/work/sentry/sentry",npm_package_dependencies_react:"^18.2.0",NODE_ENV:"production"}.IS_VITEST}get context(){return Te.getLoggerContext(this.logger)}startAbortTimer(i){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),re.toMiliseconds(i))}}var Ab=Object.defineProperty,wl=Object.getOwnPropertySymbols,Cb=Object.prototype.hasOwnProperty,Nb=Object.prototype.propertyIsEnumerable,bl=(u,i,r)=>i in u?Ab(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,El=(u,i)=>{for(var r in i||(i={}))Cb.call(i,r)&&bl(u,r,i[r]);if(wl)for(var r of wl(i))Nb.call(i,r)&&bl(u,r,i[r]);return u};class Sc extends f_{constructor(i){super(i),this.protocol=mf,this.version=Dw,this.name=xc,this.events=new Pr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||bf,this.customStoragePrefix=i!=null&&i.customStoragePrefix?`:${i.customStoragePrefix}`:"";const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Te.pino(Te.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Fw.logger}));this.logger=Te.generateChildLogger(r,this.name),this.heartbeat=new vs.HeartBeat,this.crypto=new cb(this,this.logger,i==null?void 0:i.keychain),this.history=new Rb(this,this.logger),this.expirer=new Tb(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new i_(El(El({},Lw),i==null?void 0:i.storageOptions)),this.relayer=new Eb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Pb(this,this.logger),this.verify=new Ob(this.projectId||"",this.logger)}static async init(i){const r=new Sc(i);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(Qw,n),r}get context(){return Te.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const Db=Sc,Ef="wc",If=2,xf="client",Pc=`${Ef}@${If}:${xf}:`,ic={name:xf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Il="WALLETCONNECT_DEEPLINK_CHOICE",Fb="proposal",Sf="Proposal expired",Lb="session",oo=re.SEVEN_DAYS,$b="engine",zs={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},sc={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},ni={idle:"IDLE",active:"ACTIVE"},qb="request",Mb=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Ub=Object.defineProperty,jb=Object.defineProperties,Hb=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,zb=Object.prototype.propertyIsEnumerable,Sl=(u,i,r)=>i in u?Ub(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ar=(u,i)=>{for(var r in i||(i={}))kb.call(i,r)&&Sl(u,r,i[r]);if(xl)for(var r of xl(i))zb.call(i,r)&&Sl(u,r,i[r]);return u},Bs=(u,i)=>jb(u,Hb(i));class Bb extends E_{constructor(i){super(i),this.name=$b,this.events=new yc,this.initialized=!1,this.ignoredPayloadTypes=[jl],this.requestQueue={state:ni.idle,queue:[]},this.sessionRequestQueue={state:ni.idle,queue:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(zs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Bs(ar({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:l,optionalNamespaces:d,sessionProperties:v,relays:m}=n;let x=o,D,H=!1;if(x&&(H=this.client.core.pairing.pairings.get(x).active),!x||!H){const{topic:pe,uri:ue}=await this.client.core.pairing.create();x=pe,D=ue}const k=await this.client.core.crypto.generateKeyPair(),z=ar({requiredNamespaces:l,optionalNamespaces:d,relays:m??[{protocol:wf}],proposer:{publicKey:k,metadata:this.client.metadata}},v&&{sessionProperties:v}),{reject:j,resolve:K,done:oe}=hs(re.FIVE_MINUTES,Sf);if(this.events.once(Dt("session_connect"),async({error:pe,session:ue})=>{if(pe)j(pe);else if(ue){ue.self.publicKey=k;const he=Bs(ar({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:ue.peer.metadata}),K(he)}}),!x){const{message:pe}=X("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(pe)}const be=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:z}),de=Fr(re.FIVE_MINUTES);return await this.setProposal(be,ar({id:be,expiry:de},z)),{uri:D,approval:oe}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:l,sessionProperties:d}=r,v=this.client.proposal.get(n);let{pairingTopic:m,proposer:x,requiredNamespaces:D,optionalNamespaces:H}=v;m=m||"",ho(D)||(D=C1(l,"approve()"));const k=await this.client.core.crypto.generateKeyPair(),z=x.publicKey,j=await this.client.core.crypto.generateSharedKey(k,z);m&&n&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:x.metadata}),await this.sendResult({id:n,topic:m,result:{relay:{protocol:o??"irn"},responderPublicKey:k}}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const K=ar({relay:{protocol:o??"irn"},namespaces:l,requiredNamespaces:D,optionalNamespaces:H,pairingTopic:m,controller:{publicKey:k,metadata:this.client.metadata},expiry:Fr(oo)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(j),await this.sendRequest({topic:j,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const oe=Bs(ar({},K),{topic:j,pairingTopic:m,acknowledged:!1,self:K.controller,peer:{publicKey:x.publicKey,metadata:x.metadata},controller:k});return await this.client.session.set(j,oe),await this.setExpiry(j,Fr(oo)),{topic:j,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(j)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,o),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,l=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:v,reject:m}=hs();return this.events.once(Dt("session_update",l),({error:x})=>{x?m(x):v()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:l,resolve:d,reject:v}=hs();return this.events.once(Dt("session_extend",o),({error:m})=>{m?v(m):d()}),await this.setExpiry(n,Fr(oo)),{acknowledged:l}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:l,expiry:d}=r,v=bc(),{done:m,resolve:x,reject:D}=hs(d,"Request expired. Please try again.");return this.events.once(Dt("session_request",v),({error:H,result:k})=>{H?D(H):x(k)}),await Promise.all([new Promise(async H=>{await this.sendRequest({clientRpcId:v,topic:l,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(k=>D(k)),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:n,id:v}),H()}),new Promise(async H=>{const k=await this.client.core.storage.getItem(Il);N1({id:v,topic:l,wcDeepLink:k}),H()}),m()]).then(H=>H[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:l}=o;oi(o)?await this.sendResult({id:l,topic:n,result:o.result,throwOnFailedPublish:!0}):Lr(o)&&await this.sendError(l,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:l,resolve:d,reject:v}=hs();this.events.once(Dt("session_ping",o),({error:m})=>{m?v(m):d()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:l}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:l}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:er("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>D1(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(l=>{var d,v;return((d=l.peerMetadata)==null?void 0:d.url)&&((v=l.peerMetadata)==null?void 0:v.url)===r.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,er("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Il).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==r),o&&(this.sessionRequestQueue.state=ni.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=zs.wc_sessionRequest.req.ttl,{id:o,topic:l,params:d,verifyContext:v}=r;await this.client.pendingRequest.set(o,{id:o,topic:l,params:d,verifyContext:v}),n&&this.client.core.expirer.set(o,Fr(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:l,expiry:d,relayRpcId:v,clientRpcId:m,throwOnFailedPublish:x}=r,D=ds(o,l,m);if(kl()&&Mb.includes(o)){const z=ps(JSON.stringify(D));this.client.core.verify.register({attestationId:z})}const H=await this.client.core.crypto.encode(n,D),k=zs[o].req;return d&&(k.ttl=d),v&&(k.id=v),this.client.core.history.set(n,D),x?(k.internal=Bs(ar({},k.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,H,k)):this.client.core.relayer.publish(n,H,k).catch(z=>this.client.logger.error(z)),D.id},this.sendResult=async r=>{const{id:n,topic:o,result:l,throwOnFailedPublish:d}=r,v=Ec(n,l),m=await this.client.core.crypto.encode(o,v),x=await this.client.core.history.get(o,n),D=zs[x.request.method].res;d?(D.internal=Bs(ar({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,m,D)):this.client.core.relayer.publish(o,m,D).catch(H=>this.client.logger.error(H)),await this.client.core.history.resolve(v)},this.sendError=async(r,n,o)=>{const l=_o(r,o),d=await this.client.core.crypto.encode(n,l),v=await this.client.core.history.get(n,r),m=zs[v.request.method].res;this.client.core.relayer.publish(n,d,m),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{wi(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{wi(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ni.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ni.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ni.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,l=o.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,l=(await this.client.core.history.get(n,o.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=X("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:l}=n;try{this.isValidConnect(ar({},n.params));const d=Fr(re.FIVE_MINUTES),v=ar({id:l,pairingTopic:r,expiry:d},o);await this.setProposal(l,v);const m=ps(JSON.stringify(n)),x=await this.getVerifyContext(m,v.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:v,verifyContext:x})}catch(d){await this.sendError(l,r,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(oi(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const v=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const m=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const x=await this.client.core.crypto.generateSharedKey(v,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const D=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:D}),await this.client.core.pairing.activate({topic:r})}else Lr(n)&&(await this.client.proposal.delete(o,er("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:d,controller:v,expiry:m,namespaces:x,requiredNamespaces:D,optionalNamespaces:H,sessionProperties:k,pairingTopic:z}=n.params,j=ar({topic:r,relay:d,expiry:m,namespaces:x,acknowledged:!0,pairingTopic:z,requiredNamespaces:D,optionalNamespaces:H,controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},k&&{sessionProperties:k});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Dt("session_connect"),{session:j}),this.cleanupDuplicatePairings(j)}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;oi(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Dt("session_approve",o),{})):Lr(n)&&(await this.client.session.delete(r,er("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:l}=n;try{const d=`${r}_session_update`,v=no.get(d);if(v&&this.isRequestOutOfSync(v,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(ar({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:l,topic:r,result:!0}),this.client.events.emit("session_update",{id:l,topic:r,params:o}),no.set(d,l)}catch(d){await this.sendError(l,r,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;oi(n)?this.events.emit(Dt("session_update",o),{}):Lr(n)&&this.events.emit(Dt("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Fr(oo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;oi(n)?this.events.emit(Dt("session_extend",o),{}):Lr(n)&&this.events.emit(Dt("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{oi(n)?this.events.emit(Dt("session_ping",o),{}):Lr(n)&&this.events.emit(Dt("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Gt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidRequest(ar({topic:r},l));const d=ps(JSON.stringify(ds("wc_sessionRequest",l,o))),v=this.client.session.get(r),m=await this.getVerifyContext(d,v.peer.metadata),x={id:o,topic:r,params:l,verifyContext:m};await this.setPendingSessionRequest(x),this.addSessionRequestToSessionRequestQueue(x),this.processSessionRequestQueue()}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;oi(n)?this.events.emit(Dt("session_request",o),{result:n.result}):Lr(n)&&this.events.emit(Dt("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:l}=n;try{const d=`${r}_session_event_${l.event.name}`,v=no.get(d);if(v&&this.isRequestOutOfSync(v,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(ar({topic:r},l)),this.client.events.emit("session_event",{id:o,topic:r,params:l}),no.set(d,o)}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ni.idle,this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ni.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ni.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,ds("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async r=>{if(!cr(r)){const{message:m}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:d,relays:v}=r;if(bi(n)||await this.isValidPairingTopic(n),!F1(v,!0)){const{message:m}=X("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(m)}!bi(o)&&ho(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!bi(l)&&ho(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),bi(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=L1(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!cr(r))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:l,sessionProperties:d}=r;await this.isValidProposalId(n);const v=this.client.proposal.get(n),m=Ga(o,"approve()");if(m)throw new Error(m.message);const x=Ch(v.requiredNamespaces,o,"approve()");if(x)throw new Error(x.message);if(!ls(l,!0)){const{message:D}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(D)}bi(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async r=>{if(!cr(r)){const{message:l}=X("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!$1(o)){const{message:l}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!cr(r)){const{message:x}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(x)}const{relay:n,controller:o,namespaces:l,expiry:d}=r;if(!q1(n)){const{message:x}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const v=M1(o,"onSessionSettleRequest()");if(v)throw new Error(v.message);const m=Ga(l,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(wi(d)){const{message:x}=X("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async r=>{if(!cr(r)){const{message:m}=X("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const l=this.client.session.get(n),d=Ga(o,"update()");if(d)throw new Error(d.message);const v=Ch(l.requiredNamespaces,o,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async r=>{if(!cr(r)){const{message:o}=X("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!cr(r)){const{message:m}=X("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:n,request:o,chainId:l,expiry:d}=r;await this.isValidSessionTopic(n);const{namespaces:v}=this.client.session.get(n);if(!Nh(v,l)){const{message:m}=X("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(m)}if(!U1(o)){const{message:m}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(m)}if(!j1(v,l,o.method)){const{message:m}=X("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(m)}if(d&&!H1(d,sc)){const{message:m}=X("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${sc.min} and ${sc.max}`);throw new Error(m)}},this.isValidRespond=async r=>{if(!cr(r)){const{message:l}=X("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:n,response:o}=r;if(await this.isValidSessionTopic(n),!k1(o)){const{message:l}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!cr(r)){const{message:o}=X("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!cr(r)){const{message:v}=X("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(v)}const{topic:n,event:o,chainId:l}=r;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!Nh(d,l)){const{message:v}=X("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(v)}if(!z1(o)){const{message:v}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}if(!B1(d,l,o.name)){const{message:v}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}},this.isValidDisconnect=async r=>{if(!cr(r)){const{message:o}=X("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||lo,validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});l&&(o.verified.origin=l.origin,o.verified.isScam=l.isScam,o.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!ls(o,!1)){const{message:l}=X("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{Ic(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):mo(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Sr.expired,async i=>{const{topic:r,id:n}=Hl(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,X("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ks.create,i=>this.onPairingCreated(i))}isValidPairingTopic(i){if(!ls(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(wi(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=X("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!ls(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(wi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=X("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(ls(i,!1)){const{message:r}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!V1(i)){const{message:r}=X("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(wi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=X("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class Vb extends bo{constructor(i,r){super(i,r,Fb,Pc),this.core=i,this.logger=r}}class Gb extends bo{constructor(i,r){super(i,r,Lb,Pc),this.core=i,this.logger=r}}class Kb extends bo{constructor(i,r){super(i,r,qb,Pc,n=>n.id),this.core=i,this.logger=r}}let Wb=class Pf extends b_{constructor(i){super(i),this.protocol=Ef,this.version=If,this.name=ic.name,this.events=new Pr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||ic.name,this.metadata=(i==null?void 0:i.metadata)||A1();const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Te.pino(Te.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||ic.logger}));this.core=(i==null?void 0:i.core)||new Db(i),this.logger=Te.generateChildLogger(r,this.name),this.session=new Gb(this.core,this.logger),this.proposal=new Vb(this.core,this.logger),this.pendingRequest=new Kb(this.core,this.logger),this.engine=new Bb(this)}static async init(i){const r=new Pf(i);return await r.initialize(),r}get context(){return Te.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const Jb={Accept:"application/json","Content-Type":"application/json"},Yb="POST",Pl={headers:Jb,method:Yb},Rl=10;class Si{constructor(i,r=!1){if(this.url=i,this.disableProviderPing=r,this.events=new Pr.EventEmitter,this.isAvailable=!1,this.registering=!1,!Zh(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);this.url=i,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(i,r){this.isAvailable||await this.register();try{const n=Qs(i),l=await(await Dh(this.url,Object.assign(Object.assign({},Pl),{body:n}))).json();this.onPayload({data:l})}catch(n){this.onError(i.id,n)}}async register(i=this.url){if(!Zh(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=i,this.registering=!0;try{if(!this.disableProviderPing){const r=Qs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Dh(i,Object.assign(Object.assign({},Pl),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?_c(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),l=_o(i,o);this.events.emit("payload",l)}parseError(i,r=this.url){return rf(i,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Rl&&this.events.setMaxListeners(Rl)}}const Tl="error",Qb="wss://relay.walletconnect.com",Xb="wc",Zb="universal_provider",Ol=`${Xb}@2:${Zb}:`,eE="https://rpc.walletconnect.com/v1/",ci={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(u,i){(function(){var r,n="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",v="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",x=500,D="__lodash_placeholder__",H=1,k=2,z=4,j=1,K=2,oe=1,be=2,de=4,pe=8,ue=16,he=32,A=64,M=128,W=256,ge=512,te=30,Ee="...",Oe=800,et=16,R=1,L=2,Ue=3,Ae=1/0,J=9007199254740991,B=17976931348623157e292,U=0/0,V=4294967295,ut=V-1,ke=V>>>1,$r=[["ary",M],["bind",oe],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",A],["rearg",W]],me="[object Arguments]",It="[object Array]",O="[object AsyncFunction]",T="[object Boolean]",S="[object Date]",c="[object DOMException]",w="[object Error]",Z="[object Function]",ae="[object GeneratorFunction]",ye="[object Map]",Ce="[object Number]",De="[object Null]",xe="[object Object]",xt="[object Promise]",_t="[object Proxy]",nt="[object RegExp]",Le="[object Set]",Je="[object String]",Ye="[object Symbol]",ot="[object Undefined]",je="[object WeakMap]",Qe="[object WeakSet]",Ne="[object ArrayBuffer]",ze="[object DataView]",ht="[object Float32Array]",qe="[object Float64Array]",St="[object Int8Array]",Ft="[object Int16Array]",jt="[object Int32Array]",Ht="[object Uint8Array]",qt="[object Uint8ClampedArray]",Kt="[object Uint16Array]",tr="[object Uint32Array]",qr=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Br=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ui=/&(?:amp|lt|gt|quot|#39);/g,Pi=/[&<>"']/g,lt=RegExp(ui.source),tt=RegExp(Pi.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Tt=RegExp(dt.source),gt=/^\s+/,mt=/\s/,vt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Ot=/,? & /,At=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Eo=/[()=,{}\[\]\/\s]/,Io=/\\(\\)?/g,xo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vr=/\w*$/,So=/^[-+]0x[0-9a-f]+$/i,Po=/^0b[01]+$/i,Ro=/^\[object .+?Constructor\]$/,To=/^0o[0-7]+$/i,Oo=/^(?:0|[1-9]\d*)$/,Vr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Bi=/($^)/,Ao=/['\n\r\u2028\u2029\\]/g,Vi="\\ud800-\\udfff",Co="\\u0300-\\u036f",No="\\ufe20-\\ufe2f",Gi="\\u20d0-\\u20ff",en=Co+No+Gi,tn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",Do="\\xac\\xb1\\xd7\\xf7",Fo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Lo="\\u2000-\\u206f",$o=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rn="A-Z\\xc0-\\xd6\\xd8-\\xde",sn="\\ufe0e\\ufe0f",Ri=Do+Fo+Lo+$o,ys="['’]",Ti="["+Vi+"]",_s="["+Ri+"]",Oi="["+en+"]",nn="\\d+",qo="["+tn+"]",on="["+Rr+"]",an="[^"+Vi+Ri+nn+tn+Rr+rn+"]",Ki="\\ud83c[\\udffb-\\udfff]",Mo="(?:"+Oi+"|"+Ki+")",cn="[^"+Vi+"]",Wi="(?:\\ud83c[\\udde6-\\uddff]){2}",hi="[\\ud800-\\udbff][\\udc00-\\udfff]",ur="["+rn+"]",un="\\u200d",hn="(?:"+on+"|"+an+")",Mr="(?:"+ur+"|"+an+")",ln="(?:"+ys+"(?:d|ll|m|re|s|t|ve))?",fn="(?:"+ys+"(?:D|LL|M|RE|S|T|VE))?",pn=Mo+"?",dn="["+sn+"]?",Uo="(?:"+un+"(?:"+[cn,Wi,hi].join("|")+")"+dn+pn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",vn=dn+pn+Uo,Ji="(?:"+[qo,Wi,hi].join("|")+")"+vn,jo="(?:"+[cn+Oi+"?",Oi,Wi,hi,Ti].join("|")+")",ms=RegExp(ys,"g"),Ho=RegExp(Oi,"g"),Yi=RegExp(Ki+"(?="+Ki+")|"+jo+vn,"g"),yn=RegExp([ur+"?"+on+"+"+ln+"(?="+[_s,ur,"$"].join("|")+")",Mr+"+"+fn+"(?="+[_s,ur+hn,"$"].join("|")+")",ur+"?"+hn+"+"+ln,ur+"+"+fn,gn,Gr,nn,Ji].join("|"),"g"),_n=RegExp("["+un+Vi+en+sn+"]"),Ai=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,mn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ko=-1,Be={};Be[ht]=Be[qe]=Be[St]=Be[Ft]=Be[jt]=Be[Ht]=Be[qt]=Be[Kt]=Be[tr]=!0,Be[me]=Be[It]=Be[Ne]=Be[T]=Be[ze]=Be[S]=Be[w]=Be[Z]=Be[ye]=Be[Ce]=Be[xe]=Be[nt]=Be[Le]=Be[Je]=Be[je]=!1;var He={};He[me]=He[It]=He[Ne]=He[ze]=He[T]=He[S]=He[ht]=He[qe]=He[St]=He[Ft]=He[jt]=He[ye]=He[Ce]=He[xe]=He[nt]=He[Le]=He[Je]=He[Ye]=He[Ht]=He[qt]=He[Kt]=He[tr]=!0,He[w]=He[Z]=He[je]=!1;var g={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Y={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Xe=typeof Vs=="object"&&Vs&&Vs.Object===Object&&Vs,Ct=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Ct||Function("return this")(),Ge=i&&!i.nodeType&&i,wt=Ge&&!0&&u&&!u.nodeType&&u,rr=wt&&wt.exports===Ge,Nt=rr&&Xe.process,Ze=function(){try{var E=wt&&wt.require&&wt.require("util").types;return E||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Jt=Ze&&Ze.isArrayBuffer,Tr=Ze&&Ze.isDate,yr=Ze&&Ze.isMap,Ur=Ze&&Ze.isRegExp,ws=Ze&&Ze.isSet,Ci=Ze&&Ze.isTypedArray;function Mt(E,C,P){switch(P.length){case 0:return E.call(C);case 1:return E.call(C,P[0]);case 2:return E.call(C,P[0],P[1]);case 3:return E.call(C,P[0],P[1],P[2])}return E.apply(C,P)}function Of(E,C,P,Q){for(var ce=-1,Fe=E==null?0:E.length;++ce<Fe;){var Lt=E[ce];C(Q,Lt,P(Lt),E)}return Q}function _r(E,C){for(var P=-1,Q=E==null?0:E.length;++P<Q&&C(E[P],P,E)!==!1;);return E}function Af(E,C){for(var P=E==null?0:E.length;P--&&C(E[P],P,E)!==!1;);return E}function Oc(E,C){for(var P=-1,Q=E==null?0:E.length;++P<Q;)if(!C(E[P],P,E))return!1;return!0}function li(E,C){for(var P=-1,Q=E==null?0:E.length,ce=0,Fe=[];++P<Q;){var Lt=E[P];C(Lt,P,E)&&(Fe[ce++]=Lt)}return Fe}function wn(E,C){var P=E==null?0:E.length;return!!P&&Qi(E,C,0)>-1}function zo(E,C,P){for(var Q=-1,ce=E==null?0:E.length;++Q<ce;)if(P(C,E[Q]))return!0;return!1}function it(E,C){for(var P=-1,Q=E==null?0:E.length,ce=Array(Q);++P<Q;)ce[P]=C(E[P],P,E);return ce}function fi(E,C){for(var P=-1,Q=C.length,ce=E.length;++P<Q;)E[ce+P]=C[P];return E}function Bo(E,C,P,Q){var ce=-1,Fe=E==null?0:E.length;for(Q&&Fe&&(P=E[++ce]);++ce<Fe;)P=C(P,E[ce],ce,E);return P}function Cf(E,C,P,Q){var ce=E==null?0:E.length;for(Q&&ce&&(P=E[--ce]);ce--;)P=C(P,E[ce],ce,E);return P}function Vo(E,C){for(var P=-1,Q=E==null?0:E.length;++P<Q;)if(C(E[P],P,E))return!0;return!1}var Nf=Go("length");function Df(E){return E.split("")}function Ff(E){return E.match(At)||[]}function Ac(E,C,P){var Q;return P(E,function(ce,Fe,Lt){if(C(ce,Fe,Lt))return Q=Fe,!1}),Q}function bn(E,C,P,Q){for(var ce=E.length,Fe=P+(Q?1:-1);Q?Fe--:++Fe<ce;)if(C(E[Fe],Fe,E))return Fe;return-1}function Qi(E,C,P){return C===C?Gf(E,C,P):bn(E,Cc,P)}function Lf(E,C,P,Q){for(var ce=P-1,Fe=E.length;++ce<Fe;)if(Q(E[ce],C))return ce;return-1}function Cc(E){return E!==E}function Nc(E,C){var P=E==null?0:E.length;return P?Wo(E,C)/P:U}function Go(E){return function(C){return C==null?r:C[E]}}function Ko(E){return function(C){return E==null?r:E[C]}}function Dc(E,C,P,Q,ce){return ce(E,function(Fe,Lt,Ke){P=Q?(Q=!1,Fe):C(P,Fe,Lt,Ke)}),P}function $f(E,C){var P=E.length;for(E.sort(C);P--;)E[P]=E[P].value;return E}function Wo(E,C){for(var P,Q=-1,ce=E.length;++Q<ce;){var Fe=C(E[Q]);Fe!==r&&(P=P===r?Fe:P+Fe)}return P}function Jo(E,C){for(var P=-1,Q=Array(E);++P<E;)Q[P]=C(P);return Q}function qf(E,C){return it(C,function(P){return[P,E[P]]})}function Fc(E){return E&&E.slice(0,Mc(E)+1).replace(gt,"")}function hr(E){return function(C){return E(C)}}function Yo(E,C){return it(C,function(P){return E[P]})}function bs(E,C){return E.has(C)}function Lc(E,C){for(var P=-1,Q=E.length;++P<Q&&Qi(C,E[P],0)>-1;);return P}function $c(E,C){for(var P=E.length;P--&&Qi(C,E[P],0)>-1;);return P}function Mf(E,C){for(var P=E.length,Q=0;P--;)E[P]===C&&++Q;return Q}var Uf=Ko(g),jf=Ko(b);function Hf(E){return"\\"+Y[E]}function kf(E,C){return E==null?r:E[C]}function Xi(E){return _n.test(E)}function zf(E){return Ai.test(E)}function Bf(E){for(var C,P=[];!(C=E.next()).done;)P.push(C.value);return P}function Qo(E){var C=-1,P=Array(E.size);return E.forEach(function(Q,ce){P[++C]=[ce,Q]}),P}function qc(E,C){return function(P){return E(C(P))}}function pi(E,C){for(var P=-1,Q=E.length,ce=0,Fe=[];++P<Q;){var Lt=E[P];(Lt===C||Lt===D)&&(E[P]=D,Fe[ce++]=P)}return Fe}function En(E){var C=-1,P=Array(E.size);return E.forEach(function(Q){P[++C]=Q}),P}function Vf(E){var C=-1,P=Array(E.size);return E.forEach(function(Q){P[++C]=[Q,Q]}),P}function Gf(E,C,P){for(var Q=P-1,ce=E.length;++Q<ce;)if(E[Q]===C)return Q;return-1}function Kf(E,C,P){for(var Q=P+1;Q--;)if(E[Q]===C)return Q;return Q}function Zi(E){return Xi(E)?Jf(E):Nf(E)}function Or(E){return Xi(E)?Yf(E):Df(E)}function Mc(E){for(var C=E.length;C--&&mt.test(E.charAt(C)););return C}var Wf=Ko($);function Jf(E){for(var C=Yi.lastIndex=0;Yi.test(E);)++C;return C}function Yf(E){return E.match(Yi)||[]}function Qf(E){return E.match(yn)||[]}var Xf=function E(C){C=C==null?Pe:es.defaults(Pe.Object(),C,es.pick(Pe,mn));var P=C.Array,Q=C.Date,ce=C.Error,Fe=C.Function,Lt=C.Math,Ke=C.Object,Xo=C.RegExp,Zf=C.String,mr=C.TypeError,In=P.prototype,ep=Fe.prototype,ts=Ke.prototype,xn=C["__core-js_shared__"],Sn=ep.toString,Me=ts.hasOwnProperty,tp=0,Uc=function(){var e=/[^.]+$/.exec(xn&&xn.keys&&xn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pn=ts.toString,rp=Sn.call(Ke),ip=Pe._,sp=Xo("^"+Sn.call(Me).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=rr?C.Buffer:r,di=C.Symbol,Tn=C.Uint8Array,jc=Rn?Rn.allocUnsafe:r,On=qc(Ke.getPrototypeOf,Ke),Hc=Ke.create,kc=ts.propertyIsEnumerable,An=In.splice,zc=di?di.isConcatSpreadable:r,Es=di?di.iterator:r,Ni=di?di.toStringTag:r,Cn=function(){try{var e=qi(Ke,"defineProperty");return e({},"",{}),e}catch{}}(),np=C.clearTimeout!==Pe.clearTimeout&&C.clearTimeout,op=Q&&Q.now!==Pe.Date.now&&Q.now,ap=C.setTimeout!==Pe.setTimeout&&C.setTimeout,Nn=Lt.ceil,Dn=Lt.floor,Zo=Ke.getOwnPropertySymbols,cp=Rn?Rn.isBuffer:r,Bc=C.isFinite,up=In.join,hp=qc(Ke.keys,Ke),$t=Lt.max,Bt=Lt.min,lp=Q.now,fp=C.parseInt,Vc=Lt.random,pp=In.reverse,ea=qi(C,"DataView"),Is=qi(C,"Map"),ta=qi(C,"Promise"),rs=qi(C,"Set"),xs=qi(C,"WeakMap"),Ss=qi(Ke,"create"),Fn=xs&&new xs,is={},dp=Mi(ea),gp=Mi(Is),vp=Mi(ta),yp=Mi(rs),_p=Mi(xs),Ln=di?di.prototype:r,Ps=Ln?Ln.valueOf:r,Gc=Ln?Ln.toString:r;function f(e){if(yt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof wr)return e;if(Me.call(e,"__wrapped__"))return Ku(e)}return new wr(e)}var ss=function(){function e(){}return function(t){if(!ct(t))return{};if(Hc)return Hc(t);e.prototype=t;var s=new e;return e.prototype=r,s}}();function $n(){}function wr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=$n.prototype,f.prototype.constructor=f,wr.prototype=ss($n.prototype),wr.prototype.constructor=wr;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function mp(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function wp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function bp(){var e=this.__wrapped__.value(),t=this.__dir__,s=fe(e),a=t<0,h=s?e.length:0,p=Dd(0,h,this.__views__),y=p.start,_=p.end,I=_-y,N=a?_:y-1,F=this.__iteratees__,q=F.length,G=0,ee=Bt(I,this.__takeCount__);if(!s||!a&&h==I&&ee==I)return vu(e,this.__actions__);var se=[];e:for(;I--&&G<ee;){N+=t;for(var _e=-1,ne=e[N];++_e<q;){var Ie=F[_e],Re=Ie.iteratee,pr=Ie.type,Xt=Re(ne);if(pr==L)ne=Xt;else if(!Xt){if(pr==R)continue e;break e}}se[G++]=ne}return se}Se.prototype=ss($n.prototype),Se.prototype.constructor=Se;function Di(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Ep(){this.__data__=Ss?Ss(null):{},this.size=0}function Ip(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function xp(e){var t=this.__data__;if(Ss){var s=t[e];return s===m?r:s}return Me.call(t,e)?t[e]:r}function Sp(e){var t=this.__data__;return Ss?t[e]!==r:Me.call(t,e)}function Pp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Ss&&t===r?m:t,this}Di.prototype.clear=Ep,Di.prototype.delete=Ip,Di.prototype.get=xp,Di.prototype.has=Sp,Di.prototype.set=Pp;function Kr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Rp(){this.__data__=[],this.size=0}function Tp(e){var t=this.__data__,s=qn(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():An.call(t,s,1),--this.size,!0}function Op(e){var t=this.__data__,s=qn(t,e);return s<0?r:t[s][1]}function Ap(e){return qn(this.__data__,e)>-1}function Cp(e,t){var s=this.__data__,a=qn(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}Kr.prototype.clear=Rp,Kr.prototype.delete=Tp,Kr.prototype.get=Op,Kr.prototype.has=Ap,Kr.prototype.set=Cp;function Wr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Np(){this.size=0,this.__data__={hash:new Di,map:new(Is||Kr),string:new Di}}function Dp(e){var t=Jn(this,e).delete(e);return this.size-=t?1:0,t}function Fp(e){return Jn(this,e).get(e)}function Lp(e){return Jn(this,e).has(e)}function $p(e,t){var s=Jn(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Wr.prototype.clear=Np,Wr.prototype.delete=Dp,Wr.prototype.get=Fp,Wr.prototype.has=Lp,Wr.prototype.set=$p;function Fi(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Wr;++t<s;)this.add(e[t])}function qp(e){return this.__data__.set(e,m),this}function Mp(e){return this.__data__.has(e)}Fi.prototype.add=Fi.prototype.push=qp,Fi.prototype.has=Mp;function Ar(e){var t=this.__data__=new Kr(e);this.size=t.size}function Up(){this.__data__=new Kr,this.size=0}function jp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function Hp(e){return this.__data__.get(e)}function kp(e){return this.__data__.has(e)}function zp(e,t){var s=this.__data__;if(s instanceof Kr){var a=s.__data__;if(!Is||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Wr(a)}return s.set(e,t),this.size=s.size,this}Ar.prototype.clear=Up,Ar.prototype.delete=jp,Ar.prototype.get=Hp,Ar.prototype.has=kp,Ar.prototype.set=zp;function Kc(e,t){var s=fe(e),a=!s&&Ui(e),h=!s&&!a&&mi(e),p=!s&&!a&&!h&&cs(e),y=s||a||h||p,_=y?Jo(e.length,Zf):[],I=_.length;for(var N in e)(t||Me.call(e,N))&&!(y&&(N=="length"||h&&(N=="offset"||N=="parent")||p&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Xr(N,I)))&&_.push(N);return _}function Wc(e){var t=e.length;return t?e[fa(0,t-1)]:r}function Bp(e,t){return Yn(ir(e),Li(t,0,e.length))}function Vp(e){return Yn(ir(e))}function ra(e,t,s){(s!==r&&!Cr(e[t],s)||s===r&&!(t in e))&&Jr(e,t,s)}function Rs(e,t,s){var a=e[t];(!(Me.call(e,t)&&Cr(a,s))||s===r&&!(t in e))&&Jr(e,t,s)}function qn(e,t){for(var s=e.length;s--;)if(Cr(e[s][0],t))return s;return-1}function Gp(e,t,s,a){return gi(e,function(h,p,y){t(a,h,s(h),y)}),a}function Jc(e,t){return e&&Hr(t,Ut(t),e)}function Kp(e,t){return e&&Hr(t,nr(t),e)}function Jr(e,t,s){t=="__proto__"&&Cn?Cn(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function ia(e,t){for(var s=-1,a=t.length,h=P(a),p=e==null;++s<a;)h[s]=p?r:qa(e,t[s]);return h}function Li(e,t,s){return e===e&&(s!==r&&(e=e<=s?e:s),t!==r&&(e=e>=t?e:t)),e}function br(e,t,s,a,h,p){var y,_=t&H,I=t&k,N=t&z;if(s&&(y=h?s(e,a,h,p):s(e)),y!==r)return y;if(!ct(e))return e;var F=fe(e);if(F){if(y=Ld(e),!_)return ir(e,y)}else{var q=Vt(e),G=q==Z||q==ae;if(mi(e))return mu(e,_);if(q==xe||q==me||G&&!h){if(y=I||G?{}:Mu(e),!_)return I?xd(e,Kp(y,e)):Id(e,Jc(y,e))}else{if(!He[q])return h?e:{};y=$d(e,q,_)}}p||(p=new Ar);var ee=p.get(e);if(ee)return ee;p.set(e,y),ph(e)?e.forEach(function(ne){y.add(br(ne,t,s,ne,e,p))}):lh(e)&&e.forEach(function(ne,Ie){y.set(Ie,br(ne,t,s,Ie,e,p))});var se=N?I?Ia:Ea:I?nr:Ut,_e=F?r:se(e);return _r(_e||e,function(ne,Ie){_e&&(Ie=ne,ne=e[Ie]),Rs(y,Ie,br(ne,t,s,Ie,e,p))}),y}function Wp(e){var t=Ut(e);return function(s){return Yc(s,e,t)}}function Yc(e,t,s){var a=s.length;if(e==null)return!a;for(e=Ke(e);a--;){var h=s[a],p=t[h],y=e[h];if(y===r&&!(h in e)||!p(y))return!1}return!0}function Qc(e,t,s){if(typeof e!="function")throw new mr(d);return Fs(function(){e.apply(r,s)},t)}function Ts(e,t,s,a){var h=-1,p=wn,y=!0,_=e.length,I=[],N=t.length;if(!_)return I;s&&(t=it(t,hr(s))),a?(p=zo,y=!1):t.length>=o&&(p=bs,y=!1,t=new Fi(t));e:for(;++h<_;){var F=e[h],q=s==null?F:s(F);if(F=a||F!==0?F:0,y&&q===q){for(var G=N;G--;)if(t[G]===q)continue e;I.push(F)}else p(t,q,a)||I.push(F)}return I}var gi=xu(jr),Xc=xu(na,!0);function Jp(e,t){var s=!0;return gi(e,function(a,h,p){return s=!!t(a,h,p),s}),s}function Mn(e,t,s){for(var a=-1,h=e.length;++a<h;){var p=e[a],y=t(p);if(y!=null&&(_===r?y===y&&!fr(y):s(y,_)))var _=y,I=p}return I}function Yp(e,t,s,a){var h=e.length;for(s=ve(s),s<0&&(s=-s>h?0:h+s),a=a===r||a>h?h:ve(a),a<0&&(a+=h),a=s>a?0:gh(a);s<a;)e[s++]=t;return e}function Zc(e,t){var s=[];return gi(e,function(a,h,p){t(a,h,p)&&s.push(a)}),s}function kt(e,t,s,a,h){var p=-1,y=e.length;for(s||(s=Md),h||(h=[]);++p<y;){var _=e[p];t>0&&s(_)?t>1?kt(_,t-1,s,a,h):fi(h,_):a||(h[h.length]=_)}return h}var sa=Su(),eu=Su(!0);function jr(e,t){return e&&sa(e,t,Ut)}function na(e,t){return e&&eu(e,t,Ut)}function Un(e,t){return li(t,function(s){return Zr(e[s])})}function $i(e,t){t=yi(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[kr(t[s++])];return s&&s==a?e:r}function tu(e,t,s){var a=t(e);return fe(e)?a:fi(a,s(e))}function Yt(e){return e==null?e===r?ot:De:Ni&&Ni in Ke(e)?Nd(e):Vd(e)}function oa(e,t){return e>t}function Qp(e,t){return e!=null&&Me.call(e,t)}function Xp(e,t){return e!=null&&t in Ke(e)}function Zp(e,t,s){return e>=Bt(t,s)&&e<$t(t,s)}function aa(e,t,s){for(var a=s?zo:wn,h=e[0].length,p=e.length,y=p,_=P(p),I=1/0,N=[];y--;){var F=e[y];y&&t&&(F=it(F,hr(t))),I=Bt(F.length,I),_[y]=!s&&(t||h>=120&&F.length>=120)?new Fi(y&&F):r}F=e[0];var q=-1,G=_[0];e:for(;++q<h&&N.length<I;){var ee=F[q],se=t?t(ee):ee;if(ee=s||ee!==0?ee:0,!(G?bs(G,se):a(N,se,s))){for(y=p;--y;){var _e=_[y];if(!(_e?bs(_e,se):a(e[y],se,s)))continue e}G&&G.push(se),N.push(ee)}}return N}function ed(e,t,s,a){return jr(e,function(h,p,y){t(a,s(h),p,y)}),a}function Os(e,t,s){t=yi(t,e),e=ku(e,t);var a=e==null?e:e[kr(Ir(t))];return a==null?r:Mt(a,e,s)}function ru(e){return yt(e)&&Yt(e)==me}function td(e){return yt(e)&&Yt(e)==Ne}function rd(e){return yt(e)&&Yt(e)==S}function As(e,t,s,a,h){return e===t?!0:e==null||t==null||!yt(e)&&!yt(t)?e!==e&&t!==t:id(e,t,s,a,As,h)}function id(e,t,s,a,h,p){var y=fe(e),_=fe(t),I=y?It:Vt(e),N=_?It:Vt(t);I=I==me?xe:I,N=N==me?xe:N;var F=I==xe,q=N==xe,G=I==N;if(G&&mi(e)){if(!mi(t))return!1;y=!0,F=!1}if(G&&!F)return p||(p=new Ar),y||cs(e)?Lu(e,t,s,a,h,p):Ad(e,t,I,s,a,h,p);if(!(s&j)){var ee=F&&Me.call(e,"__wrapped__"),se=q&&Me.call(t,"__wrapped__");if(ee||se){var _e=ee?e.value():e,ne=se?t.value():t;return p||(p=new Ar),h(_e,ne,s,a,p)}}return G?(p||(p=new Ar),Cd(e,t,s,a,h,p)):!1}function sd(e){return yt(e)&&Vt(e)==ye}function ca(e,t,s,a){var h=s.length,p=h,y=!a;if(e==null)return!p;for(e=Ke(e);h--;){var _=s[h];if(y&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++h<p;){_=s[h];var I=_[0],N=e[I],F=_[1];if(y&&_[2]){if(N===r&&!(I in e))return!1}else{var q=new Ar;if(a)var G=a(N,F,I,e,t,q);if(!(G===r?As(F,N,j|K,a,q):G))return!1}}return!0}function iu(e){if(!ct(e)||jd(e))return!1;var t=Zr(e)?sp:Ro;return t.test(Mi(e))}function nd(e){return yt(e)&&Yt(e)==nt}function od(e){return yt(e)&&Vt(e)==Le}function ad(e){return yt(e)&&ro(e.length)&&!!Be[Yt(e)]}function su(e){return typeof e=="function"?e:e==null?or:typeof e=="object"?fe(e)?au(e[0],e[1]):ou(e):Ph(e)}function ua(e){if(!Ds(e))return hp(e);var t=[];for(var s in Ke(e))Me.call(e,s)&&s!="constructor"&&t.push(s);return t}function cd(e){if(!ct(e))return Bd(e);var t=Ds(e),s=[];for(var a in e)a=="constructor"&&(t||!Me.call(e,a))||s.push(a);return s}function ha(e,t){return e<t}function nu(e,t){var s=-1,a=sr(e)?P(e.length):[];return gi(e,function(h,p,y){a[++s]=t(h,p,y)}),a}function ou(e){var t=Sa(e);return t.length==1&&t[0][2]?ju(t[0][0],t[0][1]):function(s){return s===e||ca(s,e,t)}}function au(e,t){return Ra(e)&&Uu(t)?ju(kr(e),t):function(s){var a=qa(s,e);return a===r&&a===t?Ma(s,e):As(t,a,j|K)}}function jn(e,t,s,a,h){e!==t&&sa(t,function(p,y){if(h||(h=new Ar),ct(p))ud(e,t,y,s,jn,a,h);else{var _=a?a(Oa(e,y),p,y+"",e,t,h):r;_===r&&(_=p),ra(e,y,_)}},nr)}function ud(e,t,s,a,h,p,y){var _=Oa(e,s),I=Oa(t,s),N=y.get(I);if(N){ra(e,s,N);return}var F=p?p(_,I,s+"",e,t,y):r,q=F===r;if(q){var G=fe(I),ee=!G&&mi(I),se=!G&&!ee&&cs(I);F=I,G||ee||se?fe(_)?F=_:bt(_)?F=ir(_):ee?(q=!1,F=mu(I,!0)):se?(q=!1,F=wu(I,!0)):F=[]:Ls(I)||Ui(I)?(F=_,Ui(_)?F=vh(_):(!ct(_)||Zr(_))&&(F=Mu(I))):q=!1}q&&(y.set(I,F),h(F,I,a,p,y),y.delete(I)),ra(e,s,F)}function cu(e,t){var s=e.length;if(s)return t+=t<0?s:0,Xr(t,s)?e[t]:r}function uu(e,t,s){t.length?t=it(t,function(p){return fe(p)?function(y){return $i(y,p.length===1?p[0]:p)}:p}):t=[or];var a=-1;t=it(t,hr(ie()));var h=nu(e,function(p,y,_){var I=it(t,function(N){return N(p)});return{criteria:I,index:++a,value:p}});return $f(h,function(p,y){return Ed(p,y,s)})}function hd(e,t){return hu(e,t,function(s,a){return Ma(e,a)})}function hu(e,t,s){for(var a=-1,h=t.length,p={};++a<h;){var y=t[a],_=$i(e,y);s(_,y)&&Cs(p,yi(y,e),_)}return p}function ld(e){return function(t){return $i(t,e)}}function la(e,t,s,a){var h=a?Lf:Qi,p=-1,y=t.length,_=e;for(e===t&&(t=ir(t)),s&&(_=it(e,hr(s)));++p<y;)for(var I=0,N=t[p],F=s?s(N):N;(I=h(_,F,I,a))>-1;)_!==e&&An.call(_,I,1),An.call(e,I,1);return e}function lu(e,t){for(var s=e?t.length:0,a=s-1;s--;){var h=t[s];if(s==a||h!==p){var p=h;Xr(h)?An.call(e,h,1):ga(e,h)}}return e}function fa(e,t){return e+Dn(Vc()*(t-e+1))}function fd(e,t,s,a){for(var h=-1,p=$t(Nn((t-e)/(s||1)),0),y=P(p);p--;)y[a?p:++h]=e,e+=s;return y}function pa(e,t){var s="";if(!e||t<1||t>J)return s;do t%2&&(s+=e),t=Dn(t/2),t&&(e+=e);while(t);return s}function we(e,t){return Aa(Hu(e,t,or),e+"")}function pd(e){return Wc(us(e))}function dd(e,t){var s=us(e);return Yn(s,Li(t,0,s.length))}function Cs(e,t,s,a){if(!ct(e))return e;t=yi(t,e);for(var h=-1,p=t.length,y=p-1,_=e;_!=null&&++h<p;){var I=kr(t[h]),N=s;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(h!=y){var F=_[I];N=a?a(F,I,_):r,N===r&&(N=ct(F)?F:Xr(t[h+1])?[]:{})}Rs(_,I,N),_=_[I]}return e}var fu=Fn?function(e,t){return Fn.set(e,t),e}:or,gd=Cn?function(e,t){return Cn(e,"toString",{configurable:!0,enumerable:!1,value:ja(t),writable:!0})}:or;function vd(e){return Yn(us(e))}function Er(e,t,s){var a=-1,h=e.length;t<0&&(t=-t>h?0:h+t),s=s>h?h:s,s<0&&(s+=h),h=t>s?0:s-t>>>0,t>>>=0;for(var p=P(h);++a<h;)p[a]=e[a+t];return p}function yd(e,t){var s;return gi(e,function(a,h,p){return s=t(a,h,p),!s}),!!s}function Hn(e,t,s){var a=0,h=e==null?a:e.length;if(typeof t=="number"&&t===t&&h<=ke){for(;a<h;){var p=a+h>>>1,y=e[p];y!==null&&!fr(y)&&(s?y<=t:y<t)?a=p+1:h=p}return h}return da(e,t,or,s)}function da(e,t,s,a){var h=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var y=t!==t,_=t===null,I=fr(t),N=t===r;h<p;){var F=Dn((h+p)/2),q=s(e[F]),G=q!==r,ee=q===null,se=q===q,_e=fr(q);if(y)var ne=a||se;else N?ne=se&&(a||G):_?ne=se&&G&&(a||!ee):I?ne=se&&G&&!ee&&(a||!_e):ee||_e?ne=!1:ne=a?q<=t:q<t;ne?h=F+1:p=F}return Bt(p,ut)}function pu(e,t){for(var s=-1,a=e.length,h=0,p=[];++s<a;){var y=e[s],_=t?t(y):y;if(!s||!Cr(_,I)){var I=_;p[h++]=y===0?0:y}}return p}function du(e){return typeof e=="number"?e:fr(e)?U:+e}function lr(e){if(typeof e=="string")return e;if(fe(e))return it(e,lr)+"";if(fr(e))return Gc?Gc.call(e):"";var t=e+"";return t=="0"&&1/e==-Ae?"-0":t}function vi(e,t,s){var a=-1,h=wn,p=e.length,y=!0,_=[],I=_;if(s)y=!1,h=zo;else if(p>=o){var N=t?null:Td(e);if(N)return En(N);y=!1,h=bs,I=new Fi}else I=t?[]:_;e:for(;++a<p;){var F=e[a],q=t?t(F):F;if(F=s||F!==0?F:0,y&&q===q){for(var G=I.length;G--;)if(I[G]===q)continue e;t&&I.push(q),_.push(F)}else h(I,q,s)||(I!==_&&I.push(q),_.push(F))}return _}function ga(e,t){return t=yi(t,e),e=ku(e,t),e==null||delete e[kr(Ir(t))]}function gu(e,t,s,a){return Cs(e,t,s($i(e,t)),a)}function kn(e,t,s,a){for(var h=e.length,p=a?h:-1;(a?p--:++p<h)&&t(e[p],p,e););return s?Er(e,a?0:p,a?p+1:h):Er(e,a?p+1:0,a?h:p)}function vu(e,t){var s=e;return s instanceof Se&&(s=s.value()),Bo(t,function(a,h){return h.func.apply(h.thisArg,fi([a],h.args))},s)}function va(e,t,s){var a=e.length;if(a<2)return a?vi(e[0]):[];for(var h=-1,p=P(a);++h<a;)for(var y=e[h],_=-1;++_<a;)_!=h&&(p[h]=Ts(p[h]||y,e[_],t,s));return vi(kt(p,1),t,s)}function yu(e,t,s){for(var a=-1,h=e.length,p=t.length,y={};++a<h;){var _=a<p?t[a]:r;s(y,e[a],_)}return y}function ya(e){return bt(e)?e:[]}function _a(e){return typeof e=="function"?e:or}function yi(e,t){return fe(e)?e:Ra(e,t)?[e]:Gu($e(e))}var _d=we;function _i(e,t,s){var a=e.length;return s=s===r?a:s,!t&&s>=a?e:Er(e,t,s)}var _u=np||function(e){return Pe.clearTimeout(e)};function mu(e,t){if(t)return e.slice();var s=e.length,a=jc?jc(s):new e.constructor(s);return e.copy(a),a}function ma(e){var t=new e.constructor(e.byteLength);return new Tn(t).set(new Tn(e)),t}function md(e,t){var s=t?ma(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function wd(e){var t=new e.constructor(e.source,vr.exec(e));return t.lastIndex=e.lastIndex,t}function bd(e){return Ps?Ke(Ps.call(e)):{}}function wu(e,t){var s=t?ma(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function bu(e,t){if(e!==t){var s=e!==r,a=e===null,h=e===e,p=fr(e),y=t!==r,_=t===null,I=t===t,N=fr(t);if(!_&&!N&&!p&&e>t||p&&y&&I&&!_&&!N||a&&y&&I||!s&&I||!h)return 1;if(!a&&!p&&!N&&e<t||N&&s&&h&&!a&&!p||_&&s&&h||!y&&h||!I)return-1}return 0}function Ed(e,t,s){for(var a=-1,h=e.criteria,p=t.criteria,y=h.length,_=s.length;++a<y;){var I=bu(h[a],p[a]);if(I){if(a>=_)return I;var N=s[a];return I*(N=="desc"?-1:1)}}return e.index-t.index}function Eu(e,t,s,a){for(var h=-1,p=e.length,y=s.length,_=-1,I=t.length,N=$t(p-y,0),F=P(I+N),q=!a;++_<I;)F[_]=t[_];for(;++h<y;)(q||h<p)&&(F[s[h]]=e[h]);for(;N--;)F[_++]=e[h++];return F}function Iu(e,t,s,a){for(var h=-1,p=e.length,y=-1,_=s.length,I=-1,N=t.length,F=$t(p-_,0),q=P(F+N),G=!a;++h<F;)q[h]=e[h];for(var ee=h;++I<N;)q[ee+I]=t[I];for(;++y<_;)(G||h<p)&&(q[ee+s[y]]=e[h++]);return q}function ir(e,t){var s=-1,a=e.length;for(t||(t=P(a));++s<a;)t[s]=e[s];return t}function Hr(e,t,s,a){var h=!s;s||(s={});for(var p=-1,y=t.length;++p<y;){var _=t[p],I=a?a(s[_],e[_],_,s,e):r;I===r&&(I=e[_]),h?Jr(s,_,I):Rs(s,_,I)}return s}function Id(e,t){return Hr(e,Pa(e),t)}function xd(e,t){return Hr(e,$u(e),t)}function zn(e,t){return function(s,a){var h=fe(s)?Of:Gp,p=t?t():{};return h(s,e,ie(a,2),p)}}function ns(e){return we(function(t,s){var a=-1,h=s.length,p=h>1?s[h-1]:r,y=h>2?s[2]:r;for(p=e.length>3&&typeof p=="function"?(h--,p):r,y&&Qt(s[0],s[1],y)&&(p=h<3?r:p,h=1),t=Ke(t);++a<h;){var _=s[a];_&&e(t,_,a,p)}return t})}function xu(e,t){return function(s,a){if(s==null)return s;if(!sr(s))return e(s,a);for(var h=s.length,p=t?h:-1,y=Ke(s);(t?p--:++p<h)&&a(y[p],p,y)!==!1;);return s}}function Su(e){return function(t,s,a){for(var h=-1,p=Ke(t),y=a(t),_=y.length;_--;){var I=y[e?_:++h];if(s(p[I],I,p)===!1)break}return t}}function Sd(e,t,s){var a=t&oe,h=Ns(e);function p(){var y=this&&this!==Pe&&this instanceof p?h:e;return y.apply(a?s:this,arguments)}return p}function Pu(e){return function(t){t=$e(t);var s=Xi(t)?Or(t):r,a=s?s[0]:t.charAt(0),h=s?_i(s,1).join(""):t.slice(1);return a[e]()+h}}function os(e){return function(t){return Bo(xh(Ih(t).replace(ms,"")),e,"")}}function Ns(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=ss(e.prototype),a=e.apply(s,t);return ct(a)?a:s}}function Pd(e,t,s){var a=Ns(e);function h(){for(var p=arguments.length,y=P(p),_=p,I=as(h);_--;)y[_]=arguments[_];var N=p<3&&y[0]!==I&&y[p-1]!==I?[]:pi(y,I);if(p-=N.length,p<s)return Cu(e,t,Bn,h.placeholder,r,y,N,r,r,s-p);var F=this&&this!==Pe&&this instanceof h?a:e;return Mt(F,this,y)}return h}function Ru(e){return function(t,s,a){var h=Ke(t);if(!sr(t)){var p=ie(s,3);t=Ut(t),s=function(_){return p(h[_],_,h)}}var y=e(t,s,a);return y>-1?h[p?t[y]:y]:r}}function Tu(e){return Qr(function(t){var s=t.length,a=s,h=wr.prototype.thru;for(e&&t.reverse();a--;){var p=t[a];if(typeof p!="function")throw new mr(d);if(h&&!y&&Wn(p)=="wrapper")var y=new wr([],!0)}for(a=y?a:s;++a<s;){p=t[a];var _=Wn(p),I=_=="wrapper"?xa(p):r;I&&Ta(I[0])&&I[1]==(M|pe|he|W)&&!I[4].length&&I[9]==1?y=y[Wn(I[0])].apply(y,I[3]):y=p.length==1&&Ta(p)?y[_]():y.thru(p)}return function(){var N=arguments,F=N[0];if(y&&N.length==1&&fe(F))return y.plant(F).value();for(var q=0,G=s?t[q].apply(this,N):F;++q<s;)G=t[q].call(this,G);return G}})}function Bn(e,t,s,a,h,p,y,_,I,N){var F=t&M,q=t&oe,G=t&be,ee=t&(pe|ue),se=t&ge,_e=G?r:Ns(e);function ne(){for(var Ie=arguments.length,Re=P(Ie),pr=Ie;pr--;)Re[pr]=arguments[pr];if(ee)var Xt=as(ne),dr=Mf(Re,Xt);if(a&&(Re=Eu(Re,a,h,ee)),p&&(Re=Iu(Re,p,y,ee)),Ie-=dr,ee&&Ie<N){var Et=pi(Re,Xt);return Cu(e,t,Bn,ne.placeholder,s,Re,Et,_,I,N-Ie)}var Nr=q?s:this,ti=G?Nr[e]:e;return Ie=Re.length,_?Re=Gd(Re,_):se&&Ie>1&&Re.reverse(),F&&I<Ie&&(Re.length=I),this&&this!==Pe&&this instanceof ne&&(ti=_e||Ns(ti)),ti.apply(Nr,Re)}return ne}function Ou(e,t){return function(s,a){return ed(s,e,t(a),{})}}function Vn(e,t){return function(s,a){var h;if(s===r&&a===r)return t;if(s!==r&&(h=s),a!==r){if(h===r)return a;typeof s=="string"||typeof a=="string"?(s=lr(s),a=lr(a)):(s=du(s),a=du(a)),h=e(s,a)}return h}}function wa(e){return Qr(function(t){return t=it(t,hr(ie())),we(function(s){var a=this;return e(t,function(h){return Mt(h,a,s)})})})}function Gn(e,t){t=t===r?" ":lr(t);var s=t.length;if(s<2)return s?pa(t,e):t;var a=pa(t,Nn(e/Zi(t)));return Xi(t)?_i(Or(a),0,e).join(""):a.slice(0,e)}function Rd(e,t,s,a){var h=t&oe,p=Ns(e);function y(){for(var _=-1,I=arguments.length,N=-1,F=a.length,q=P(F+I),G=this&&this!==Pe&&this instanceof y?p:e;++N<F;)q[N]=a[N];for(;I--;)q[N++]=arguments[++_];return Mt(G,h?s:this,q)}return y}function Au(e){return function(t,s,a){return a&&typeof a!="number"&&Qt(t,s,a)&&(s=a=r),t=ei(t),s===r?(s=t,t=0):s=ei(s),a=a===r?t<s?1:-1:ei(a),fd(t,s,a,e)}}function Kn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=xr(t),s=xr(s)),e(t,s)}}function Cu(e,t,s,a,h,p,y,_,I,N){var F=t&pe,q=F?y:r,G=F?r:y,ee=F?p:r,se=F?r:p;t|=F?he:A,t&=~(F?A:he),t&de||(t&=~(oe|be));var _e=[e,t,h,ee,q,se,G,_,I,N],ne=s.apply(r,_e);return Ta(e)&&zu(ne,_e),ne.placeholder=a,Bu(ne,e,t)}function ba(e){var t=Lt[e];return function(s,a){if(s=xr(s),a=a==null?0:Bt(ve(a),292),a&&Bc(s)){var h=($e(s)+"e").split("e"),p=t(h[0]+"e"+(+h[1]+a));return h=($e(p)+"e").split("e"),+(h[0]+"e"+(+h[1]-a))}return t(s)}}var Td=rs&&1/En(new rs([,-0]))[1]==Ae?function(e){return new rs(e)}:za;function Nu(e){return function(t){var s=Vt(t);return s==ye?Qo(t):s==Le?Vf(t):qf(t,e(t))}}function Yr(e,t,s,a,h,p,y,_){var I=t&be;if(!I&&typeof e!="function")throw new mr(d);var N=a?a.length:0;if(N||(t&=~(he|A),a=h=r),y=y===r?y:$t(ve(y),0),_=_===r?_:ve(_),N-=h?h.length:0,t&A){var F=a,q=h;a=h=r}var G=I?r:xa(e),ee=[e,t,s,a,h,F,q,p,y,_];if(G&&zd(ee,G),e=ee[0],t=ee[1],s=ee[2],a=ee[3],h=ee[4],_=ee[9]=ee[9]===r?I?0:e.length:$t(ee[9]-N,0),!_&&t&(pe|ue)&&(t&=~(pe|ue)),!t||t==oe)var se=Sd(e,t,s);else t==pe||t==ue?se=Pd(e,t,_):(t==he||t==(oe|he))&&!h.length?se=Rd(e,t,s,a):se=Bn.apply(r,ee);var _e=G?fu:zu;return Bu(_e(se,ee),e,t)}function Du(e,t,s,a){return e===r||Cr(e,ts[s])&&!Me.call(a,s)?t:e}function Fu(e,t,s,a,h,p){return ct(e)&&ct(t)&&(p.set(t,e),jn(e,t,r,Fu,p),p.delete(t)),e}function Od(e){return Ls(e)?r:e}function Lu(e,t,s,a,h,p){var y=s&j,_=e.length,I=t.length;if(_!=I&&!(y&&I>_))return!1;var N=p.get(e),F=p.get(t);if(N&&F)return N==t&&F==e;var q=-1,G=!0,ee=s&K?new Fi:r;for(p.set(e,t),p.set(t,e);++q<_;){var se=e[q],_e=t[q];if(a)var ne=y?a(_e,se,q,t,e,p):a(se,_e,q,e,t,p);if(ne!==r){if(ne)continue;G=!1;break}if(ee){if(!Vo(t,function(Ie,Re){if(!bs(ee,Re)&&(se===Ie||h(se,Ie,s,a,p)))return ee.push(Re)})){G=!1;break}}else if(!(se===_e||h(se,_e,s,a,p))){G=!1;break}}return p.delete(e),p.delete(t),G}function Ad(e,t,s,a,h,p,y){switch(s){case ze:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new Tn(e),new Tn(t)));case T:case S:case Ce:return Cr(+e,+t);case w:return e.name==t.name&&e.message==t.message;case nt:case Je:return e==t+"";case ye:var _=Qo;case Le:var I=a&j;if(_||(_=En),e.size!=t.size&&!I)return!1;var N=y.get(e);if(N)return N==t;a|=K,y.set(e,t);var F=Lu(_(e),_(t),a,h,p,y);return y.delete(e),F;case Ye:if(Ps)return Ps.call(e)==Ps.call(t)}return!1}function Cd(e,t,s,a,h,p){var y=s&j,_=Ea(e),I=_.length,N=Ea(t),F=N.length;if(I!=F&&!y)return!1;for(var q=I;q--;){var G=_[q];if(!(y?G in t:Me.call(t,G)))return!1}var ee=p.get(e),se=p.get(t);if(ee&&se)return ee==t&&se==e;var _e=!0;p.set(e,t),p.set(t,e);for(var ne=y;++q<I;){G=_[q];var Ie=e[G],Re=t[G];if(a)var pr=y?a(Re,Ie,G,t,e,p):a(Ie,Re,G,e,t,p);if(!(pr===r?Ie===Re||h(Ie,Re,s,a,p):pr)){_e=!1;break}ne||(ne=G=="constructor")}if(_e&&!ne){var Xt=e.constructor,dr=t.constructor;Xt!=dr&&"constructor"in e&&"constructor"in t&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof dr=="function"&&dr instanceof dr)&&(_e=!1)}return p.delete(e),p.delete(t),_e}function Qr(e){return Aa(Hu(e,r,Yu),e+"")}function Ea(e){return tu(e,Ut,Pa)}function Ia(e){return tu(e,nr,$u)}var xa=Fn?function(e){return Fn.get(e)}:za;function Wn(e){for(var t=e.name+"",s=is[t],a=Me.call(is,t)?s.length:0;a--;){var h=s[a],p=h.func;if(p==null||p==e)return h.name}return t}function as(e){var t=Me.call(f,"placeholder")?f:e;return t.placeholder}function ie(){var e=f.iteratee||Ha;return e=e===Ha?su:e,arguments.length?e(arguments[0],arguments[1]):e}function Jn(e,t){var s=e.__data__;return Ud(t)?s[typeof t=="string"?"string":"hash"]:s.map}function Sa(e){for(var t=Ut(e),s=t.length;s--;){var a=t[s],h=e[a];t[s]=[a,h,Uu(h)]}return t}function qi(e,t){var s=kf(e,t);return iu(s)?s:r}function Nd(e){var t=Me.call(e,Ni),s=e[Ni];try{e[Ni]=r;var a=!0}catch{}var h=Pn.call(e);return a&&(t?e[Ni]=s:delete e[Ni]),h}var Pa=Zo?function(e){return e==null?[]:(e=Ke(e),li(Zo(e),function(t){return kc.call(e,t)}))}:Ba,$u=Zo?function(e){for(var t=[];e;)fi(t,Pa(e)),e=On(e);return t}:Ba,Vt=Yt;(ea&&Vt(new ea(new ArrayBuffer(1)))!=ze||Is&&Vt(new Is)!=ye||ta&&Vt(ta.resolve())!=xt||rs&&Vt(new rs)!=Le||xs&&Vt(new xs)!=je)&&(Vt=function(e){var t=Yt(e),s=t==xe?e.constructor:r,a=s?Mi(s):"";if(a)switch(a){case dp:return ze;case gp:return ye;case vp:return xt;case yp:return Le;case _p:return je}return t});function Dd(e,t,s){for(var a=-1,h=s.length;++a<h;){var p=s[a],y=p.size;switch(p.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=Bt(t,e+y);break;case"takeRight":e=$t(e,t-y);break}}return{start:e,end:t}}function Fd(e){var t=e.match(We);return t?t[1].split(Ot):[]}function qu(e,t,s){t=yi(t,e);for(var a=-1,h=t.length,p=!1;++a<h;){var y=kr(t[a]);if(!(p=e!=null&&s(e,y)))break;e=e[y]}return p||++a!=h?p:(h=e==null?0:e.length,!!h&&ro(h)&&Xr(y,h)&&(fe(e)||Ui(e)))}function Ld(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Me.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Mu(e){return typeof e.constructor=="function"&&!Ds(e)?ss(On(e)):{}}function $d(e,t,s){var a=e.constructor;switch(t){case Ne:return ma(e);case T:case S:return new a(+e);case ze:return md(e,s);case ht:case qe:case St:case Ft:case jt:case Ht:case qt:case Kt:case tr:return wu(e,s);case ye:return new a;case Ce:case Je:return new a(e);case nt:return wd(e);case Le:return new a;case Ye:return bd(e)}}function qd(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(vt,`{
/* [wrapped with `+t+`] */
`)}function Md(e){return fe(e)||Ui(e)||!!(zc&&e&&e[zc])}function Xr(e,t){var s=typeof e;return t=t??J,!!t&&(s=="number"||s!="symbol"&&Oo.test(e))&&e>-1&&e%1==0&&e<t}function Qt(e,t,s){if(!ct(s))return!1;var a=typeof t;return(a=="number"?sr(s)&&Xr(t,s.length):a=="string"&&t in s)?Cr(s[t],e):!1}function Ra(e,t){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||fr(e)?!0:Pt.test(e)||!rt.test(e)||t!=null&&e in Ke(t)}function Ud(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ta(e){var t=Wn(e),s=f[t];if(typeof s!="function"||!(t in Se.prototype))return!1;if(e===s)return!0;var a=xa(s);return!!a&&e===a[0]}function jd(e){return!!Uc&&Uc in e}var Hd=xn?Zr:Va;function Ds(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||ts;return e===s}function Uu(e){return e===e&&!ct(e)}function ju(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==r||e in Ke(s))}}function kd(e){var t=eo(e,function(a){return s.size===x&&s.clear(),a}),s=t.cache;return t}function zd(e,t){var s=e[1],a=t[1],h=s|a,p=h<(oe|be|M),y=a==M&&s==pe||a==M&&s==W&&e[7].length<=t[8]||a==(M|W)&&t[7].length<=t[8]&&s==pe;if(!(p||y))return e;a&oe&&(e[2]=t[2],h|=s&oe?0:de);var _=t[3];if(_){var I=e[3];e[3]=I?Eu(I,_,t[4]):_,e[4]=I?pi(e[3],D):t[4]}return _=t[5],_&&(I=e[5],e[5]=I?Iu(I,_,t[6]):_,e[6]=I?pi(e[5],D):t[6]),_=t[7],_&&(e[7]=_),a&M&&(e[8]=e[8]==null?t[8]:Bt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=h,e}function Bd(e){var t=[];if(e!=null)for(var s in Ke(e))t.push(s);return t}function Vd(e){return Pn.call(e)}function Hu(e,t,s){return t=$t(t===r?e.length-1:t,0),function(){for(var a=arguments,h=-1,p=$t(a.length-t,0),y=P(p);++h<p;)y[h]=a[t+h];h=-1;for(var _=P(t+1);++h<t;)_[h]=a[h];return _[t]=s(y),Mt(e,this,_)}}function ku(e,t){return t.length<2?e:$i(e,Er(t,0,-1))}function Gd(e,t){for(var s=e.length,a=Bt(t.length,s),h=ir(e);a--;){var p=t[a];e[a]=Xr(p,s)?h[p]:r}return e}function Oa(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var zu=Vu(fu),Fs=ap||function(e,t){return Pe.setTimeout(e,t)},Aa=Vu(gd);function Bu(e,t,s){var a=t+"";return Aa(e,qd(a,Kd(Fd(a),s)))}function Vu(e){var t=0,s=0;return function(){var a=lp(),h=et-(a-s);if(s=a,h>0){if(++t>=Oe)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Yn(e,t){var s=-1,a=e.length,h=a-1;for(t=t===r?a:t;++s<t;){var p=fa(s,h),y=e[p];e[p]=e[s],e[s]=y}return e.length=t,e}var Gu=kd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Rt,function(s,a,h,p){t.push(h?p.replace(Io,"$1"):a||s)}),t});function kr(e){if(typeof e=="string"||fr(e))return e;var t=e+"";return t=="0"&&1/e==-Ae?"-0":t}function Mi(e){if(e!=null){try{return Sn.call(e)}catch{}try{return e+""}catch{}}return""}function Kd(e,t){return _r($r,function(s){var a="_."+s[0];t&s[1]&&!wn(e,a)&&e.push(a)}),e.sort()}function Ku(e){if(e instanceof Se)return e.clone();var t=new wr(e.__wrapped__,e.__chain__);return t.__actions__=ir(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Wd(e,t,s){(s?Qt(e,t,s):t===r)?t=1:t=$t(ve(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var h=0,p=0,y=P(Nn(a/t));h<a;)y[p++]=Er(e,h,h+=t);return y}function Jd(e){for(var t=-1,s=e==null?0:e.length,a=0,h=[];++t<s;){var p=e[t];p&&(h[a++]=p)}return h}function Yd(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return fi(fe(s)?ir(s):[s],kt(t,1))}var Qd=we(function(e,t){return bt(e)?Ts(e,kt(t,1,bt,!0)):[]}),Xd=we(function(e,t){var s=Ir(t);return bt(s)&&(s=r),bt(e)?Ts(e,kt(t,1,bt,!0),ie(s,2)):[]}),Zd=we(function(e,t){var s=Ir(t);return bt(s)&&(s=r),bt(e)?Ts(e,kt(t,1,bt,!0),r,s):[]});function eg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ve(t),Er(e,t<0?0:t,a)):[]}function tg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ve(t),t=a-t,Er(e,0,t<0?0:t)):[]}function rg(e,t){return e&&e.length?kn(e,ie(t,3),!0,!0):[]}function ig(e,t){return e&&e.length?kn(e,ie(t,3),!0):[]}function sg(e,t,s,a){var h=e==null?0:e.length;return h?(s&&typeof s!="number"&&Qt(e,t,s)&&(s=0,a=h),Yp(e,t,s,a)):[]}function Wu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:ve(s);return h<0&&(h=$t(a+h,0)),bn(e,ie(t,3),h)}function Ju(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a-1;return s!==r&&(h=ve(s),h=s<0?$t(a+h,0):Bt(h,a-1)),bn(e,ie(t,3),h,!0)}function Yu(e){var t=e==null?0:e.length;return t?kt(e,1):[]}function ng(e){var t=e==null?0:e.length;return t?kt(e,Ae):[]}function og(e,t){var s=e==null?0:e.length;return s?(t=t===r?1:ve(t),kt(e,t)):[]}function ag(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var h=e[t];a[h[0]]=h[1]}return a}function Qu(e){return e&&e.length?e[0]:r}function cg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=s==null?0:ve(s);return h<0&&(h=$t(a+h,0)),Qi(e,t,h)}function ug(e){var t=e==null?0:e.length;return t?Er(e,0,-1):[]}var hg=we(function(e){var t=it(e,ya);return t.length&&t[0]===e[0]?aa(t):[]}),lg=we(function(e){var t=Ir(e),s=it(e,ya);return t===Ir(s)?t=r:s.pop(),s.length&&s[0]===e[0]?aa(s,ie(t,2)):[]}),fg=we(function(e){var t=Ir(e),s=it(e,ya);return t=typeof t=="function"?t:r,t&&s.pop(),s.length&&s[0]===e[0]?aa(s,r,t):[]});function pg(e,t){return e==null?"":up.call(e,t)}function Ir(e){var t=e==null?0:e.length;return t?e[t-1]:r}function dg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var h=a;return s!==r&&(h=ve(s),h=h<0?$t(a+h,0):Bt(h,a-1)),t===t?Kf(e,t,h):bn(e,Cc,h,!0)}function gg(e,t){return e&&e.length?cu(e,ve(t)):r}var vg=we(Xu);function Xu(e,t){return e&&e.length&&t&&t.length?la(e,t):e}function yg(e,t,s){return e&&e.length&&t&&t.length?la(e,t,ie(s,2)):e}function _g(e,t,s){return e&&e.length&&t&&t.length?la(e,t,r,s):e}var mg=Qr(function(e,t){var s=e==null?0:e.length,a=ia(e,t);return lu(e,it(t,function(h){return Xr(h,s)?+h:h}).sort(bu)),a});function wg(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,h=[],p=e.length;for(t=ie(t,3);++a<p;){var y=e[a];t(y,a,e)&&(s.push(y),h.push(a))}return lu(e,h),s}function Ca(e){return e==null?e:pp.call(e)}function bg(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Qt(e,t,s)?(t=0,s=a):(t=t==null?0:ve(t),s=s===r?a:ve(s)),Er(e,t,s)):[]}function Eg(e,t){return Hn(e,t)}function Ig(e,t,s){return da(e,t,ie(s,2))}function xg(e,t){var s=e==null?0:e.length;if(s){var a=Hn(e,t);if(a<s&&Cr(e[a],t))return a}return-1}function Sg(e,t){return Hn(e,t,!0)}function Pg(e,t,s){return da(e,t,ie(s,2),!0)}function Rg(e,t){var s=e==null?0:e.length;if(s){var a=Hn(e,t,!0)-1;if(Cr(e[a],t))return a}return-1}function Tg(e){return e&&e.length?pu(e):[]}function Og(e,t){return e&&e.length?pu(e,ie(t,2)):[]}function Ag(e){var t=e==null?0:e.length;return t?Er(e,1,t):[]}function Cg(e,t,s){return e&&e.length?(t=s||t===r?1:ve(t),Er(e,0,t<0?0:t)):[]}function Ng(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===r?1:ve(t),t=a-t,Er(e,t<0?0:t,a)):[]}function Dg(e,t){return e&&e.length?kn(e,ie(t,3),!1,!0):[]}function Fg(e,t){return e&&e.length?kn(e,ie(t,3)):[]}var Lg=we(function(e){return vi(kt(e,1,bt,!0))}),$g=we(function(e){var t=Ir(e);return bt(t)&&(t=r),vi(kt(e,1,bt,!0),ie(t,2))}),qg=we(function(e){var t=Ir(e);return t=typeof t=="function"?t:r,vi(kt(e,1,bt,!0),r,t)});function Mg(e){return e&&e.length?vi(e):[]}function Ug(e,t){return e&&e.length?vi(e,ie(t,2)):[]}function jg(e,t){return t=typeof t=="function"?t:r,e&&e.length?vi(e,r,t):[]}function Na(e){if(!(e&&e.length))return[];var t=0;return e=li(e,function(s){if(bt(s))return t=$t(s.length,t),!0}),Jo(t,function(s){return it(e,Go(s))})}function Zu(e,t){if(!(e&&e.length))return[];var s=Na(e);return t==null?s:it(s,function(a){return Mt(t,r,a)})}var Hg=we(function(e,t){return bt(e)?Ts(e,t):[]}),kg=we(function(e){return va(li(e,bt))}),zg=we(function(e){var t=Ir(e);return bt(t)&&(t=r),va(li(e,bt),ie(t,2))}),Bg=we(function(e){var t=Ir(e);return t=typeof t=="function"?t:r,va(li(e,bt),r,t)}),Vg=we(Na);function Gg(e,t){return yu(e||[],t||[],Rs)}function Kg(e,t){return yu(e||[],t||[],Cs)}var Wg=we(function(e){var t=e.length,s=t>1?e[t-1]:r;return s=typeof s=="function"?(e.pop(),s):r,Zu(e,s)});function eh(e){var t=f(e);return t.__chain__=!0,t}function Jg(e,t){return t(e),e}function Qn(e,t){return t(e)}var Yg=Qr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,h=function(p){return ia(p,e)};return t>1||this.__actions__.length||!(a instanceof Se)||!Xr(s)?this.thru(h):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Qn,args:[h],thisArg:r}),new wr(a,this.__chain__).thru(function(p){return t&&!p.length&&p.push(r),p}))});function Qg(){return eh(this)}function Xg(){return new wr(this.value(),this.__chain__)}function Zg(){this.__values__===r&&(this.__values__=dh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function e0(){return this}function t0(e){for(var t,s=this;s instanceof $n;){var a=Ku(s);a.__index__=0,a.__values__=r,t?h.__wrapped__=a:t=a;var h=a;s=s.__wrapped__}return h.__wrapped__=e,t}function r0(){var e=this.__wrapped__;if(e instanceof Se){var t=e;return this.__actions__.length&&(t=new Se(this)),t=t.reverse(),t.__actions__.push({func:Qn,args:[Ca],thisArg:r}),new wr(t,this.__chain__)}return this.thru(Ca)}function i0(){return vu(this.__wrapped__,this.__actions__)}var s0=zn(function(e,t,s){Me.call(e,s)?++e[s]:Jr(e,s,1)});function n0(e,t,s){var a=fe(e)?Oc:Jp;return s&&Qt(e,t,s)&&(t=r),a(e,ie(t,3))}function o0(e,t){var s=fe(e)?li:Zc;return s(e,ie(t,3))}var a0=Ru(Wu),c0=Ru(Ju);function u0(e,t){return kt(Xn(e,t),1)}function h0(e,t){return kt(Xn(e,t),Ae)}function l0(e,t,s){return s=s===r?1:ve(s),kt(Xn(e,t),s)}function th(e,t){var s=fe(e)?_r:gi;return s(e,ie(t,3))}function rh(e,t){var s=fe(e)?Af:Xc;return s(e,ie(t,3))}var f0=zn(function(e,t,s){Me.call(e,s)?e[s].push(t):Jr(e,s,[t])});function p0(e,t,s,a){e=sr(e)?e:us(e),s=s&&!a?ve(s):0;var h=e.length;return s<0&&(s=$t(h+s,0)),io(e)?s<=h&&e.indexOf(t,s)>-1:!!h&&Qi(e,t,s)>-1}var d0=we(function(e,t,s){var a=-1,h=typeof t=="function",p=sr(e)?P(e.length):[];return gi(e,function(y){p[++a]=h?Mt(t,y,s):Os(y,t,s)}),p}),g0=zn(function(e,t,s){Jr(e,s,t)});function Xn(e,t){var s=fe(e)?it:nu;return s(e,ie(t,3))}function v0(e,t,s,a){return e==null?[]:(fe(t)||(t=t==null?[]:[t]),s=a?r:s,fe(s)||(s=s==null?[]:[s]),uu(e,t,s))}var y0=zn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function _0(e,t,s){var a=fe(e)?Bo:Dc,h=arguments.length<3;return a(e,ie(t,4),s,h,gi)}function m0(e,t,s){var a=fe(e)?Cf:Dc,h=arguments.length<3;return a(e,ie(t,4),s,h,Xc)}function w0(e,t){var s=fe(e)?li:Zc;return s(e,to(ie(t,3)))}function b0(e){var t=fe(e)?Wc:pd;return t(e)}function E0(e,t,s){(s?Qt(e,t,s):t===r)?t=1:t=ve(t);var a=fe(e)?Bp:dd;return a(e,t)}function I0(e){var t=fe(e)?Vp:vd;return t(e)}function x0(e){if(e==null)return 0;if(sr(e))return io(e)?Zi(e):e.length;var t=Vt(e);return t==ye||t==Le?e.size:ua(e).length}function S0(e,t,s){var a=fe(e)?Vo:yd;return s&&Qt(e,t,s)&&(t=r),a(e,ie(t,3))}var P0=we(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Qt(e,t[0],t[1])?t=[]:s>2&&Qt(t[0],t[1],t[2])&&(t=[t[0]]),uu(e,kt(t,1),[])}),Zn=op||function(){return Pe.Date.now()};function R0(e,t){if(typeof t!="function")throw new mr(d);return e=ve(e),function(){if(--e<1)return t.apply(this,arguments)}}function ih(e,t,s){return t=s?r:t,t=e&&t==null?e.length:t,Yr(e,M,r,r,r,r,t)}function sh(e,t){var s;if(typeof t!="function")throw new mr(d);return e=ve(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=r),s}}var Da=we(function(e,t,s){var a=oe;if(s.length){var h=pi(s,as(Da));a|=he}return Yr(e,a,t,s,h)}),nh=we(function(e,t,s){var a=oe|be;if(s.length){var h=pi(s,as(nh));a|=he}return Yr(t,a,e,s,h)});function oh(e,t,s){t=s?r:t;var a=Yr(e,pe,r,r,r,r,r,t);return a.placeholder=oh.placeholder,a}function ah(e,t,s){t=s?r:t;var a=Yr(e,ue,r,r,r,r,r,t);return a.placeholder=ah.placeholder,a}function ch(e,t,s){var a,h,p,y,_,I,N=0,F=!1,q=!1,G=!0;if(typeof e!="function")throw new mr(d);t=xr(t)||0,ct(s)&&(F=!!s.leading,q="maxWait"in s,p=q?$t(xr(s.maxWait)||0,t):p,G="trailing"in s?!!s.trailing:G);function ee(Et){var Nr=a,ti=h;return a=h=r,N=Et,y=e.apply(ti,Nr),y}function se(Et){return N=Et,_=Fs(Ie,t),F?ee(Et):y}function _e(Et){var Nr=Et-I,ti=Et-N,Rh=t-Nr;return q?Bt(Rh,p-ti):Rh}function ne(Et){var Nr=Et-I,ti=Et-N;return I===r||Nr>=t||Nr<0||q&&ti>=p}function Ie(){var Et=Zn();if(ne(Et))return Re(Et);_=Fs(Ie,_e(Et))}function Re(Et){return _=r,G&&a?ee(Et):(a=h=r,y)}function pr(){_!==r&&_u(_),N=0,a=I=h=_=r}function Xt(){return _===r?y:Re(Zn())}function dr(){var Et=Zn(),Nr=ne(Et);if(a=arguments,h=this,I=Et,Nr){if(_===r)return se(I);if(q)return _u(_),_=Fs(Ie,t),ee(I)}return _===r&&(_=Fs(Ie,t)),y}return dr.cancel=pr,dr.flush=Xt,dr}var T0=we(function(e,t){return Qc(e,1,t)}),O0=we(function(e,t,s){return Qc(e,xr(t)||0,s)});function A0(e){return Yr(e,ge)}function eo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new mr(d);var s=function(){var a=arguments,h=t?t.apply(this,a):a[0],p=s.cache;if(p.has(h))return p.get(h);var y=e.apply(this,a);return s.cache=p.set(h,y)||p,y};return s.cache=new(eo.Cache||Wr),s}eo.Cache=Wr;function to(e){if(typeof e!="function")throw new mr(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function C0(e){return sh(2,e)}var N0=_d(function(e,t){t=t.length==1&&fe(t[0])?it(t[0],hr(ie())):it(kt(t,1),hr(ie()));var s=t.length;return we(function(a){for(var h=-1,p=Bt(a.length,s);++h<p;)a[h]=t[h].call(this,a[h]);return Mt(e,this,a)})}),Fa=we(function(e,t){var s=pi(t,as(Fa));return Yr(e,he,r,t,s)}),uh=we(function(e,t){var s=pi(t,as(uh));return Yr(e,A,r,t,s)}),D0=Qr(function(e,t){return Yr(e,W,r,r,r,t)});function F0(e,t){if(typeof e!="function")throw new mr(d);return t=t===r?t:ve(t),we(e,t)}function L0(e,t){if(typeof e!="function")throw new mr(d);return t=t==null?0:$t(ve(t),0),we(function(s){var a=s[t],h=_i(s,0,t);return a&&fi(h,a),Mt(e,this,h)})}function $0(e,t,s){var a=!0,h=!0;if(typeof e!="function")throw new mr(d);return ct(s)&&(a="leading"in s?!!s.leading:a,h="trailing"in s?!!s.trailing:h),ch(e,t,{leading:a,maxWait:t,trailing:h})}function q0(e){return ih(e,1)}function M0(e,t){return Fa(_a(t),e)}function U0(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function j0(e){return br(e,z)}function H0(e,t){return t=typeof t=="function"?t:r,br(e,z,t)}function k0(e){return br(e,H|z)}function z0(e,t){return t=typeof t=="function"?t:r,br(e,H|z,t)}function B0(e,t){return t==null||Yc(e,t,Ut(t))}function Cr(e,t){return e===t||e!==e&&t!==t}var V0=Kn(oa),G0=Kn(function(e,t){return e>=t}),Ui=ru(function(){return arguments}())?ru:function(e){return yt(e)&&Me.call(e,"callee")&&!kc.call(e,"callee")},fe=P.isArray,K0=Jt?hr(Jt):td;function sr(e){return e!=null&&ro(e.length)&&!Zr(e)}function bt(e){return yt(e)&&sr(e)}function W0(e){return e===!0||e===!1||yt(e)&&Yt(e)==T}var mi=cp||Va,J0=Tr?hr(Tr):rd;function Y0(e){return yt(e)&&e.nodeType===1&&!Ls(e)}function Q0(e){if(e==null)return!0;if(sr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||mi(e)||cs(e)||Ui(e)))return!e.length;var t=Vt(e);if(t==ye||t==Le)return!e.size;if(Ds(e))return!ua(e).length;for(var s in e)if(Me.call(e,s))return!1;return!0}function X0(e,t){return As(e,t)}function Z0(e,t,s){s=typeof s=="function"?s:r;var a=s?s(e,t):r;return a===r?As(e,t,r,s):!!a}function La(e){if(!yt(e))return!1;var t=Yt(e);return t==w||t==c||typeof e.message=="string"&&typeof e.name=="string"&&!Ls(e)}function ev(e){return typeof e=="number"&&Bc(e)}function Zr(e){if(!ct(e))return!1;var t=Yt(e);return t==Z||t==ae||t==O||t==_t}function hh(e){return typeof e=="number"&&e==ve(e)}function ro(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ct(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function yt(e){return e!=null&&typeof e=="object"}var lh=yr?hr(yr):sd;function tv(e,t){return e===t||ca(e,t,Sa(t))}function rv(e,t,s){return s=typeof s=="function"?s:r,ca(e,t,Sa(t),s)}function iv(e){return fh(e)&&e!=+e}function sv(e){if(Hd(e))throw new ce(l);return iu(e)}function nv(e){return e===null}function ov(e){return e==null}function fh(e){return typeof e=="number"||yt(e)&&Yt(e)==Ce}function Ls(e){if(!yt(e)||Yt(e)!=xe)return!1;var t=On(e);if(t===null)return!0;var s=Me.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Sn.call(s)==rp}var $a=Ur?hr(Ur):nd;function av(e){return hh(e)&&e>=-J&&e<=J}var ph=ws?hr(ws):od;function io(e){return typeof e=="string"||!fe(e)&&yt(e)&&Yt(e)==Je}function fr(e){return typeof e=="symbol"||yt(e)&&Yt(e)==Ye}var cs=Ci?hr(Ci):ad;function cv(e){return e===r}function uv(e){return yt(e)&&Vt(e)==je}function hv(e){return yt(e)&&Yt(e)==Qe}var lv=Kn(ha),fv=Kn(function(e,t){return e<=t});function dh(e){if(!e)return[];if(sr(e))return io(e)?Or(e):ir(e);if(Es&&e[Es])return Bf(e[Es]());var t=Vt(e),s=t==ye?Qo:t==Le?En:us;return s(e)}function ei(e){if(!e)return e===0?e:0;if(e=xr(e),e===Ae||e===-Ae){var t=e<0?-1:1;return t*B}return e===e?e:0}function ve(e){var t=ei(e),s=t%1;return t===t?s?t-s:t:0}function gh(e){return e?Li(ve(e),0,V):0}function xr(e){if(typeof e=="number")return e;if(fr(e))return U;if(ct(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ct(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Fc(e);var s=Po.test(e);return s||To.test(e)?le(e.slice(2),s?2:8):So.test(e)?U:+e}function vh(e){return Hr(e,nr(e))}function pv(e){return e?Li(ve(e),-J,J):e===0?e:0}function $e(e){return e==null?"":lr(e)}var dv=ns(function(e,t){if(Ds(t)||sr(t)){Hr(t,Ut(t),e);return}for(var s in t)Me.call(t,s)&&Rs(e,s,t[s])}),yh=ns(function(e,t){Hr(t,nr(t),e)}),so=ns(function(e,t,s,a){Hr(t,nr(t),e,a)}),gv=ns(function(e,t,s,a){Hr(t,Ut(t),e,a)}),vv=Qr(ia);function yv(e,t){var s=ss(e);return t==null?s:Jc(s,t)}var _v=we(function(e,t){e=Ke(e);var s=-1,a=t.length,h=a>2?t[2]:r;for(h&&Qt(t[0],t[1],h)&&(a=1);++s<a;)for(var p=t[s],y=nr(p),_=-1,I=y.length;++_<I;){var N=y[_],F=e[N];(F===r||Cr(F,ts[N])&&!Me.call(e,N))&&(e[N]=p[N])}return e}),mv=we(function(e){return e.push(r,Fu),Mt(_h,r,e)});function wv(e,t){return Ac(e,ie(t,3),jr)}function bv(e,t){return Ac(e,ie(t,3),na)}function Ev(e,t){return e==null?e:sa(e,ie(t,3),nr)}function Iv(e,t){return e==null?e:eu(e,ie(t,3),nr)}function xv(e,t){return e&&jr(e,ie(t,3))}function Sv(e,t){return e&&na(e,ie(t,3))}function Pv(e){return e==null?[]:Un(e,Ut(e))}function Rv(e){return e==null?[]:Un(e,nr(e))}function qa(e,t,s){var a=e==null?r:$i(e,t);return a===r?s:a}function Tv(e,t){return e!=null&&qu(e,t,Qp)}function Ma(e,t){return e!=null&&qu(e,t,Xp)}var Ov=Ou(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pn.call(t)),e[t]=s},ja(or)),Av=Ou(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pn.call(t)),Me.call(e,t)?e[t].push(s):e[t]=[s]},ie),Cv=we(Os);function Ut(e){return sr(e)?Kc(e):ua(e)}function nr(e){return sr(e)?Kc(e,!0):cd(e)}function Nv(e,t){var s={};return t=ie(t,3),jr(e,function(a,h,p){Jr(s,t(a,h,p),a)}),s}function Dv(e,t){var s={};return t=ie(t,3),jr(e,function(a,h,p){Jr(s,h,t(a,h,p))}),s}var Fv=ns(function(e,t,s){jn(e,t,s)}),_h=ns(function(e,t,s,a){jn(e,t,s,a)}),Lv=Qr(function(e,t){var s={};if(e==null)return s;var a=!1;t=it(t,function(p){return p=yi(p,e),a||(a=p.length>1),p}),Hr(e,Ia(e),s),a&&(s=br(s,H|k|z,Od));for(var h=t.length;h--;)ga(s,t[h]);return s});function $v(e,t){return mh(e,to(ie(t)))}var qv=Qr(function(e,t){return e==null?{}:hd(e,t)});function mh(e,t){if(e==null)return{};var s=it(Ia(e),function(a){return[a]});return t=ie(t),hu(e,s,function(a,h){return t(a,h[0])})}function Mv(e,t,s){t=yi(t,e);var a=-1,h=t.length;for(h||(h=1,e=r);++a<h;){var p=e==null?r:e[kr(t[a])];p===r&&(a=h,p=s),e=Zr(p)?p.call(e):p}return e}function Uv(e,t,s){return e==null?e:Cs(e,t,s)}function jv(e,t,s,a){return a=typeof a=="function"?a:r,e==null?e:Cs(e,t,s,a)}var wh=Nu(Ut),bh=Nu(nr);function Hv(e,t,s){var a=fe(e),h=a||mi(e)||cs(e);if(t=ie(t,4),s==null){var p=e&&e.constructor;h?s=a?new p:[]:ct(e)?s=Zr(p)?ss(On(e)):{}:s={}}return(h?_r:jr)(e,function(y,_,I){return t(s,y,_,I)}),s}function kv(e,t){return e==null?!0:ga(e,t)}function zv(e,t,s){return e==null?e:gu(e,t,_a(s))}function Bv(e,t,s,a){return a=typeof a=="function"?a:r,e==null?e:gu(e,t,_a(s),a)}function us(e){return e==null?[]:Yo(e,Ut(e))}function Vv(e){return e==null?[]:Yo(e,nr(e))}function Gv(e,t,s){return s===r&&(s=t,t=r),s!==r&&(s=xr(s),s=s===s?s:0),t!==r&&(t=xr(t),t=t===t?t:0),Li(xr(e),t,s)}function Kv(e,t,s){return t=ei(t),s===r?(s=t,t=0):s=ei(s),e=xr(e),Zp(e,t,s)}function Wv(e,t,s){if(s&&typeof s!="boolean"&&Qt(e,t,s)&&(t=s=r),s===r&&(typeof t=="boolean"?(s=t,t=r):typeof e=="boolean"&&(s=e,e=r)),e===r&&t===r?(e=0,t=1):(e=ei(e),t===r?(t=e,e=0):t=ei(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var h=Vc();return Bt(e+h*(t-e+Ve("1e-"+((h+"").length-1))),t)}return fa(e,t)}var Jv=os(function(e,t,s){return t=t.toLowerCase(),e+(s?Eh(t):t)});function Eh(e){return Ua($e(e).toLowerCase())}function Ih(e){return e=$e(e),e&&e.replace(Vr,Uf).replace(Ho,"")}function Yv(e,t,s){e=$e(e),t=lr(t);var a=e.length;s=s===r?a:Li(ve(s),0,a);var h=s;return s-=t.length,s>=0&&e.slice(s,h)==t}function Qv(e){return e=$e(e),e&&tt.test(e)?e.replace(Pi,jf):e}function Xv(e){return e=$e(e),e&&Tt.test(e)?e.replace(dt,"\\$&"):e}var Zv=os(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),ey=os(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),ty=Pu("toLowerCase");function ry(e,t,s){e=$e(e),t=ve(t);var a=t?Zi(e):0;if(!t||a>=t)return e;var h=(t-a)/2;return Gn(Dn(h),s)+e+Gn(Nn(h),s)}function iy(e,t,s){e=$e(e),t=ve(t);var a=t?Zi(e):0;return t&&a<t?e+Gn(t-a,s):e}function sy(e,t,s){e=$e(e),t=ve(t);var a=t?Zi(e):0;return t&&a<t?Gn(t-a,s)+e:e}function ny(e,t,s){return s||t==null?t=0:t&&(t=+t),fp($e(e).replace(gt,""),t||0)}function oy(e,t,s){return(s?Qt(e,t,s):t===r)?t=1:t=ve(t),pa($e(e),t)}function ay(){var e=arguments,t=$e(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var cy=os(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function uy(e,t,s){return s&&typeof s!="number"&&Qt(e,t,s)&&(t=s=r),s=s===r?V:s>>>0,s?(e=$e(e),e&&(typeof t=="string"||t!=null&&!$a(t))&&(t=lr(t),!t&&Xi(e))?_i(Or(e),0,s):e.split(t,s)):[]}var hy=os(function(e,t,s){return e+(s?" ":"")+Ua(t)});function ly(e,t,s){return e=$e(e),s=s==null?0:Li(ve(s),0,e.length),t=lr(t),e.slice(s,s+t.length)==t}function fy(e,t,s){var a=f.templateSettings;s&&Qt(e,t,s)&&(t=r),e=$e(e),t=so({},t,a,Du);var h=so({},t.imports,a.imports,Du),p=Ut(h),y=Yo(h,p),_,I,N=0,F=t.interpolate||Bi,q="__p += '",G=Xo((t.escape||Bi).source+"|"+F.source+"|"+(F===at?xo:Bi).source+"|"+(t.evaluate||Bi).source+"|$","g"),ee="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ko+"]")+`
`;e.replace(G,function(ne,Ie,Re,pr,Xt,dr){return Re||(Re=pr),q+=e.slice(N,dr).replace(Ao,Hf),Ie&&(_=!0,q+=`' +
__e(`+Ie+`) +
'`),Xt&&(I=!0,q+=`';
`+Xt+`;
__p += '`),Re&&(q+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),N=dr+ne.length,ne}),q+=`';
`;var se=Me.call(t,"variable")&&t.variable;if(!se)q=`with (obj) {
`+q+`
}
`;else if(Eo.test(se))throw new ce(v);q=(I?q.replace(qr,""):q).replace(Wt,"$1").replace(Br,"$1;"),q="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+q+`return __p
}`;var _e=Sh(function(){return Fe(p,ee+"return "+q).apply(r,y)});if(_e.source=q,La(_e))throw _e;return _e}function py(e){return $e(e).toLowerCase()}function dy(e){return $e(e).toUpperCase()}function gy(e,t,s){if(e=$e(e),e&&(s||t===r))return Fc(e);if(!e||!(t=lr(t)))return e;var a=Or(e),h=Or(t),p=Lc(a,h),y=$c(a,h)+1;return _i(a,p,y).join("")}function vy(e,t,s){if(e=$e(e),e&&(s||t===r))return e.slice(0,Mc(e)+1);if(!e||!(t=lr(t)))return e;var a=Or(e),h=$c(a,Or(t))+1;return _i(a,0,h).join("")}function yy(e,t,s){if(e=$e(e),e&&(s||t===r))return e.replace(gt,"");if(!e||!(t=lr(t)))return e;var a=Or(e),h=Lc(a,Or(t));return _i(a,h).join("")}function _y(e,t){var s=te,a=Ee;if(ct(t)){var h="separator"in t?t.separator:h;s="length"in t?ve(t.length):s,a="omission"in t?lr(t.omission):a}e=$e(e);var p=e.length;if(Xi(e)){var y=Or(e);p=y.length}if(s>=p)return e;var _=s-Zi(a);if(_<1)return a;var I=y?_i(y,0,_).join(""):e.slice(0,_);if(h===r)return I+a;if(y&&(_+=I.length-_),$a(h)){if(e.slice(_).search(h)){var N,F=I;for(h.global||(h=Xo(h.source,$e(vr.exec(h))+"g")),h.lastIndex=0;N=h.exec(F);)var q=N.index;I=I.slice(0,q===r?_:q)}}else if(e.indexOf(lr(h),_)!=_){var G=I.lastIndexOf(h);G>-1&&(I=I.slice(0,G))}return I+a}function my(e){return e=$e(e),e&&lt.test(e)?e.replace(ui,Wf):e}var wy=os(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Ua=Pu("toUpperCase");function xh(e,t,s){return e=$e(e),t=s?r:t,t===r?zf(e)?Qf(e):Ff(e):e.match(t)||[]}var Sh=we(function(e,t){try{return Mt(e,r,t)}catch(s){return La(s)?s:new ce(s)}}),by=Qr(function(e,t){return _r(t,function(s){s=kr(s),Jr(e,s,Da(e[s],e))}),e});function Ey(e){var t=e==null?0:e.length,s=ie();return e=t?it(e,function(a){if(typeof a[1]!="function")throw new mr(d);return[s(a[0]),a[1]]}):[],we(function(a){for(var h=-1;++h<t;){var p=e[h];if(Mt(p[0],this,a))return Mt(p[1],this,a)}})}function Iy(e){return Wp(br(e,H))}function ja(e){return function(){return e}}function xy(e,t){return e==null||e!==e?t:e}var Sy=Tu(),Py=Tu(!0);function or(e){return e}function Ha(e){return su(typeof e=="function"?e:br(e,H))}function Ry(e){return ou(br(e,H))}function Ty(e,t){return au(e,br(t,H))}var Oy=we(function(e,t){return function(s){return Os(s,e,t)}}),Ay=we(function(e,t){return function(s){return Os(e,s,t)}});function ka(e,t,s){var a=Ut(t),h=Un(t,a);s==null&&!(ct(t)&&(h.length||!a.length))&&(s=t,t=e,e=this,h=Un(t,Ut(t)));var p=!(ct(s)&&"chain"in s)||!!s.chain,y=Zr(e);return _r(h,function(_){var I=t[_];e[_]=I,y&&(e.prototype[_]=function(){var N=this.__chain__;if(p||N){var F=e(this.__wrapped__),q=F.__actions__=ir(this.__actions__);return q.push({func:I,args:arguments,thisArg:e}),F.__chain__=N,F}return I.apply(e,fi([this.value()],arguments))})}),e}function Cy(){return Pe._===this&&(Pe._=ip),this}function za(){}function Ny(e){return e=ve(e),we(function(t){return cu(t,e)})}var Dy=wa(it),Fy=wa(Oc),Ly=wa(Vo);function Ph(e){return Ra(e)?Go(kr(e)):ld(e)}function $y(e){return function(t){return e==null?r:$i(e,t)}}var qy=Au(),My=Au(!0);function Ba(){return[]}function Va(){return!1}function Uy(){return{}}function jy(){return""}function Hy(){return!0}function ky(e,t){if(e=ve(e),e<1||e>J)return[];var s=V,a=Bt(e,V);t=ie(t),e-=V;for(var h=Jo(a,t);++s<e;)t(s);return h}function zy(e){return fe(e)?it(e,kr):fr(e)?[e]:ir(Gu($e(e)))}function By(e){var t=++tp;return $e(e)+t}var Vy=Vn(function(e,t){return e+t},0),Gy=ba("ceil"),Ky=Vn(function(e,t){return e/t},1),Wy=ba("floor");function Jy(e){return e&&e.length?Mn(e,or,oa):r}function Yy(e,t){return e&&e.length?Mn(e,ie(t,2),oa):r}function Qy(e){return Nc(e,or)}function Xy(e,t){return Nc(e,ie(t,2))}function Zy(e){return e&&e.length?Mn(e,or,ha):r}function e1(e,t){return e&&e.length?Mn(e,ie(t,2),ha):r}var t1=Vn(function(e,t){return e*t},1),r1=ba("round"),i1=Vn(function(e,t){return e-t},0);function s1(e){return e&&e.length?Wo(e,or):0}function n1(e,t){return e&&e.length?Wo(e,ie(t,2)):0}return f.after=R0,f.ary=ih,f.assign=dv,f.assignIn=yh,f.assignInWith=so,f.assignWith=gv,f.at=vv,f.before=sh,f.bind=Da,f.bindAll=by,f.bindKey=nh,f.castArray=U0,f.chain=eh,f.chunk=Wd,f.compact=Jd,f.concat=Yd,f.cond=Ey,f.conforms=Iy,f.constant=ja,f.countBy=s0,f.create=yv,f.curry=oh,f.curryRight=ah,f.debounce=ch,f.defaults=_v,f.defaultsDeep=mv,f.defer=T0,f.delay=O0,f.difference=Qd,f.differenceBy=Xd,f.differenceWith=Zd,f.drop=eg,f.dropRight=tg,f.dropRightWhile=rg,f.dropWhile=ig,f.fill=sg,f.filter=o0,f.flatMap=u0,f.flatMapDeep=h0,f.flatMapDepth=l0,f.flatten=Yu,f.flattenDeep=ng,f.flattenDepth=og,f.flip=A0,f.flow=Sy,f.flowRight=Py,f.fromPairs=ag,f.functions=Pv,f.functionsIn=Rv,f.groupBy=f0,f.initial=ug,f.intersection=hg,f.intersectionBy=lg,f.intersectionWith=fg,f.invert=Ov,f.invertBy=Av,f.invokeMap=d0,f.iteratee=Ha,f.keyBy=g0,f.keys=Ut,f.keysIn=nr,f.map=Xn,f.mapKeys=Nv,f.mapValues=Dv,f.matches=Ry,f.matchesProperty=Ty,f.memoize=eo,f.merge=Fv,f.mergeWith=_h,f.method=Oy,f.methodOf=Ay,f.mixin=ka,f.negate=to,f.nthArg=Ny,f.omit=Lv,f.omitBy=$v,f.once=C0,f.orderBy=v0,f.over=Dy,f.overArgs=N0,f.overEvery=Fy,f.overSome=Ly,f.partial=Fa,f.partialRight=uh,f.partition=y0,f.pick=qv,f.pickBy=mh,f.property=Ph,f.propertyOf=$y,f.pull=vg,f.pullAll=Xu,f.pullAllBy=yg,f.pullAllWith=_g,f.pullAt=mg,f.range=qy,f.rangeRight=My,f.rearg=D0,f.reject=w0,f.remove=wg,f.rest=F0,f.reverse=Ca,f.sampleSize=E0,f.set=Uv,f.setWith=jv,f.shuffle=I0,f.slice=bg,f.sortBy=P0,f.sortedUniq=Tg,f.sortedUniqBy=Og,f.split=uy,f.spread=L0,f.tail=Ag,f.take=Cg,f.takeRight=Ng,f.takeRightWhile=Dg,f.takeWhile=Fg,f.tap=Jg,f.throttle=$0,f.thru=Qn,f.toArray=dh,f.toPairs=wh,f.toPairsIn=bh,f.toPath=zy,f.toPlainObject=vh,f.transform=Hv,f.unary=q0,f.union=Lg,f.unionBy=$g,f.unionWith=qg,f.uniq=Mg,f.uniqBy=Ug,f.uniqWith=jg,f.unset=kv,f.unzip=Na,f.unzipWith=Zu,f.update=zv,f.updateWith=Bv,f.values=us,f.valuesIn=Vv,f.without=Hg,f.words=xh,f.wrap=M0,f.xor=kg,f.xorBy=zg,f.xorWith=Bg,f.zip=Vg,f.zipObject=Gg,f.zipObjectDeep=Kg,f.zipWith=Wg,f.entries=wh,f.entriesIn=bh,f.extend=yh,f.extendWith=so,ka(f,f),f.add=Vy,f.attempt=Sh,f.camelCase=Jv,f.capitalize=Eh,f.ceil=Gy,f.clamp=Gv,f.clone=j0,f.cloneDeep=k0,f.cloneDeepWith=z0,f.cloneWith=H0,f.conformsTo=B0,f.deburr=Ih,f.defaultTo=xy,f.divide=Ky,f.endsWith=Yv,f.eq=Cr,f.escape=Qv,f.escapeRegExp=Xv,f.every=n0,f.find=a0,f.findIndex=Wu,f.findKey=wv,f.findLast=c0,f.findLastIndex=Ju,f.findLastKey=bv,f.floor=Wy,f.forEach=th,f.forEachRight=rh,f.forIn=Ev,f.forInRight=Iv,f.forOwn=xv,f.forOwnRight=Sv,f.get=qa,f.gt=V0,f.gte=G0,f.has=Tv,f.hasIn=Ma,f.head=Qu,f.identity=or,f.includes=p0,f.indexOf=cg,f.inRange=Kv,f.invoke=Cv,f.isArguments=Ui,f.isArray=fe,f.isArrayBuffer=K0,f.isArrayLike=sr,f.isArrayLikeObject=bt,f.isBoolean=W0,f.isBuffer=mi,f.isDate=J0,f.isElement=Y0,f.isEmpty=Q0,f.isEqual=X0,f.isEqualWith=Z0,f.isError=La,f.isFinite=ev,f.isFunction=Zr,f.isInteger=hh,f.isLength=ro,f.isMap=lh,f.isMatch=tv,f.isMatchWith=rv,f.isNaN=iv,f.isNative=sv,f.isNil=ov,f.isNull=nv,f.isNumber=fh,f.isObject=ct,f.isObjectLike=yt,f.isPlainObject=Ls,f.isRegExp=$a,f.isSafeInteger=av,f.isSet=ph,f.isString=io,f.isSymbol=fr,f.isTypedArray=cs,f.isUndefined=cv,f.isWeakMap=uv,f.isWeakSet=hv,f.join=pg,f.kebabCase=Zv,f.last=Ir,f.lastIndexOf=dg,f.lowerCase=ey,f.lowerFirst=ty,f.lt=lv,f.lte=fv,f.max=Jy,f.maxBy=Yy,f.mean=Qy,f.meanBy=Xy,f.min=Zy,f.minBy=e1,f.stubArray=Ba,f.stubFalse=Va,f.stubObject=Uy,f.stubString=jy,f.stubTrue=Hy,f.multiply=t1,f.nth=gg,f.noConflict=Cy,f.noop=za,f.now=Zn,f.pad=ry,f.padEnd=iy,f.padStart=sy,f.parseInt=ny,f.random=Wv,f.reduce=_0,f.reduceRight=m0,f.repeat=oy,f.replace=ay,f.result=Mv,f.round=r1,f.runInContext=E,f.sample=b0,f.size=x0,f.snakeCase=cy,f.some=S0,f.sortedIndex=Eg,f.sortedIndexBy=Ig,f.sortedIndexOf=xg,f.sortedLastIndex=Sg,f.sortedLastIndexBy=Pg,f.sortedLastIndexOf=Rg,f.startCase=hy,f.startsWith=ly,f.subtract=i1,f.sum=s1,f.sumBy=n1,f.template=fy,f.times=ky,f.toFinite=ei,f.toInteger=ve,f.toLength=gh,f.toLower=py,f.toNumber=xr,f.toSafeInteger=pv,f.toString=$e,f.toUpper=dy,f.trim=gy,f.trimEnd=vy,f.trimStart=yy,f.truncate=_y,f.unescape=my,f.uniqueId=By,f.upperCase=wy,f.upperFirst=Ua,f.each=th,f.eachRight=rh,f.first=Qu,ka(f,function(){var e={};return jr(f,function(t,s){Me.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),_r(["drop","take"],function(e,t){Se.prototype[e]=function(s){s=s===r?1:$t(ve(s),0);var a=this.__filtered__&&!t?new Se(this):this.clone();return a.__filtered__?a.__takeCount__=Bt(s,a.__takeCount__):a.__views__.push({size:Bt(s,V),type:e+(a.__dir__<0?"Right":"")}),a},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),_r(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==R||s==Ue;Se.prototype[e]=function(h){var p=this.clone();return p.__iteratees__.push({iteratee:ie(h,3),type:s}),p.__filtered__=p.__filtered__||a,p}}),_r(["head","last"],function(e,t){var s="take"+(t?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),_r(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(or)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,t){return typeof e=="function"?new Se(this):this.map(function(s){return Os(s,e,t)})}),Se.prototype.reject=function(e){return this.filter(to(ie(e)))},Se.prototype.slice=function(e,t){e=ve(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==r&&(t=ve(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(V)},jr(Se.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),h=f[a?"take"+(t=="last"?"Right":""):t],p=a||/^find/.test(t);h&&(f.prototype[t]=function(){var y=this.__wrapped__,_=a?[1]:arguments,I=y instanceof Se,N=_[0],F=I||fe(y),q=function(Ie){var Re=h.apply(f,fi([Ie],_));return a&&G?Re[0]:Re};F&&s&&typeof N=="function"&&N.length!=1&&(I=F=!1);var G=this.__chain__,ee=!!this.__actions__.length,se=p&&!G,_e=I&&!ee;if(!p&&F){y=_e?y:new Se(this);var ne=e.apply(y,_);return ne.__actions__.push({func:Qn,args:[q],thisArg:r}),new wr(ne,G)}return se&&_e?e.apply(this,_):(ne=this.thru(q),se?a?ne.value()[0]:ne.value():ne)})}),_r(["pop","push","shift","sort","splice","unshift"],function(e){var t=In[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var h=arguments;if(a&&!this.__chain__){var p=this.value();return t.apply(fe(p)?p:[],h)}return this[s](function(y){return t.apply(fe(y)?y:[],h)})}}),jr(Se.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";Me.call(is,a)||(is[a]=[]),is[a].push({name:t,func:s})}}),is[Bn(r,be).name]=[{name:"wrapper",func:r}],Se.prototype.clone=mp,Se.prototype.reverse=wp,Se.prototype.value=bp,f.prototype.at=Yg,f.prototype.chain=Qg,f.prototype.commit=Xg,f.prototype.next=Zg,f.prototype.plant=t0,f.prototype.reverse=r0,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=i0,f.prototype.first=f.prototype.head,Es&&(f.prototype[Es]=e0),f},es=Xf();wt?((wt.exports=es)._=es,Ge._=es):Pe._=es}).call(Vs)})(pc,pc.exports);var tE=Object.defineProperty,rE=Object.defineProperties,iE=Object.getOwnPropertyDescriptors,Al=Object.getOwnPropertySymbols,sE=Object.prototype.hasOwnProperty,nE=Object.prototype.propertyIsEnumerable,Cl=(u,i,r)=>i in u?tE(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,ao=(u,i)=>{for(var r in i||(i={}))sE.call(i,r)&&Cl(u,r,i[r]);if(Al)for(var r of Al(i))nE.call(i,r)&&Cl(u,r,i[r]);return u},oE=(u,i)=>rE(u,iE(i));function Ii(u,i,r){var n;const o=G1(u);return((n=i.rpcMap)==null?void 0:n[o.reference])||`${eE}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function zi(u){return u.includes(":")?u.split(":")[1]:u}function Rf(u){return u.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function aE(u,i){const r=Object.keys(i.namespaces).filter(o=>o.includes(u));if(!r.length)return[];const n=[];return r.forEach(o=>{const l=i.namespaces[o].accounts;n.push(...l)}),n}function cE(u={},i={}){const r=Nl(u),n=Nl(i);return pc.exports.merge(r,n)}function Nl(u){var i,r,n,o;const l={};if(!ho(u))return l;for(const[d,v]of Object.entries(u)){const m=Vl(d)?[d]:v.chains,x=v.methods||[],D=v.events||[],H=v.rpcMap||{},k=Gs(d);l[k]=oE(ao(ao({},l[k]),v),{chains:Ka(m,(i=l[k])==null?void 0:i.chains),methods:Ka(x,(r=l[k])==null?void 0:r.methods),events:Ka(D,(n=l[k])==null?void 0:n.events),rpcMap:ao(ao({},H),(o=l[k])==null?void 0:o.rpcMap)})}return l}function uE(u){return u.includes(":")?u.split(":")[2]:u}function hE(u){const i={};for(const[r,n]of Object.entries(u)){const o=n.methods||[],l=n.events||[],d=n.accounts||[],v=Vl(r)?[r]:n.chains?n.chains:Rf(n.accounts);i[r]={chains:v,methods:o,events:l,accounts:d}}return i}function nc(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):u.includes(":")?Number(u.split(":")[1]):Number(u)}const Tf={},st=u=>Tf[u],oc=(u,i)=>{Tf[u]=i};class lE{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=zi(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class fE{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(parseInt(i),r),this.chainId=parseInt(i),this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const n=r||Ii(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(zi(r));i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,n;let o=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const l=parseInt(o,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class pE{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=zi(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class dE{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=zi(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class gE{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=zi(r);i[o]=this.createHttpProvider(o,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class vE{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=zi(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class yE{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=zi(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ai(new Si(n,st("disableProviderPing")))}}class _E{constructor(i){this.name="near",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||Ii(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(ci.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Ii(i,this.namespace);return typeof n>"u"?void 0:new ai(new Si(n,st("disableProviderPing")))}}var mE=Object.defineProperty,wE=Object.defineProperties,bE=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,Fl=(u,i,r)=>i in u?mE(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,co=(u,i)=>{for(var r in i||(i={}))EE.call(i,r)&&Fl(u,r,i[r]);if(Dl)for(var r of Dl(i))IE.call(i,r)&&Fl(u,r,i[r]);return u},ac=(u,i)=>wE(u,bE(i));class Rc{constructor(i){this.events=new yc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Te.pino(Te.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Tl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const r=new Rc(i);return await r.initialize(),r}async request(i,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:co({},i),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(i,r,n){this.request(i,n).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(l=>{this.session=l,this.namespaces||(this.namespaces=hE(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==Sf)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[n,o]=this.validateChain(i);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(gs(r)){for(const n of r)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Wb.init({logger:this.providerOpts.logger||Tl,relayUrl:this.providerOpts.relayUrl||Qb,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>Gs(r)))];oc("client",this.client),oc("events",this.events),oc("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const n=aE(r,this.session),o=Rf(n),l=cE(this.namespaces,this.optionalNamespaces),d=ac(co({},l[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new fE({namespace:d});break;case"solana":this.rpcProviders[r]=new pE({namespace:d});break;case"cosmos":this.rpcProviders[r]=new dE({namespace:d});break;case"polkadot":this.rpcProviders[r]=new lE({namespace:d});break;case"cip34":this.rpcProviders[r]=new gE({namespace:d});break;case"elrond":this.rpcProviders[r]=new vE({namespace:d});break;case"multiversx":this.rpcProviders[r]=new yE({namespace:d});break;case"near":this.rpcProviders[r]=new _E({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&gs(o)&&this.events.emit("accountsChanged",o.map(uE))}else if(n.name==="chainChanged"){const o=r.chainId,l=r.event.data,d=Gs(o),v=nc(o)!==nc(l)?`${d}:${nc(l)}`:o;this.onChainChanged(v)}else this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var n;const{namespaces:o}=r,l=(n=this.client)==null?void 0:n.session.get(i);this.session=ac(co({},l),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",ac(co({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(ci.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=i;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(i){const[r,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(d=>Gs(d)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Gs(Object.keys(this.namespaces)[0]),l=this.rpcProviders[o].getDefaultChain();return[o,l]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var n;if(!this.namespaces)return;const[o,l]=this.validateChain(i);r||this.getProvider(o).setDefaultChain(l),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${Ol}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${Ol}/${i}`)}}const xE=Rc,SE="wc",PE="ethereum_provider",RE=`${SE}@2:${PE}:`,TE="https://rpc.walletconnect.com/v1/",dc=["eth_sendTransaction","personal_sign"],OE=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],gc=["chainChanged","accountsChanged"],AE=["chainChanged","accountsChanged","message","disconnect","connect"];var CE=Object.defineProperty,NE=Object.defineProperties,DE=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,FE=Object.prototype.hasOwnProperty,LE=Object.prototype.propertyIsEnumerable,$l=(u,i,r)=>i in u?CE(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,Ws=(u,i)=>{for(var r in i||(i={}))FE.call(i,r)&&$l(u,r,i[r]);if(Ll)for(var r of Ll(i))LE.call(i,r)&&$l(u,r,i[r]);return u},ql=(u,i)=>NE(u,DE(i));function go(u){return Number(u[0].split(":")[1])}function cc(u){return`0x${u.toString(16)}`}function $E(u){const{chains:i,optionalChains:r,methods:n,optionalMethods:o,events:l,optionalEvents:d,rpcMap:v}=u;if(!gs(i))throw new Error("Invalid chains");const m={chains:i,methods:n||dc,events:l||gc,rpcMap:Ws({},i.length?{[go(i)]:v[go(i)]}:{})},x=l==null?void 0:l.filter(z=>!gc.includes(z)),D=n==null?void 0:n.filter(z=>!dc.includes(z));if(!r&&!d&&!o&&!(x!=null&&x.length)&&!(D!=null&&D.length))return{required:i.length?m:void 0};const H=(x==null?void 0:x.length)&&(D==null?void 0:D.length)||!r,k={chains:[...new Set(H?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(o!=null&&o.length?o:OE))],events:[...new Set(m.events.concat(d!=null&&d.length?d:AE))],rpcMap:v};return{required:i.length?m:void 0,optional:r.length?k:void 0}}class Tc{constructor(){this.events=new Pr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=RE,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new Tc;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:n}=$E(this.rpc);try{const o=await new Promise(async(d,v)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(x=>{!x.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(ql(Ws({namespaces:Ws({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(x=>{d(x)}).catch(x=>{v(new Error(x.message))})});if(!o)return;const l=K1(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:cc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",cc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",ql(Ws({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",cc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,n,o]=i.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,n;const o=(r=i==null?void 0:i.chains)!=null?r:[],l=(n=i==null?void 0:i.optionalChains)!=null?n:[],d=o.concat(l);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=o.length?(i==null?void 0:i.methods)||dc:[],m=o.length?(i==null?void 0:i.events)||gc:[],x=(i==null?void 0:i.optionalMethods)||[],D=(i==null?void 0:i.optionalEvents)||[],H=(i==null?void 0:i.rpcMap)||this.buildRpcMap(d,i.projectId),k=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(z=>this.formatChainId(z)),optionalChains:l.map(z=>this.formatChainId(z)),methods:v,events:m,optionalMethods:x,optionalEvents:D,rpcMap:H,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:k,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const n={};return i.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?go(this.rpc.chains):go(this.rpc.optionalChains),this.signer=await xE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await W1(()=>import("./index-aea4db74.js").then(o=>o.i),["assets/index-aea4db74.js","assets/index-8d7d7e80.js","assets/index-6a069955.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Ws({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:n,rpcMap:o}=i;r&&gs(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)})),n&&gs(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)}))}getRpcUrl(i,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${TE}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const KE=Tc;export{KE as EthereumProvider,AE as OPTIONAL_EVENTS,OE as OPTIONAL_METHODS,gc as REQUIRED_EVENTS,dc as REQUIRED_METHODS,Tc as default};
